import{f as hu,k as G,j as Qt,i as lu,h as mo,w as ii,V as T0,M as N0,N as L,m as D0,o as Kc,p as q0,K as z0,A as j0,q as Ol,x as B0,H as L0,F as U0,r as $l,$ as M0,t as H0,s as k0,J as V0,u as Xn,v as Cl,X as K0,y as G0,E as fu,z as Gf,B as sr,I as W0,C as Rl,D as un,G as Ve,U as at,L as ri,O as Et,P as J0,Q as hn,R as Wf,S as Q0,T as Y0,W as Z0,Y as Jf,Z as X0,a0 as Qf,a1 as Yf,a2 as fn,a3 as Gc,a4 as Oo,a5 as pn,a6 as ew,a7 as $o,a8 as tw,a9 as rw,aa as iw,ab as nw,ac as wo,ad as sw,ae as ow,af as Ec,ag as Tl,ah as aw,ai as cw,aj as uw,ak as Nl,al as hw,am as lw,an as fw,ao as pw,ap as dw,aq as gw,ar as yw,as as Qn,at as Zf,au as Ic,av as vw,aw as mw,_ as ww}from"./index-6d80966c.js";import{s as is,a as zo,r as Xf,f as xi,g as pu,i as or,b as ns,c as Dl,d as bw,e as _w,h as du,p as Ew,j as gu,k as jo,l as ti,m as Iw,n as oi}from"./index.es-d0750f46.js";const Pw=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,xw=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Sw=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Fw(s,t){if(s==="__proto__"||s==="constructor"&&t&&typeof t=="object"&&"prototype"in t){Aw(s);return}return t}function Aw(s){console.warn(`[destr] Dropping "${s}" key to prevent prototype pollution.`)}function bo(s,t={}){if(typeof s!="string")return s;if(s[0]==='"'&&s[s.length-1]==='"'&&s.indexOf("\\")===-1)return s.slice(1,-1);const r=s.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!Sw.test(s)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return s}try{if(Pw.test(s)||xw.test(s)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(s,Fw)}return JSON.parse(s)}catch(n){if(t.strict)throw n;return s}}function Ow(s){return!s||typeof s.then!="function"?Promise.resolve(s):s}function Ye(s,...t){try{return Ow(s(...t))}catch(r){return Promise.reject(r)}}function $w(s){const t=typeof s;return s===null||t!=="object"&&t!=="function"}function Cw(s){const t=Object.getPrototypeOf(s);return!t||t.isPrototypeOf(Object)}function Co(s){if($w(s))return String(s);if(Cw(s)||Array.isArray(s))return JSON.stringify(s);if(typeof s.toJSON=="function")return Co(s.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Wc="base64:";function Rw(s){return typeof s=="string"?s:Wc+Dw(s)}function Tw(s){return typeof s!="string"||!s.startsWith(Wc)?s:Nw(s.slice(Wc.length))}function Nw(s){return globalThis.Buffer?Buffer.from(s,"base64"):Uint8Array.from(globalThis.atob(s),t=>t.codePointAt(0))}function Dw(s){return globalThis.Buffer?Buffer.from(s).toString("base64"):globalThis.btoa(String.fromCodePoint(...s))}function _t(s){var t;return s&&((t=s.split("?")[0])==null?void 0:t.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function qw(...s){return _t(s.join(":"))}function _o(s){return s=_t(s),s?s+":":""}function zw(s,t){if(t===void 0)return!0;let r=0,n=s.indexOf(":");for(;n>-1;)r++,n=s.indexOf(":",n+1);return r<=t}function jw(s,t){return t?s.startsWith(t)&&s[s.length-1]!=="$":s[s.length-1]!=="$"}const Bw="memory",Lw=()=>{const s=new Map;return{name:Bw,getInstance:()=>s,hasItem(t){return s.has(t)},getItem(t){return s.get(t)??null},getItemRaw(t){return s.get(t)??null},setItem(t,r){s.set(t,r)},setItemRaw(t,r){s.set(t,r)},removeItem(t){s.delete(t)},getKeys(){return[...s.keys()]},clear(){s.clear()},dispose(){s.clear()}}};function Uw(s={}){const t={mounts:{"":s.driver||Lw()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=g=>{for(const v of t.mountpoints)if(g.startsWith(v))return{base:v,relativeKey:g.slice(v.length),driver:t.mounts[v]};return{base:"",relativeKey:g,driver:t.mounts[""]}},n=(g,v)=>t.mountpoints.filter(b=>b.startsWith(g)||v&&g.startsWith(b)).map(b=>({relativeBase:g.length>b.length?g.slice(b.length):void 0,mountpoint:b,driver:t.mounts[b]})),o=(g,v)=>{if(t.watching){v=_t(v);for(const b of t.watchListeners)b(g,v)}},c=async()=>{if(!t.watching){t.watching=!0;for(const g in t.mounts)t.unwatch[g]=await ql(t.mounts[g],o,g)}},h=async()=>{if(t.watching){for(const g in t.unwatch)await t.unwatch[g]();t.unwatch={},t.watching=!1}},p=(g,v,b)=>{const E=new Map,F=S=>{let D=E.get(S.base);return D||(D={driver:S.driver,base:S.base,items:[]},E.set(S.base,D)),D};for(const S of g){const D=typeof S=="string",H=_t(D?S:S.key),M=D?void 0:S.value,Q=D||!S.options?v:{...v,...S.options},T=r(H);F(T).items.push({key:H,value:M,relativeKey:T.relativeKey,options:Q})}return Promise.all([...E.values()].map(S=>b(S))).then(S=>S.flat())},f={hasItem(g,v={}){g=_t(g);const{relativeKey:b,driver:E}=r(g);return Ye(E.hasItem,b,v)},getItem(g,v={}){g=_t(g);const{relativeKey:b,driver:E}=r(g);return Ye(E.getItem,b,v).then(F=>bo(F))},getItems(g,v={}){return p(g,v,b=>b.driver.getItems?Ye(b.driver.getItems,b.items.map(E=>({key:E.relativeKey,options:E.options})),v).then(E=>E.map(F=>({key:qw(b.base,F.key),value:bo(F.value)}))):Promise.all(b.items.map(E=>Ye(b.driver.getItem,E.relativeKey,E.options).then(F=>({key:E.key,value:bo(F)})))))},getItemRaw(g,v={}){g=_t(g);const{relativeKey:b,driver:E}=r(g);return E.getItemRaw?Ye(E.getItemRaw,b,v):Ye(E.getItem,b,v).then(F=>Tw(F))},async setItem(g,v,b={}){if(v===void 0)return f.removeItem(g);g=_t(g);const{relativeKey:E,driver:F}=r(g);F.setItem&&(await Ye(F.setItem,E,Co(v),b),F.watch||o("update",g))},async setItems(g,v){await p(g,v,async b=>{if(b.driver.setItems)return Ye(b.driver.setItems,b.items.map(E=>({key:E.relativeKey,value:Co(E.value),options:E.options})),v);b.driver.setItem&&await Promise.all(b.items.map(E=>Ye(b.driver.setItem,E.relativeKey,Co(E.value),E.options)))})},async setItemRaw(g,v,b={}){if(v===void 0)return f.removeItem(g,b);g=_t(g);const{relativeKey:E,driver:F}=r(g);if(F.setItemRaw)await Ye(F.setItemRaw,E,v,b);else if(F.setItem)await Ye(F.setItem,E,Rw(v),b);else return;F.watch||o("update",g)},async removeItem(g,v={}){typeof v=="boolean"&&(v={removeMeta:v}),g=_t(g);const{relativeKey:b,driver:E}=r(g);E.removeItem&&(await Ye(E.removeItem,b,v),(v.removeMeta||v.removeMata)&&await Ye(E.removeItem,b+"$",v),E.watch||o("remove",g))},async getMeta(g,v={}){typeof v=="boolean"&&(v={nativeOnly:v}),g=_t(g);const{relativeKey:b,driver:E}=r(g),F=Object.create(null);if(E.getMeta&&Object.assign(F,await Ye(E.getMeta,b,v)),!v.nativeOnly){const S=await Ye(E.getItem,b+"$",v).then(D=>bo(D));S&&typeof S=="object"&&(typeof S.atime=="string"&&(S.atime=new Date(S.atime)),typeof S.mtime=="string"&&(S.mtime=new Date(S.mtime)),Object.assign(F,S))}return F},setMeta(g,v,b={}){return this.setItem(g+"$",v,b)},removeMeta(g,v={}){return this.removeItem(g+"$",v)},async getKeys(g,v={}){var H;g=_o(g);const b=n(g,!0);let E=[];const F=[];let S=!0;for(const M of b){(H=M.driver.flags)!=null&&H.maxDepth||(S=!1);const Q=await Ye(M.driver.getKeys,M.relativeBase,v);for(const T of Q){const j=M.mountpoint+_t(T);E.some(W=>j.startsWith(W))||F.push(j)}E=[M.mountpoint,...E.filter(T=>!T.startsWith(M.mountpoint))]}const D=v.maxDepth!==void 0&&!S;return F.filter(M=>(!D||zw(M,v.maxDepth))&&jw(M,g))},async clear(g,v={}){g=_o(g),await Promise.all(n(g,!1).map(async b=>{if(b.driver.clear)return Ye(b.driver.clear,b.relativeBase,v);if(b.driver.removeItem){const E=await b.driver.getKeys(b.relativeBase||"",v);return Promise.all(E.map(F=>b.driver.removeItem(F,v)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(g=>zl(g)))},async watch(g){return await c(),t.watchListeners.push(g),async()=>{t.watchListeners=t.watchListeners.filter(v=>v!==g),t.watchListeners.length===0&&await h()}},async unwatch(){t.watchListeners=[],await h()},mount(g,v){if(g=_o(g),g&&t.mounts[g])throw new Error(`already mounted at ${g}`);return g&&(t.mountpoints.push(g),t.mountpoints.sort((b,E)=>E.length-b.length)),t.mounts[g]=v,t.watching&&Promise.resolve(ql(v,o,g)).then(b=>{t.unwatch[g]=b}).catch(console.error),f},async unmount(g,v=!0){var b,E;g=_o(g),!(!g||!t.mounts[g])&&(t.watching&&g in t.unwatch&&((E=(b=t.unwatch)[g])==null||E.call(b),delete t.unwatch[g]),v&&await zl(t.mounts[g]),t.mountpoints=t.mountpoints.filter(F=>F!==g),delete t.mounts[g])},getMount(g=""){g=_t(g)+":";const v=r(g);return{driver:v.driver,base:v.base}},getMounts(g="",v={}){return g=_t(g),n(g,v.parents).map(E=>({driver:E.driver,base:E.mountpoint}))},keys:(g,v={})=>f.getKeys(g,v),get:(g,v={})=>f.getItem(g,v),set:(g,v,b={})=>f.setItem(g,v,b),has:(g,v={})=>f.hasItem(g,v),del:(g,v={})=>f.removeItem(g,v),remove:(g,v={})=>f.removeItem(g,v)};return f}function ql(s,t,r){return s.watch?s.watch((n,o)=>t(n,r+o)):()=>{}}async function zl(s){typeof s.dispose=="function"&&await Ye(s.dispose)}function Si(s){return new Promise((t,r)=>{s.oncomplete=s.onsuccess=()=>t(s.result),s.onabort=s.onerror=()=>r(s.error)})}function ep(s,t){let r;const n=()=>{if(r)return r;const o=indexedDB.open(s);return o.onupgradeneeded=()=>o.result.createObjectStore(t),r=Si(o),r.then(c=>{c.onclose=()=>r=void 0},()=>{}),r};return(o,c)=>n().then(h=>c(h.transaction(t,o).objectStore(t)))}let Pc;function ss(){return Pc||(Pc=ep("keyval-store","keyval")),Pc}function jl(s,t=ss()){return t("readonly",r=>Si(r.get(s)))}function Mw(s,t,r=ss()){return r("readwrite",n=>(n.put(t,s),Si(n.transaction)))}function Hw(s,t=ss()){return t("readwrite",r=>(r.delete(s),Si(r.transaction)))}function kw(s=ss()){return s("readwrite",t=>(t.clear(),Si(t.transaction)))}function Vw(s,t){return s.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},Si(s.transaction)}function Kw(s=ss()){return s("readonly",t=>{if(t.getAllKeys)return Si(t.getAllKeys());const r=[];return Vw(t,n=>r.push(n.key)).then(()=>r)})}const Gw="idb-keyval";var Ww=(s={})=>{const t=s.base&&s.base.length>0?`${s.base}:`:"",r=o=>t+o;let n;return s.dbName&&s.storeName&&(n=ep(s.dbName,s.storeName)),{name:Gw,options:s,async hasItem(o){return!(typeof await jl(r(o),n)>"u")},async getItem(o){return await jl(r(o),n)??null},setItem(o,c){return Mw(r(o),c,n)},removeItem(o){return Hw(r(o),n)},getKeys(){return Kw(n)},clear(){return kw(n)}}};const Jw="WALLET_CONNECT_V2_INDEXED_DB",Qw="keyvaluestorage";let Yw=class{constructor(){this.indexedDb=Uw({driver:Ww({dbName:Jw,storeName:Qw})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,is(r))}async removeItem(t){await this.indexedDb.removeItem(t)}};var xc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ro={exports:{}};(function(){let s;function t(){}s=t,s.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},s.prototype.setItem=function(r,n){this[r]=String(n)},s.prototype.removeItem=function(r){delete this[r]},s.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},s.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},s.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof xc<"u"&&xc.localStorage?Ro.exports=xc.localStorage:typeof window<"u"&&window.localStorage?Ro.exports=window.localStorage:Ro.exports=new t})();function Zw(s){var t;return[s[0],zo((t=s[1])!=null?t:"")]}let Xw=class{constructor(){this.localStorage=Ro.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Zw)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return zo(r)}async setItem(t,r){this.localStorage.setItem(t,is(r))}async removeItem(t){this.localStorage.removeItem(t)}};const eb="wc_storage_version",Bl=1,tb=async(s,t,r)=>{const n=eb,o=await t.getItem(n);if(o&&o>=Bl){r(t);return}const c=await s.getKeys();if(!c.length){r(t);return}const h=[];for(;c.length;){const p=c.shift();if(!p)continue;const f=p.toLowerCase();if(f.includes("wc@")||f.includes("walletconnect")||f.includes("wc_")||f.includes("wallet_connect")){const g=await s.getItem(p);await t.setItem(p,g),h.push(p)}}await t.setItem(n,Bl),r(t),rb(s,h)},rb=async(s,t)=>{t.length&&t.forEach(async r=>{await s.removeItem(r)})};let ib=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new Xw;this.storage=t;try{const r=new Yw;tb(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};var dn={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Jc=function(s,t){return Jc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)n.hasOwnProperty(o)&&(r[o]=n[o])},Jc(s,t)};function nb(s,t){Jc(s,t);function r(){this.constructor=s}s.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Qc=function(){return Qc=Object.assign||function(t){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&(t[c]=r[c])}return t},Qc.apply(this,arguments)};function sb(s,t){var r={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&t.indexOf(n)<0&&(r[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(s);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(s,n[o])&&(r[n[o]]=s[n[o]]);return r}function ob(s,t,r,n){var o=arguments.length,c=o<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(s,t,r,n);else for(var p=s.length-1;p>=0;p--)(h=s[p])&&(c=(o<3?h(c):o>3?h(t,r,c):h(t,r))||c);return o>3&&c&&Object.defineProperty(t,r,c),c}function ab(s,t){return function(r,n){t(r,n,s)}}function cb(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)}function ub(s,t,r,n){function o(c){return c instanceof r?c:new r(function(h){h(c)})}return new(r||(r=Promise))(function(c,h){function p(v){try{g(n.next(v))}catch(b){h(b)}}function f(v){try{g(n.throw(v))}catch(b){h(b)}}function g(v){v.done?c(v.value):o(v.value).then(p,f)}g((n=n.apply(s,t||[])).next())})}function hb(s,t){var r={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,o,c,h;return h={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function p(g){return function(v){return f([g,v])}}function f(g){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(c=g[0]&2?o.return:g[0]?o.throw||((c=o.return)&&c.call(o),0):o.next)&&!(c=c.call(o,g[1])).done)return c;switch(o=0,c&&(g=[g[0]&2,c.value]),g[0]){case 0:case 1:c=g;break;case 4:return r.label++,{value:g[1],done:!1};case 5:r.label++,o=g[1],g=[0];continue;case 7:g=r.ops.pop(),r.trys.pop();continue;default:if(c=r.trys,!(c=c.length>0&&c[c.length-1])&&(g[0]===6||g[0]===2)){r=0;continue}if(g[0]===3&&(!c||g[1]>c[0]&&g[1]<c[3])){r.label=g[1];break}if(g[0]===6&&r.label<c[1]){r.label=c[1],c=g;break}if(c&&r.label<c[2]){r.label=c[2],r.ops.push(g);break}c[2]&&r.ops.pop(),r.trys.pop();continue}g=t.call(s,r)}catch(v){g=[6,v],o=0}finally{n=c=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}function lb(s,t,r,n){n===void 0&&(n=r),s[n]=t[r]}function fb(s,t){for(var r in s)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=s[r])}function Yc(s){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&s[t],n=0;if(r)return r.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&n>=s.length&&(s=void 0),{value:s&&s[n++],done:!s}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function tp(s,t){var r=typeof Symbol=="function"&&s[Symbol.iterator];if(!r)return s;var n=r.call(s),o,c=[],h;try{for(;(t===void 0||t-- >0)&&!(o=n.next()).done;)c.push(o.value)}catch(p){h={error:p}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(h)throw h.error}}return c}function pb(){for(var s=[],t=0;t<arguments.length;t++)s=s.concat(tp(arguments[t]));return s}function db(){for(var s=0,t=0,r=arguments.length;t<r;t++)s+=arguments[t].length;for(var n=Array(s),o=0,t=0;t<r;t++)for(var c=arguments[t],h=0,p=c.length;h<p;h++,o++)n[o]=c[h];return n}function es(s){return this instanceof es?(this.v=s,this):new es(s)}function gb(s,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(s,t||[]),o,c=[];return o={},h("next"),h("throw"),h("return"),o[Symbol.asyncIterator]=function(){return this},o;function h(E){n[E]&&(o[E]=function(F){return new Promise(function(S,D){c.push([E,F,S,D])>1||p(E,F)})})}function p(E,F){try{f(n[E](F))}catch(S){b(c[0][3],S)}}function f(E){E.value instanceof es?Promise.resolve(E.value.v).then(g,v):b(c[0][2],E)}function g(E){p("next",E)}function v(E){p("throw",E)}function b(E,F){E(F),c.shift(),c.length&&p(c[0][0],c[0][1])}}function yb(s){var t,r;return t={},n("next"),n("throw",function(o){throw o}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(o,c){t[o]=s[o]?function(h){return(r=!r)?{value:es(s[o](h)),done:o==="return"}:c?c(h):h}:c}}function vb(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=s[Symbol.asyncIterator],r;return t?t.call(s):(s=typeof Yc=="function"?Yc(s):s[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(c){r[c]=s[c]&&function(h){return new Promise(function(p,f){h=s[c](h),o(p,f,h.done,h.value)})}}function o(c,h,p,f){Promise.resolve(f).then(function(g){c({value:g,done:p})},h)}}function mb(s,t){return Object.defineProperty?Object.defineProperty(s,"raw",{value:t}):s.raw=t,s}function wb(s){if(s&&s.__esModule)return s;var t={};if(s!=null)for(var r in s)Object.hasOwnProperty.call(s,r)&&(t[r]=s[r]);return t.default=s,t}function bb(s){return s&&s.__esModule?s:{default:s}}function _b(s,t){if(!t.has(s))throw new TypeError("attempted to get private field on non-instance");return t.get(s)}function Eb(s,t,r){if(!t.has(s))throw new TypeError("attempted to set private field on non-instance");return t.set(s,r),r}const Ib=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Qc},__asyncDelegator:yb,__asyncGenerator:gb,__asyncValues:vb,__await:es,__awaiter:ub,__classPrivateFieldGet:_b,__classPrivateFieldSet:Eb,__createBinding:lb,__decorate:ob,__exportStar:fb,__extends:nb,__generator:hb,__importDefault:bb,__importStar:wb,__makeTemplateObject:mb,__metadata:cb,__param:ab,__read:tp,__rest:sb,__spread:pb,__spreadArrays:db,__values:Yc},Symbol.toStringTag,{value:"Module"})),Bo=hu(Ib);var Mn={},Sc={},Hn={};class Fi{}const Pb=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Fi},Symbol.toStringTag,{value:"Module"})),xb=hu(Pb);var Ll;function Sb(){if(Ll)return Hn;Ll=1,Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.IHeartBeat=void 0;const s=xb;class t extends s.IEvents{constructor(n){super()}}return Hn.IHeartBeat=t,Hn}var Ul;function rp(){return Ul||(Ul=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),Bo.__exportStar(Sb(),s)}(Sc)),Sc}var Fc={},Ii={},Ml;function Fb(){if(Ml)return Ii;Ml=1,Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.HEARTBEAT_EVENTS=Ii.HEARTBEAT_INTERVAL=void 0;const s=G;return Ii.HEARTBEAT_INTERVAL=s.FIVE_SECONDS,Ii.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Ii}var Hl;function ip(){return Hl||(Hl=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),Bo.__exportStar(Fb(),s)}(Fc)),Fc}var kl;function Ab(){if(kl)return Mn;kl=1,Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.HeartBeat=void 0;const s=Bo,t=Qt,r=G,n=rp(),o=ip();class c extends n.IHeartBeat{constructor(p){super(p),this.events=new t.EventEmitter,this.interval=o.HEARTBEAT_INTERVAL,this.interval=(p==null?void 0:p.interval)||o.HEARTBEAT_INTERVAL}static init(p){return s.__awaiter(this,void 0,void 0,function*(){const f=new c(p);return yield f.init(),f})}init(){return s.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(p,f){this.events.on(p,f)}once(p,f){this.events.once(p,f)}off(p,f){this.events.off(p,f)}removeListener(p,f){this.events.removeListener(p,f)}initialize(){return s.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(o.HEARTBEAT_EVENTS.pulse)}}return Mn.HeartBeat=c,Mn}(function(s){Object.defineProperty(s,"__esModule",{value:!0});const t=Bo;t.__exportStar(Ab(),s),t.__exportStar(rp(),s),t.__exportStar(ip(),s)})(dn);function Ob(s){try{return JSON.stringify(s)}catch{return'"[Circular]"'}}var $b=Cb;function Cb(s,t,r){var n=r&&r.stringify||Ob,o=1;if(typeof s=="object"&&s!==null){var c=t.length+o;if(c===1)return s;var h=new Array(c);h[0]=n(s);for(var p=1;p<c;p++)h[p]=n(t[p]);return h.join(" ")}if(typeof s!="string")return s;var f=t.length;if(f===0)return s;for(var g="",v=1-o,b=-1,E=s&&s.length||0,F=0;F<E;){if(s.charCodeAt(F)===37&&F+1<E){switch(b=b>-1?b:0,s.charCodeAt(F+1)){case 100:case 102:if(v>=f||t[v]==null)break;b<F&&(g+=s.slice(b,F)),g+=Number(t[v]),b=F+2,F++;break;case 105:if(v>=f||t[v]==null)break;b<F&&(g+=s.slice(b,F)),g+=Math.floor(Number(t[v])),b=F+2,F++;break;case 79:case 111:case 106:if(v>=f||t[v]===void 0)break;b<F&&(g+=s.slice(b,F));var S=typeof t[v];if(S==="string"){g+="'"+t[v]+"'",b=F+2,F++;break}if(S==="function"){g+=t[v].name||"<anonymous>",b=F+2,F++;break}g+=n(t[v]),b=F+2,F++;break;case 115:if(v>=f)break;b<F&&(g+=s.slice(b,F)),g+=String(t[v]),b=F+2,F++;break;case 37:b<F&&(g+=s.slice(b,F)),g+="%",b=F+2,F++,v--;break}++v}++F}return b===-1?s:(b<E&&(g+=s.slice(b)),g)}const Vl=$b;var Rb=vr;const ts=Mb().console||{},Tb={mapHttpRequest:Eo,mapHttpResponse:Eo,wrapRequestSerializer:Ac,wrapResponseSerializer:Ac,wrapErrorSerializer:Ac,req:Eo,res:Eo,err:jb};function Nb(s,t){return Array.isArray(s)?s.filter(function(n){return n!=="!stdSerializers.err"}):s===!0?Object.keys(t):!1}function vr(s){s=s||{},s.browser=s.browser||{};const t=s.browser.transmit;if(t&&typeof t.send!="function")throw Error("pino: transmit option must have a send function");const r=s.browser.write||ts;s.browser.write&&(s.browser.asObject=!0);const n=s.serializers||{},o=Nb(s.browser.serialize,n);let c=s.browser.serialize;Array.isArray(s.browser.serialize)&&s.browser.serialize.indexOf("!stdSerializers.err")>-1&&(c=!1);const h=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),s.enabled===!1&&(s.level="silent");const p=s.level||"info",f=Object.create(r);f.log||(f.log=rs),Object.defineProperty(f,"levelVal",{get:v}),Object.defineProperty(f,"level",{get:b,set:E});const g={transmit:t,serialize:o,asObject:s.browser.asObject,levels:h,timestamp:Bb(s)};f.levels=vr.levels,f.level=p,f.setMaxListeners=f.getMaxListeners=f.emit=f.addListener=f.on=f.prependListener=f.once=f.prependOnceListener=f.removeListener=f.removeAllListeners=f.listeners=f.listenerCount=f.eventNames=f.write=f.flush=rs,f.serializers=n,f._serialize=o,f._stdErrSerialize=c,f.child=F,t&&(f._logEvent=Zc());function v(){return this.level==="silent"?1/0:this.levels.values[this.level]}function b(){return this._level}function E(S){if(S!=="silent"&&!this.levels.values[S])throw Error("unknown level "+S);this._level=S,on(g,f,"error","log"),on(g,f,"fatal","error"),on(g,f,"warn","error"),on(g,f,"info","log"),on(g,f,"debug","log"),on(g,f,"trace","log")}function F(S,D){if(!S)throw new Error("missing bindings for child Pino");D=D||{},o&&S.serializers&&(D.serializers=S.serializers);const H=D.serializers;if(o&&H){var M=Object.assign({},n,H),Q=s.browser.serialize===!0?Object.keys(M):o;delete S.serializers,Lo([S],Q,M,this._stdErrSerialize)}function T(j){this._childLevel=(j._childLevel|0)+1,this.error=an(j,S,"error"),this.fatal=an(j,S,"fatal"),this.warn=an(j,S,"warn"),this.info=an(j,S,"info"),this.debug=an(j,S,"debug"),this.trace=an(j,S,"trace"),M&&(this.serializers=M,this._serialize=Q),t&&(this._logEvent=Zc([].concat(j._logEvent.bindings,S)))}return T.prototype=this,new T(this)}return f}vr.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};vr.stdSerializers=Tb;vr.stdTimeFunctions=Object.assign({},{nullTime:np,epochTime:sp,unixTime:Lb,isoTime:Ub});function on(s,t,r,n){const o=Object.getPrototypeOf(t);t[r]=t.levelVal>t.levels.values[r]?rs:o[r]?o[r]:ts[r]||ts[n]||rs,Db(s,t,r)}function Db(s,t,r){!s.transmit&&t[r]===rs||(t[r]=function(n){return function(){const c=s.timestamp(),h=new Array(arguments.length),p=Object.getPrototypeOf&&Object.getPrototypeOf(this)===ts?ts:this;for(var f=0;f<h.length;f++)h[f]=arguments[f];if(s.serialize&&!s.asObject&&Lo(h,this._serialize,this.serializers,this._stdErrSerialize),s.asObject?n.call(p,qb(this,r,h,c)):n.apply(p,h),s.transmit){const g=s.transmit.level||t.level,v=vr.levels.values[g],b=vr.levels.values[r];if(b<v)return;zb(this,{ts:c,methodLevel:r,methodValue:b,transmitLevel:g,transmitValue:vr.levels.values[s.transmit.level||t.level],send:s.transmit.send,val:t.levelVal},h)}}}(t[r]))}function qb(s,t,r,n){s._serialize&&Lo(r,s._serialize,s.serializers,s._stdErrSerialize);const o=r.slice();let c=o[0];const h={};n&&(h.time=n),h.level=vr.levels.values[t];let p=(s._childLevel|0)+1;if(p<1&&(p=1),c!==null&&typeof c=="object"){for(;p--&&typeof o[0]=="object";)Object.assign(h,o.shift());c=o.length?Vl(o.shift(),o):void 0}else typeof c=="string"&&(c=Vl(o.shift(),o));return c!==void 0&&(h.msg=c),h}function Lo(s,t,r,n){for(const o in s)if(n&&s[o]instanceof Error)s[o]=vr.stdSerializers.err(s[o]);else if(typeof s[o]=="object"&&!Array.isArray(s[o]))for(const c in s[o])t&&t.indexOf(c)>-1&&c in r&&(s[o][c]=r[c](s[o][c]))}function an(s,t,r){return function(){const n=new Array(1+arguments.length);n[0]=t;for(var o=1;o<n.length;o++)n[o]=arguments[o-1];return s[r].apply(this,n)}}function zb(s,t,r){const n=t.send,o=t.ts,c=t.methodLevel,h=t.methodValue,p=t.val,f=s._logEvent.bindings;Lo(r,s._serialize||Object.keys(s.serializers),s.serializers,s._stdErrSerialize===void 0?!0:s._stdErrSerialize),s._logEvent.ts=o,s._logEvent.messages=r.filter(function(g){return f.indexOf(g)===-1}),s._logEvent.level.label=c,s._logEvent.level.value=h,n(c,s._logEvent,p),s._logEvent=Zc(f)}function Zc(s){return{ts:0,messages:[],bindings:s||[],level:{label:"",value:0}}}function jb(s){const t={type:s.constructor.name,msg:s.message,stack:s.stack};for(const r in s)t[r]===void 0&&(t[r]=s[r]);return t}function Bb(s){return typeof s.timestamp=="function"?s.timestamp:s.timestamp===!1?np:sp}function Eo(){return{}}function Ac(s){return s}function rs(){}function np(){return!1}function sp(){return Date.now()}function Lb(){return Math.round(Date.now()/1e3)}function Ub(){return new Date(Date.now()).toISOString()}function Mb(){function s(t){return typeof t<"u"&&t}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return s(self)||s(window)||s(this)||{}}}const Uo=lu(Rb),Hb={level:"info"},os="custom_context";var kb=Object.defineProperty,Vb=Object.defineProperties,Kb=Object.getOwnPropertyDescriptors,Kl=Object.getOwnPropertySymbols,Gb=Object.prototype.hasOwnProperty,Wb=Object.prototype.propertyIsEnumerable,Gl=(s,t,r)=>t in s?kb(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Jb=(s,t)=>{for(var r in t||(t={}))Gb.call(t,r)&&Gl(s,r,t[r]);if(Kl)for(var r of Kl(t))Wb.call(t,r)&&Gl(s,r,t[r]);return s},Qb=(s,t)=>Vb(s,Kb(t));function Mo(s){return Qb(Jb({},s),{level:(s==null?void 0:s.level)||Hb.level})}function Yb(s,t=os){return s[t]||""}function Zb(s,t,r=os){return s[r]=t,s}function It(s,t=os){let r="";return typeof s.bindings>"u"?r=Yb(s,t):r=s.bindings().context||"",r}function Xb(s,t,r=os){const n=It(s,r);return n.trim()?`${n}/${t}`:t}function Pt(s,t,r=os){const n=Xb(s,t,r),o=s.child({context:n});return Zb(o,n,r)}class e_ extends Fi{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}let t_=class extends Fi{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}},r_=class{constructor(t,r){this.logger=t,this.core=r}},i_=class extends Fi{constructor(t,r){super(),this.relayer=t,this.logger=r}},n_=class extends Fi{constructor(t){super()}},s_=class{constructor(t,r,n,o){this.core=t,this.logger=r,this.name=n}};class o_ extends Fi{constructor(t,r){super(),this.relayer=t,this.logger=r}}let a_=class extends Fi{constructor(t,r){super(),this.core=t,this.logger=r}},c_=class{constructor(t,r){this.projectId=t,this.logger=r}},u_=class{constructor(t,r){this.projectId=t,this.logger=r}},h_=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},l_=class{constructor(t){this.client=t}};function f_(s){return s instanceof Uint8Array||ArrayBuffer.isView(s)&&s.constructor.name==="Uint8Array"}function op(s,...t){if(!f_(s))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(s.length))throw new Error("Uint8Array expected of length "+t+", got length="+s.length)}function Wl(s,t=!0){if(s.destroyed)throw new Error("Hash instance has been destroyed");if(t&&s.finished)throw new Error("Hash#digest() has already been called")}function p_(s,t){op(s);const r=t.outputLen;if(s.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const cn=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Oc=s=>new DataView(s.buffer,s.byteOffset,s.byteLength);function d_(s){if(typeof s!="string")throw new Error("utf8ToBytes expected string, got "+typeof s);return new Uint8Array(new TextEncoder().encode(s))}function ap(s){return typeof s=="string"&&(s=d_(s)),op(s),s}class g_{clone(){return this._cloneInto()}}function y_(s){const t=n=>s().update(ap(n)).digest(),r=s();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>s(),t}function cp(s=32){if(cn&&typeof cn.getRandomValues=="function")return cn.getRandomValues(new Uint8Array(s));if(cn&&typeof cn.randomBytes=="function")return cn.randomBytes(s);throw new Error("crypto.getRandomValues must be defined")}function v_(s,t,r,n){if(typeof s.setBigUint64=="function")return s.setBigUint64(t,r,n);const o=BigInt(32),c=BigInt(4294967295),h=Number(r>>o&c),p=Number(r&c),f=n?4:0,g=n?0:4;s.setUint32(t+f,h,n),s.setUint32(t+g,p,n)}class m_ extends g_{constructor(t,r,n,o){super(),this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Oc(this.buffer)}update(t){Wl(this);const{view:r,buffer:n,blockLen:o}=this;t=ap(t);const c=t.length;for(let h=0;h<c;){const p=Math.min(o-this.pos,c-h);if(p===o){const f=Oc(t);for(;o<=c-h;h+=o)this.process(f,h);continue}n.set(t.subarray(h,h+p),this.pos),this.pos+=p,h+=p,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Wl(this),p_(t,this),this.finished=!0;const{buffer:r,view:n,blockLen:o,isLE:c}=this;let{pos:h}=this;r[h++]=128,this.buffer.subarray(h).fill(0),this.padOffset>o-h&&(this.process(n,0),h=0);for(let b=h;b<o;b++)r[b]=0;v_(n,o-8,BigInt(this.length*8),c),this.process(n,0);const p=Oc(t),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const g=f/4,v=this.get();if(g>v.length)throw new Error("_sha2: outputLen bigger than state");for(let b=0;b<g;b++)p.setUint32(4*b,v[b],c)}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:r,buffer:n,length:o,finished:c,destroyed:h,pos:p}=this;return t.length=o,t.pos=p,t.finished=c,t.destroyed=h,o%r&&t.buffer.set(n),t}}const Io=BigInt(2**32-1),Xc=BigInt(32);function up(s,t=!1){return t?{h:Number(s&Io),l:Number(s>>Xc&Io)}:{h:Number(s>>Xc&Io)|0,l:Number(s&Io)|0}}function w_(s,t=!1){let r=new Uint32Array(s.length),n=new Uint32Array(s.length);for(let o=0;o<s.length;o++){const{h:c,l:h}=up(s[o],t);[r[o],n[o]]=[c,h]}return[r,n]}const b_=(s,t)=>BigInt(s>>>0)<<Xc|BigInt(t>>>0),__=(s,t,r)=>s>>>r,E_=(s,t,r)=>s<<32-r|t>>>r,I_=(s,t,r)=>s>>>r|t<<32-r,P_=(s,t,r)=>s<<32-r|t>>>r,x_=(s,t,r)=>s<<64-r|t>>>r-32,S_=(s,t,r)=>s>>>r-32|t<<64-r,F_=(s,t)=>t,A_=(s,t)=>s,O_=(s,t,r)=>s<<r|t>>>32-r,$_=(s,t,r)=>t<<r|s>>>32-r,C_=(s,t,r)=>t<<r-32|s>>>64-r,R_=(s,t,r)=>s<<r-32|t>>>64-r;function T_(s,t,r,n){const o=(t>>>0)+(n>>>0);return{h:s+r+(o/2**32|0)|0,l:o|0}}const N_=(s,t,r)=>(s>>>0)+(t>>>0)+(r>>>0),D_=(s,t,r,n)=>t+r+n+(s/2**32|0)|0,q_=(s,t,r,n)=>(s>>>0)+(t>>>0)+(r>>>0)+(n>>>0),z_=(s,t,r,n,o)=>t+r+n+o+(s/2**32|0)|0,j_=(s,t,r,n,o)=>(s>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(o>>>0),B_=(s,t,r,n,o,c)=>t+r+n+o+c+(s/2**32|0)|0,ue={fromBig:up,split:w_,toBig:b_,shrSH:__,shrSL:E_,rotrSH:I_,rotrSL:P_,rotrBH:x_,rotrBL:S_,rotr32H:F_,rotr32L:A_,rotlSH:O_,rotlSL:$_,rotlBH:C_,rotlBL:R_,add:T_,add3L:N_,add3H:D_,add4L:q_,add4H:z_,add5H:B_,add5L:j_},[L_,U_]=(()=>ue.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(s=>BigInt(s))))(),Xr=new Uint32Array(80),ei=new Uint32Array(80);class M_ extends m_{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:t,Al:r,Bh:n,Bl:o,Ch:c,Cl:h,Dh:p,Dl:f,Eh:g,El:v,Fh:b,Fl:E,Gh:F,Gl:S,Hh:D,Hl:H}=this;return[t,r,n,o,c,h,p,f,g,v,b,E,F,S,D,H]}set(t,r,n,o,c,h,p,f,g,v,b,E,F,S,D,H){this.Ah=t|0,this.Al=r|0,this.Bh=n|0,this.Bl=o|0,this.Ch=c|0,this.Cl=h|0,this.Dh=p|0,this.Dl=f|0,this.Eh=g|0,this.El=v|0,this.Fh=b|0,this.Fl=E|0,this.Gh=F|0,this.Gl=S|0,this.Hh=D|0,this.Hl=H|0}process(t,r){for(let T=0;T<16;T++,r+=4)Xr[T]=t.getUint32(r),ei[T]=t.getUint32(r+=4);for(let T=16;T<80;T++){const j=Xr[T-15]|0,W=ei[T-15]|0,le=ue.rotrSH(j,W,1)^ue.rotrSH(j,W,8)^ue.shrSH(j,W,7),re=ue.rotrSL(j,W,1)^ue.rotrSL(j,W,8)^ue.shrSL(j,W,7),oe=Xr[T-2]|0,we=ei[T-2]|0,qt=ue.rotrSH(oe,we,19)^ue.rotrBH(oe,we,61)^ue.shrSH(oe,we,6),zt=ue.rotrSL(oe,we,19)^ue.rotrBL(oe,we,61)^ue.shrSL(oe,we,6),xt=ue.add4L(re,zt,ei[T-7],ei[T-16]),mr=ue.add4H(xt,le,qt,Xr[T-7],Xr[T-16]);Xr[T]=mr|0,ei[T]=xt|0}let{Ah:n,Al:o,Bh:c,Bl:h,Ch:p,Cl:f,Dh:g,Dl:v,Eh:b,El:E,Fh:F,Fl:S,Gh:D,Gl:H,Hh:M,Hl:Q}=this;for(let T=0;T<80;T++){const j=ue.rotrSH(b,E,14)^ue.rotrSH(b,E,18)^ue.rotrBH(b,E,41),W=ue.rotrSL(b,E,14)^ue.rotrSL(b,E,18)^ue.rotrBL(b,E,41),le=b&F^~b&D,re=E&S^~E&H,oe=ue.add5L(Q,W,re,U_[T],ei[T]),we=ue.add5H(oe,M,j,le,L_[T],Xr[T]),qt=oe|0,zt=ue.rotrSH(n,o,28)^ue.rotrBH(n,o,34)^ue.rotrBH(n,o,39),xt=ue.rotrSL(n,o,28)^ue.rotrBL(n,o,34)^ue.rotrBL(n,o,39),mr=n&c^n&p^c&p,Br=o&h^o&f^h&f;M=D|0,Q=H|0,D=F|0,H=S|0,F=b|0,S=E|0,{h:b,l:E}=ue.add(g|0,v|0,we|0,qt|0),g=p|0,v=f|0,p=c|0,f=h|0,c=n|0,h=o|0;const ee=ue.add3L(qt,xt,Br);n=ue.add3H(ee,we,zt,mr),o=ee|0}({h:n,l:o}=ue.add(this.Ah|0,this.Al|0,n|0,o|0)),{h:c,l:h}=ue.add(this.Bh|0,this.Bl|0,c|0,h|0),{h:p,l:f}=ue.add(this.Ch|0,this.Cl|0,p|0,f|0),{h:g,l:v}=ue.add(this.Dh|0,this.Dl|0,g|0,v|0),{h:b,l:E}=ue.add(this.Eh|0,this.El|0,b|0,E|0),{h:F,l:S}=ue.add(this.Fh|0,this.Fl|0,F|0,S|0),{h:D,l:H}=ue.add(this.Gh|0,this.Gl|0,D|0,H|0),{h:M,l:Q}=ue.add(this.Hh|0,this.Hl|0,M|0,Q|0),this.set(n,o,c,h,p,f,g,v,b,E,F,S,D,H,M,Q)}roundClean(){Xr.fill(0),ei.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const H_=y_(()=>new M_);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const yu=BigInt(0),hp=BigInt(1),k_=BigInt(2);function vu(s){return s instanceof Uint8Array||ArrayBuffer.isView(s)&&s.constructor.name==="Uint8Array"}function mu(s){if(!vu(s))throw new Error("Uint8Array expected")}function $c(s,t){if(typeof t!="boolean")throw new Error(s+" boolean expected, got "+t)}const V_=Array.from({length:256},(s,t)=>t.toString(16).padStart(2,"0"));function wu(s){mu(s);let t="";for(let r=0;r<s.length;r++)t+=V_[s[r]];return t}function lp(s){if(typeof s!="string")throw new Error("hex string expected, got "+typeof s);return s===""?yu:BigInt("0x"+s)}const Nr={_0:48,_9:57,A:65,F:70,a:97,f:102};function Jl(s){if(s>=Nr._0&&s<=Nr._9)return s-Nr._0;if(s>=Nr.A&&s<=Nr.F)return s-(Nr.A-10);if(s>=Nr.a&&s<=Nr.f)return s-(Nr.a-10)}function fp(s){if(typeof s!="string")throw new Error("hex string expected, got "+typeof s);const t=s.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let o=0,c=0;o<r;o++,c+=2){const h=Jl(s.charCodeAt(c)),p=Jl(s.charCodeAt(c+1));if(h===void 0||p===void 0){const f=s[c]+s[c+1];throw new Error('hex string expected, got non-hex character "'+f+'" at index '+c)}n[o]=h*16+p}return n}function K_(s){return lp(wu(s))}function To(s){return mu(s),lp(wu(Uint8Array.from(s).reverse()))}function pp(s,t){return fp(s.toString(16).padStart(t*2,"0"))}function eu(s,t){return pp(s,t).reverse()}function Dr(s,t,r){let n;if(typeof t=="string")try{n=fp(t)}catch(c){throw new Error(s+" must be hex string or Uint8Array, cause: "+c)}else if(vu(t))n=Uint8Array.from(t);else throw new Error(s+" must be hex string or Uint8Array");const o=n.length;if(typeof r=="number"&&o!==r)throw new Error(s+" of length "+r+" expected, got "+o);return n}function Ql(...s){let t=0;for(let n=0;n<s.length;n++){const o=s[n];mu(o),t+=o.length}const r=new Uint8Array(t);for(let n=0,o=0;n<s.length;n++){const c=s[n];r.set(c,o),o+=c.length}return r}const Cc=s=>typeof s=="bigint"&&yu<=s;function G_(s,t,r){return Cc(s)&&Cc(t)&&Cc(r)&&t<=s&&s<r}function kn(s,t,r,n){if(!G_(t,r,n))throw new Error("expected valid "+s+": "+r+" <= n < "+n+", got "+t)}function W_(s){let t;for(t=0;s>yu;s>>=hp,t+=1);return t}const J_=s=>(k_<<BigInt(s-1))-hp,Q_={bigint:s=>typeof s=="bigint",function:s=>typeof s=="function",boolean:s=>typeof s=="boolean",string:s=>typeof s=="string",stringOrUint8Array:s=>typeof s=="string"||vu(s),isSafeInteger:s=>Number.isSafeInteger(s),array:s=>Array.isArray(s),field:(s,t)=>t.Fp.isValid(s),hash:s=>typeof s=="function"&&Number.isSafeInteger(s.outputLen)};function bu(s,t,r={}){const n=(o,c,h)=>{const p=Q_[c];if(typeof p!="function")throw new Error("invalid validator function");const f=s[o];if(!(h&&f===void 0)&&!p(f,s))throw new Error("param "+String(o)+" is invalid. Expected "+c+", got "+f)};for(const[o,c]of Object.entries(t))n(o,c,!1);for(const[o,c]of Object.entries(r))n(o,c,!0);return s}function Yl(s){const t=new WeakMap;return(r,...n)=>{const o=t.get(r);if(o!==void 0)return o;const c=s(r,...n);return t.set(r,c),c}}const Ze=BigInt(0),Me=BigInt(1),Pi=BigInt(2),Y_=BigInt(3),tu=BigInt(4),Zl=BigInt(5),Xl=BigInt(8);function We(s,t){const r=s%t;return r>=Ze?r:t+r}function Z_(s,t,r){if(t<Ze)throw new Error("invalid exponent, negatives unsupported");if(r<=Ze)throw new Error("invalid modulus");if(r===Me)return Ze;let n=Me;for(;t>Ze;)t&Me&&(n=n*s%r),s=s*s%r,t>>=Me;return n}function gr(s,t,r){let n=s;for(;t-- >Ze;)n*=n,n%=r;return n}function ef(s,t){if(s===Ze)throw new Error("invert: expected non-zero number");if(t<=Ze)throw new Error("invert: expected positive modulus, got "+t);let r=We(s,t),n=t,o=Ze,c=Me;for(;r!==Ze;){const h=n/r,p=n%r,f=o-c*h;n=r,r=p,o=c,c=f}if(n!==Me)throw new Error("invert: does not exist");return We(o,t)}function X_(s){const t=(s-Me)/Pi;let r,n,o;for(r=s-Me,n=0;r%Pi===Ze;r/=Pi,n++);for(o=Pi;o<s&&Z_(o,t,s)!==s-Me;o++)if(o>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const h=(s+Me)/tu;return function(p,f){const g=p.pow(f,h);if(!p.eql(p.sqr(g),f))throw new Error("Cannot find square root");return g}}const c=(r+Me)/Pi;return function(h,p){if(h.pow(p,t)===h.neg(h.ONE))throw new Error("Cannot find square root");let f=n,g=h.pow(h.mul(h.ONE,o),r),v=h.pow(p,c),b=h.pow(p,r);for(;!h.eql(b,h.ONE);){if(h.eql(b,h.ZERO))return h.ZERO;let E=1;for(let S=h.sqr(b);E<f&&!h.eql(S,h.ONE);E++)S=h.sqr(S);const F=h.pow(g,Me<<BigInt(f-E-1));g=h.sqr(F),v=h.mul(v,F),b=h.mul(b,g),f=E}return v}}function eE(s){if(s%tu===Y_){const t=(s+Me)/tu;return function(r,n){const o=r.pow(n,t);if(!r.eql(r.sqr(o),n))throw new Error("Cannot find square root");return o}}if(s%Xl===Zl){const t=(s-Zl)/Xl;return function(r,n){const o=r.mul(n,Pi),c=r.pow(o,t),h=r.mul(n,c),p=r.mul(r.mul(h,Pi),c),f=r.mul(h,r.sub(p,r.ONE));if(!r.eql(r.sqr(f),n))throw new Error("Cannot find square root");return f}}return X_(s)}const tE=(s,t)=>(We(s,t)&Me)===Me,rE=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function iE(s){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=rE.reduce((n,o)=>(n[o]="function",n),t);return bu(s,r)}function nE(s,t,r){if(r<Ze)throw new Error("invalid exponent, negatives unsupported");if(r===Ze)return s.ONE;if(r===Me)return t;let n=s.ONE,o=t;for(;r>Ze;)r&Me&&(n=s.mul(n,o)),o=s.sqr(o),r>>=Me;return n}function sE(s,t){const r=new Array(t.length),n=t.reduce((c,h,p)=>s.is0(h)?c:(r[p]=c,s.mul(c,h)),s.ONE),o=s.inv(n);return t.reduceRight((c,h,p)=>s.is0(h)?c:(r[p]=s.mul(c,r[p]),s.mul(c,h)),o),r}function dp(s,t){const r=t!==void 0?t:s.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function gp(s,t,r=!1,n={}){if(s<=Ze)throw new Error("invalid field: expected ORDER > 0, got "+s);const{nBitLength:o,nByteLength:c}=dp(s,t);if(c>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let h;const p=Object.freeze({ORDER:s,isLE:r,BITS:o,BYTES:c,MASK:J_(o),ZERO:Ze,ONE:Me,create:f=>We(f,s),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return Ze<=f&&f<s},is0:f=>f===Ze,isOdd:f=>(f&Me)===Me,neg:f=>We(-f,s),eql:(f,g)=>f===g,sqr:f=>We(f*f,s),add:(f,g)=>We(f+g,s),sub:(f,g)=>We(f-g,s),mul:(f,g)=>We(f*g,s),pow:(f,g)=>nE(p,f,g),div:(f,g)=>We(f*ef(g,s),s),sqrN:f=>f*f,addN:(f,g)=>f+g,subN:(f,g)=>f-g,mulN:(f,g)=>f*g,inv:f=>ef(f,s),sqrt:n.sqrt||(f=>(h||(h=eE(s)),h(p,f))),invertBatch:f=>sE(p,f),cmov:(f,g,v)=>v?g:f,toBytes:f=>r?eu(f,c):pp(f,c),fromBytes:f=>{if(f.length!==c)throw new Error("Field.fromBytes: expected "+c+" bytes, got "+f.length);return r?To(f):K_(f)}});return Object.freeze(p)}const tf=BigInt(0),Po=BigInt(1);function Rc(s,t){const r=t.negate();return s?r:t}function yp(s,t){if(!Number.isSafeInteger(s)||s<=0||s>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+s)}function Tc(s,t){yp(s,t);const r=Math.ceil(t/s)+1,n=2**(s-1);return{windows:r,windowSize:n}}function oE(s,t){if(!Array.isArray(s))throw new Error("array expected");s.forEach((r,n)=>{if(!(r instanceof t))throw new Error("invalid point at index "+n)})}function aE(s,t){if(!Array.isArray(s))throw new Error("array of scalars expected");s.forEach((r,n)=>{if(!t.isValid(r))throw new Error("invalid scalar at index "+n)})}const Nc=new WeakMap,vp=new WeakMap;function Dc(s){return vp.get(s)||1}function cE(s,t){return{constTimeNegate:Rc,hasPrecomputes(r){return Dc(r)!==1},unsafeLadder(r,n,o=s.ZERO){let c=r;for(;n>tf;)n&Po&&(o=o.add(c)),c=c.double(),n>>=Po;return o},precomputeWindow(r,n){const{windows:o,windowSize:c}=Tc(n,t),h=[];let p=r,f=p;for(let g=0;g<o;g++){f=p,h.push(f);for(let v=1;v<c;v++)f=f.add(p),h.push(f);p=f.double()}return h},wNAF(r,n,o){const{windows:c,windowSize:h}=Tc(r,t);let p=s.ZERO,f=s.BASE;const g=BigInt(2**r-1),v=2**r,b=BigInt(r);for(let E=0;E<c;E++){const F=E*h;let S=Number(o&g);o>>=b,S>h&&(S-=v,o+=Po);const D=F,H=F+Math.abs(S)-1,M=E%2!==0,Q=S<0;S===0?f=f.add(Rc(M,n[D])):p=p.add(Rc(Q,n[H]))}return{p,f}},wNAFUnsafe(r,n,o,c=s.ZERO){const{windows:h,windowSize:p}=Tc(r,t),f=BigInt(2**r-1),g=2**r,v=BigInt(r);for(let b=0;b<h;b++){const E=b*p;if(o===tf)break;let F=Number(o&f);if(o>>=v,F>p&&(F-=g,o+=Po),F===0)continue;let S=n[E+Math.abs(F)-1];F<0&&(S=S.negate()),c=c.add(S)}return c},getPrecomputes(r,n,o){let c=Nc.get(n);return c||(c=this.precomputeWindow(n,r),r!==1&&Nc.set(n,o(c))),c},wNAFCached(r,n,o){const c=Dc(r);return this.wNAF(c,this.getPrecomputes(c,r,o),n)},wNAFCachedUnsafe(r,n,o,c){const h=Dc(r);return h===1?this.unsafeLadder(r,n,c):this.wNAFUnsafe(h,this.getPrecomputes(h,r,o),n,c)},setWindowSize(r,n){yp(n,t),vp.set(r,n),Nc.delete(r)}}}function uE(s,t,r,n){if(oE(r,s),aE(n,t),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const o=s.ZERO,c=W_(BigInt(r.length)),h=c>12?c-3:c>4?c-2:c?2:1,p=(1<<h)-1,f=new Array(p+1).fill(o),g=Math.floor((t.BITS-1)/h)*h;let v=o;for(let b=g;b>=0;b-=h){f.fill(o);for(let F=0;F<n.length;F++){const S=n[F],D=Number(S>>BigInt(b)&BigInt(p));f[D]=f[D].add(r[F])}let E=o;for(let F=f.length-1,S=o;F>0;F--)S=S.add(f[F]),E=E.add(S);if(v=v.add(E),b!==0)for(let F=0;F<h;F++)v=v.double()}return v}function hE(s){return iE(s.Fp),bu(s,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...dp(s.n,s.nBitLength),...s,p:s.Fp.ORDER})}const ir=BigInt(0),wt=BigInt(1),xo=BigInt(2),lE=BigInt(8),fE={zip215:!0};function pE(s){const t=hE(s);return bu(s,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}function dE(s){const t=pE(s),{Fp:r,n,prehash:o,hash:c,randomBytes:h,nByteLength:p,h:f}=t,g=xo<<BigInt(p*8)-wt,v=r.create,b=gp(t.n,t.nBitLength),E=t.uvRatio||((ee,q)=>{try{return{isValid:!0,value:r.sqrt(ee*r.inv(q))}}catch{return{isValid:!1,value:ir}}}),F=t.adjustScalarBytes||(ee=>ee),S=t.domain||((ee,q,V)=>{if($c("phflag",V),q.length||V)throw new Error("Contexts/pre-hash are not supported");return ee});function D(ee,q){kn("coordinate "+ee,q,ir,g)}function H(ee){if(!(ee instanceof T))throw new Error("ExtendedPoint expected")}const M=Yl((ee,q)=>{const{ex:V,ey:K,ez:de}=ee,fe=ee.is0();q==null&&(q=fe?lE:r.inv(de));const ae=v(V*q),Ae=v(K*q),be=v(de*q);if(fe)return{x:ir,y:wt};if(be!==wt)throw new Error("invZ was invalid");return{x:ae,y:Ae}}),Q=Yl(ee=>{const{a:q,d:V}=t;if(ee.is0())throw new Error("bad point: ZERO");const{ex:K,ey:de,ez:fe,et:ae}=ee,Ae=v(K*K),be=v(de*de),Oe=v(fe*fe),Y=v(Oe*Oe),qe=v(Ae*q),St=v(Oe*v(qe+be)),$e=v(Y+v(V*v(Ae*be)));if(St!==$e)throw new Error("bad point: equation left != right (1)");const je=v(K*de),Ft=v(fe*ae);if(je!==Ft)throw new Error("bad point: equation left != right (2)");return!0});class T{constructor(q,V,K,de){this.ex=q,this.ey=V,this.ez=K,this.et=de,D("x",q),D("y",V),D("z",K),D("t",de),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(q){if(q instanceof T)throw new Error("extended point not allowed");const{x:V,y:K}=q||{};return D("x",V),D("y",K),new T(V,K,wt,v(V*K))}static normalizeZ(q){const V=r.invertBatch(q.map(K=>K.ez));return q.map((K,de)=>K.toAffine(V[de])).map(T.fromAffine)}static msm(q,V){return uE(T,b,q,V)}_setWindowSize(q){le.setWindowSize(this,q)}assertValidity(){Q(this)}equals(q){H(q);const{ex:V,ey:K,ez:de}=this,{ex:fe,ey:ae,ez:Ae}=q,be=v(V*Ae),Oe=v(fe*de),Y=v(K*Ae),qe=v(ae*de);return be===Oe&&Y===qe}is0(){return this.equals(T.ZERO)}negate(){return new T(v(-this.ex),this.ey,this.ez,v(-this.et))}double(){const{a:q}=t,{ex:V,ey:K,ez:de}=this,fe=v(V*V),ae=v(K*K),Ae=v(xo*v(de*de)),be=v(q*fe),Oe=V+K,Y=v(v(Oe*Oe)-fe-ae),qe=be+ae,St=qe-Ae,$e=be-ae,je=v(Y*St),Ft=v(qe*$e),ut=v(Y*$e),At=v(St*qe);return new T(je,Ft,At,ut)}add(q){H(q);const{a:V,d:K}=t,{ex:de,ey:fe,ez:ae,et:Ae}=this,{ex:be,ey:Oe,ez:Y,et:qe}=q;if(V===BigInt(-1)){const $i=v((fe-de)*(Oe+be)),ar=v((fe+de)*(Oe-be)),et=v(ar-$i);if(et===ir)return this.double();const cr=v(ae*xo*qe),br=v(Ae*xo*Y),Ci=br+cr,ur=ar+$i,Ri=br-cr,jt=v(Ci*et),Bt=v(ur*Ri),Ur=v(Ci*Ri),nt=v(et*ur);return new T(jt,Bt,nt,Ur)}const St=v(de*be),$e=v(fe*Oe),je=v(Ae*K*qe),Ft=v(ae*Y),ut=v((de+fe)*(be+Oe)-St-$e),At=Ft-je,Lr=Ft+je,Xe=v($e-V*St),wr=v(ut*At),gn=v(Lr*Xe),Ot=v(ut*Xe),Oi=v(At*Lr);return new T(wr,gn,Oi,Ot)}subtract(q){return this.add(q.negate())}wNAF(q){return le.wNAFCached(this,q,T.normalizeZ)}multiply(q){const V=q;kn("scalar",V,wt,n);const{p:K,f:de}=this.wNAF(V);return T.normalizeZ([K,de])[0]}multiplyUnsafe(q,V=T.ZERO){const K=q;return kn("scalar",K,ir,n),K===ir?W:this.is0()||K===wt?this:le.wNAFCachedUnsafe(this,K,T.normalizeZ,V)}isSmallOrder(){return this.multiplyUnsafe(f).is0()}isTorsionFree(){return le.unsafeLadder(this,n).is0()}toAffine(q){return M(this,q)}clearCofactor(){const{h:q}=t;return q===wt?this:this.multiplyUnsafe(q)}static fromHex(q,V=!1){const{d:K,a:de}=t,fe=r.BYTES;q=Dr("pointHex",q,fe),$c("zip215",V);const ae=q.slice(),Ae=q[fe-1];ae[fe-1]=Ae&-129;const be=To(ae),Oe=V?g:r.ORDER;kn("pointHex.y",be,ir,Oe);const Y=v(be*be),qe=v(Y-wt),St=v(K*Y-de);let{isValid:$e,value:je}=E(qe,St);if(!$e)throw new Error("Point.fromHex: invalid y coordinate");const Ft=(je&wt)===wt,ut=(Ae&128)!==0;if(!V&&je===ir&&ut)throw new Error("Point.fromHex: x=0 and x_0=1");return ut!==Ft&&(je=v(-je)),T.fromAffine({x:je,y:be})}static fromPrivateKey(q){return we(q).point}toRawBytes(){const{x:q,y:V}=this.toAffine(),K=eu(V,r.BYTES);return K[K.length-1]|=q&wt?128:0,K}toHex(){return wu(this.toRawBytes())}}T.BASE=new T(t.Gx,t.Gy,wt,v(t.Gx*t.Gy)),T.ZERO=new T(ir,wt,wt,ir);const{BASE:j,ZERO:W}=T,le=cE(T,p*8);function re(ee){return We(ee,n)}function oe(ee){return re(To(ee))}function we(ee){const q=r.BYTES;ee=Dr("private key",ee,q);const V=Dr("hashed private key",c(ee),2*q),K=F(V.slice(0,q)),de=V.slice(q,2*q),fe=oe(K),ae=j.multiply(fe),Ae=ae.toRawBytes();return{head:K,prefix:de,scalar:fe,point:ae,pointBytes:Ae}}function qt(ee){return we(ee).pointBytes}function zt(ee=new Uint8Array,...q){const V=Ql(...q);return oe(c(S(V,Dr("context",ee),!!o)))}function xt(ee,q,V={}){ee=Dr("message",ee),o&&(ee=o(ee));const{prefix:K,scalar:de,pointBytes:fe}=we(q),ae=zt(V.context,K,ee),Ae=j.multiply(ae).toRawBytes(),be=zt(V.context,Ae,fe,ee),Oe=re(ae+be*de);kn("signature.s",Oe,ir,n);const Y=Ql(Ae,eu(Oe,r.BYTES));return Dr("result",Y,r.BYTES*2)}const mr=fE;function Br(ee,q,V,K=mr){const{context:de,zip215:fe}=K,ae=r.BYTES;ee=Dr("signature",ee,2*ae),q=Dr("message",q),V=Dr("publicKey",V,ae),fe!==void 0&&$c("zip215",fe),o&&(q=o(q));const Ae=To(ee.slice(ae,2*ae));let be,Oe,Y;try{be=T.fromHex(V,fe),Oe=T.fromHex(ee.slice(0,ae),fe),Y=j.multiplyUnsafe(Ae)}catch{return!1}if(!fe&&be.isSmallOrder())return!1;const qe=zt(de,Oe.toRawBytes(),be.toRawBytes(),q);return Oe.add(be.multiplyUnsafe(qe)).subtract(Y).clearCofactor().equals(T.ZERO)}return j._setWindowSize(8),{CURVE:t,getPublicKey:qt,sign:xt,verify:Br,ExtendedPoint:T,utils:{getExtendedPublicKey:we,randomPrivateKey:()=>h(r.BYTES),precompute(ee=8,q=T.BASE){return q._setWindowSize(ee),q.multiply(BigInt(3)),q}}}}BigInt(0),BigInt(1);const _u=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),rf=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const gE=BigInt(1),nf=BigInt(2);BigInt(3);const yE=BigInt(5),vE=BigInt(8);function mE(s){const t=BigInt(10),r=BigInt(20),n=BigInt(40),o=BigInt(80),c=_u,h=s*s%c*s%c,p=gr(h,nf,c)*h%c,f=gr(p,gE,c)*s%c,g=gr(f,yE,c)*f%c,v=gr(g,t,c)*g%c,b=gr(v,r,c)*v%c,E=gr(b,n,c)*b%c,F=gr(E,o,c)*E%c,S=gr(F,o,c)*E%c,D=gr(S,t,c)*g%c;return{pow_p_5_8:gr(D,nf,c)*s%c,b2:h}}function wE(s){return s[0]&=248,s[31]&=127,s[31]|=64,s}function bE(s,t){const r=_u,n=We(t*t*t,r),o=We(n*n*t,r),c=mE(s*o).pow_p_5_8;let h=We(s*n*c,r);const p=We(t*h*h,r),f=h,g=We(h*rf,r),v=p===s,b=p===We(-s,r),E=p===We(-s*rf,r);return v&&(h=f),(b||E)&&(h=g),tE(h,r)&&(h=We(-h,r)),{isValid:v||b,value:h}}const _E=(()=>gp(_u,void 0,!0))(),EE=(()=>({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:_E,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:vE,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:H_,randomBytes:cp,adjustScalarBytes:wE,uvRatio:bE}))(),mp=(()=>dE(EE))(),IE="EdDSA",PE="JWT",wp=".",bp="base64url",xE="utf8",SE="utf8",FE=":",AE="did",OE="key",sf="base58btc",$E="z",CE="K36",RE=32;function Eu(s){return globalThis.Buffer!=null?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):s}function _p(s=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Eu(globalThis.Buffer.allocUnsafe(s)):new Uint8Array(s)}function Ep(s,t){t||(t=s.reduce((o,c)=>o+c.length,0));const r=_p(t);let n=0;for(const o of s)r.set(o,n),n+=o.length;return Eu(r)}function TE(s,t){if(s.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<s.length;o++){var c=s.charAt(o),h=c.charCodeAt(0);if(r[h]!==255)throw new TypeError(c+" is ambiguous");r[h]=o}var p=s.length,f=s.charAt(0),g=Math.log(p)/Math.log(256),v=Math.log(256)/Math.log(p);function b(S){if(S instanceof Uint8Array||(ArrayBuffer.isView(S)?S=new Uint8Array(S.buffer,S.byteOffset,S.byteLength):Array.isArray(S)&&(S=Uint8Array.from(S))),!(S instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(S.length===0)return"";for(var D=0,H=0,M=0,Q=S.length;M!==Q&&S[M]===0;)M++,D++;for(var T=(Q-M)*v+1>>>0,j=new Uint8Array(T);M!==Q;){for(var W=S[M],le=0,re=T-1;(W!==0||le<H)&&re!==-1;re--,le++)W+=256*j[re]>>>0,j[re]=W%p>>>0,W=W/p>>>0;if(W!==0)throw new Error("Non-zero carry");H=le,M++}for(var oe=T-H;oe!==T&&j[oe]===0;)oe++;for(var we=f.repeat(D);oe<T;++oe)we+=s.charAt(j[oe]);return we}function E(S){if(typeof S!="string")throw new TypeError("Expected String");if(S.length===0)return new Uint8Array;var D=0;if(S[D]!==" "){for(var H=0,M=0;S[D]===f;)H++,D++;for(var Q=(S.length-D)*g+1>>>0,T=new Uint8Array(Q);S[D];){var j=r[S.charCodeAt(D)];if(j===255)return;for(var W=0,le=Q-1;(j!==0||W<M)&&le!==-1;le--,W++)j+=p*T[le]>>>0,T[le]=j%256>>>0,j=j/256>>>0;if(j!==0)throw new Error("Non-zero carry");M=W,D++}if(S[D]!==" "){for(var re=Q-M;re!==Q&&T[re]===0;)re++;for(var oe=new Uint8Array(H+(Q-re)),we=H;re!==Q;)oe[we++]=T[re++];return oe}}}function F(S){var D=E(S);if(D)return D;throw new Error(`Non-${t} character`)}return{encode:b,decodeUnsafe:E,decode:F}}var NE=TE,DE=NE;const Ip=s=>{if(s instanceof Uint8Array&&s.constructor.name==="Uint8Array")return s;if(s instanceof ArrayBuffer)return new Uint8Array(s);if(ArrayBuffer.isView(s))return new Uint8Array(s.buffer,s.byteOffset,s.byteLength);throw new Error("Unknown type, must be binary type")},qE=s=>new TextEncoder().encode(s),zE=s=>new TextDecoder().decode(s);let jE=class{constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},BE=class{constructor(t,r,n){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Pp(this,t)}};class LE{constructor(t){this.decoders=t}or(t){return Pp(this,t)}decode(t){const r=t[0],n=this.decoders[r];if(n)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Pp=(s,t)=>new LE({...s.decoders||{[s.prefix]:s},...t.decoders||{[t.prefix]:t}});let UE=class{constructor(t,r,n,o){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new jE(t,r,n),this.decoder=new BE(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};const Ho=({name:s,prefix:t,encode:r,decode:n})=>new UE(s,t,r,n),as=({prefix:s,name:t,alphabet:r})=>{const{encode:n,decode:o}=DE(r,t);return Ho({prefix:s,name:t,encode:n,decode:c=>Ip(o(c))})},ME=(s,t,r,n)=>{const o={};for(let v=0;v<t.length;++v)o[t[v]]=v;let c=s.length;for(;s[c-1]==="=";)--c;const h=new Uint8Array(c*r/8|0);let p=0,f=0,g=0;for(let v=0;v<c;++v){const b=o[s[v]];if(b===void 0)throw new SyntaxError(`Non-${n} character`);f=f<<r|b,p+=r,p>=8&&(p-=8,h[g++]=255&f>>p)}if(p>=r||255&f<<8-p)throw new SyntaxError("Unexpected end of data");return h},HE=(s,t,r)=>{const n=t[t.length-1]==="=",o=(1<<r)-1;let c="",h=0,p=0;for(let f=0;f<s.length;++f)for(p=p<<8|s[f],h+=8;h>r;)h-=r,c+=t[o&p>>h];if(h&&(c+=t[o&p<<r-h]),n)for(;c.length*r&7;)c+="=";return c},rt=({name:s,prefix:t,bitsPerChar:r,alphabet:n})=>Ho({prefix:t,name:s,encode(o){return HE(o,n,r)},decode(o){return ME(o,n,r,s)}}),kE=Ho({prefix:"\0",name:"identity",encode:s=>zE(s),decode:s=>qE(s)});var VE=Object.freeze({__proto__:null,identity:kE});const KE=rt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var GE=Object.freeze({__proto__:null,base2:KE});const WE=rt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var JE=Object.freeze({__proto__:null,base8:WE});const QE=as({prefix:"9",name:"base10",alphabet:"0123456789"});var YE=Object.freeze({__proto__:null,base10:QE});const ZE=rt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),XE=rt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var eI=Object.freeze({__proto__:null,base16:ZE,base16upper:XE});const tI=rt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),rI=rt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),iI=rt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),nI=rt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),sI=rt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),oI=rt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),aI=rt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),cI=rt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),uI=rt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var hI=Object.freeze({__proto__:null,base32:tI,base32upper:rI,base32pad:iI,base32padupper:nI,base32hex:sI,base32hexupper:oI,base32hexpad:aI,base32hexpadupper:cI,base32z:uI});const lI=as({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),fI=as({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var pI=Object.freeze({__proto__:null,base36:lI,base36upper:fI});const dI=as({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),gI=as({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var yI=Object.freeze({__proto__:null,base58btc:dI,base58flickr:gI});const vI=rt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),mI=rt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),wI=rt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),bI=rt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var _I=Object.freeze({__proto__:null,base64:vI,base64pad:mI,base64url:wI,base64urlpad:bI});const xp=Array.from(""),EI=xp.reduce((s,t,r)=>(s[r]=t,s),[]),II=xp.reduce((s,t,r)=>(s[t.codePointAt(0)]=r,s),[]);function PI(s){return s.reduce((t,r)=>(t+=EI[r],t),"")}function xI(s){const t=[];for(const r of s){const n=II[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}const SI=Ho({prefix:"",name:"base256emoji",encode:PI,decode:xI});var FI=Object.freeze({__proto__:null,base256emoji:SI}),AI=Sp,of=128,OI=127,$I=~OI,CI=Math.pow(2,31);function Sp(s,t,r){t=t||[],r=r||0;for(var n=r;s>=CI;)t[r++]=s&255|of,s/=128;for(;s&$I;)t[r++]=s&255|of,s>>>=7;return t[r]=s|0,Sp.bytes=r-n+1,t}var RI=ru,TI=128,af=127;function ru(s,n){var r=0,n=n||0,o=0,c=n,h,p=s.length;do{if(c>=p)throw ru.bytes=0,new RangeError("Could not decode varint");h=s[c++],r+=o<28?(h&af)<<o:(h&af)*Math.pow(2,o),o+=7}while(h>=TI);return ru.bytes=c-n,r}var NI=Math.pow(2,7),DI=Math.pow(2,14),qI=Math.pow(2,21),zI=Math.pow(2,28),jI=Math.pow(2,35),BI=Math.pow(2,42),LI=Math.pow(2,49),UI=Math.pow(2,56),MI=Math.pow(2,63),HI=function(s){return s<NI?1:s<DI?2:s<qI?3:s<zI?4:s<jI?5:s<BI?6:s<LI?7:s<UI?8:s<MI?9:10},kI={encode:AI,decode:RI,encodingLength:HI},Fp=kI;const cf=(s,t,r=0)=>(Fp.encode(s,t,r),t),uf=s=>Fp.encodingLength(s),iu=(s,t)=>{const r=t.byteLength,n=uf(s),o=n+uf(r),c=new Uint8Array(o+r);return cf(s,c,0),cf(r,c,n),c.set(t,o),new VI(s,r,t,c)};class VI{constructor(t,r,n,o){this.code=t,this.size=r,this.digest=n,this.bytes=o}}const Ap=({name:s,code:t,encode:r})=>new KI(s,t,r);class KI{constructor(t,r,n){this.name=t,this.code=r,this.encode=n}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?iu(this.code,r):r.then(n=>iu(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Op=s=>async t=>new Uint8Array(await crypto.subtle.digest(s,t)),GI=Ap({name:"sha2-256",code:18,encode:Op("SHA-256")}),WI=Ap({name:"sha2-512",code:19,encode:Op("SHA-512")});var JI=Object.freeze({__proto__:null,sha256:GI,sha512:WI});const $p=0,QI="identity",Cp=Ip,YI=s=>iu($p,Cp(s)),ZI={code:$p,name:QI,encode:Cp,digest:YI};var XI=Object.freeze({__proto__:null,identity:ZI});new TextEncoder,new TextDecoder;const hf={...VE,...GE,...JE,...YE,...eI,...hI,...pI,...yI,..._I,...FI};({...JI,...XI});function Rp(s,t,r,n){return{name:s,prefix:t,encoder:{name:s,prefix:t,encode:r},decoder:{decode:n}}}const lf=Rp("utf8","u",s=>"u"+new TextDecoder("utf8").decode(s),s=>new TextEncoder().encode(s.substring(1))),qc=Rp("ascii","a",s=>{let t="a";for(let r=0;r<s.length;r++)t+=String.fromCharCode(s[r]);return t},s=>{s=s.substring(1);const t=_p(s.length);for(let r=0;r<s.length;r++)t[r]=s.charCodeAt(r);return t}),Tp={utf8:lf,"utf-8":lf,hex:hf.base16,latin1:qc,ascii:qc,binary:qc,...hf};function Iu(s,t="utf8"){const r=Tp[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(s.buffer,s.byteOffset,s.byteLength).toString("utf8"):r.encoder.encode(s).substring(1)}function Pu(s,t="utf8"){const r=Tp[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Eu(globalThis.Buffer.from(s,"utf-8")):r.decoder.decode(`${r.prefix}${s}`)}function No(s){return Iu(Pu(is(s),xE),bp)}function Np(s){const t=Pu(CE,sf),r=$E+Iu(Ep([t,s]),sf);return[AE,OE,r].join(FE)}function e2(s){return Iu(s,bp)}function t2(s){return Pu([No(s.header),No(s.payload)].join(wp),SE)}function r2(s){return[No(s.header),No(s.payload),e2(s.signature)].join(wp)}function ff(s=cp(RE)){const t=mp.getPublicKey(s);return{secretKey:Ep([s,t]),publicKey:t}}async function i2(s,t,r,n,o=G.fromMiliseconds(Date.now())){const c={alg:IE,typ:PE},h=Np(n.publicKey),p=o+r,f={iss:h,sub:s,aud:t,iat:o,exp:p},g=t2({header:c,payload:f}),v=mp.sign(g,n.secretKey.slice(0,32));return r2({header:c,payload:f,signature:v})}let n2=class extends Xf{constructor(t){super(t),this.events=new Qt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(xi(t.method,t.params||[],t.id||pu().toString()),r)}async requestStrict(t,r){return new Promise(async(n,o)=>{if(!this.connection.connected)try{await this.open()}catch(c){o(c)}this.events.on(`${t.id}`,c=>{or(c)?o(c.error):n(c.result)});try{await this.connection.send(t,r)}catch(c){o(c)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),ns(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const s2=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),o2=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",pf=s=>s.split("?")[0],df=10,a2=s2();let c2=class{constructor(t){if(this.url=t,this.events=new Qt.EventEmitter,this.registering=!1,!Dl(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(is(t))}catch(r){this.onError(t.id,r)}}register(t=this.url){if(!Dl(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,o)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),o(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,n)=>{const o=new URLSearchParams(t).get("origin"),c=bw.isReactNative()?{headers:{origin:o}}:{rejectUnauthorized:!_w(t)},h=new a2(t,[],c);o2()?h.onerror=p=>{const f=p;n(this.emitError(f.error))}:h.on("error",p=>{n(this.emitError(p))}),h.onopen=()=>{this.onOpen(h),r(h)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?zo(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const n=this.parseError(r),o=n.message||n.toString(),c=du(t,o);this.events.emit("payload",c)}parseError(t,r=this.url){return Ew(t,pf(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>df&&this.events.setMaxListeners(df)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${pf(this.url)}`));return this.events.emit("register_error",r),r}};var Do={exports:{}};Do.exports;(function(s,t){var r=200,n="__lodash_hash_undefined__",o=1,c=2,h=9007199254740991,p="[object Arguments]",f="[object Array]",g="[object AsyncFunction]",v="[object Boolean]",b="[object Date]",E="[object Error]",F="[object Function]",S="[object GeneratorFunction]",D="[object Map]",H="[object Number]",M="[object Null]",Q="[object Object]",T="[object Promise]",j="[object Proxy]",W="[object RegExp]",le="[object Set]",re="[object String]",oe="[object Symbol]",we="[object Undefined]",qt="[object WeakMap]",zt="[object ArrayBuffer]",xt="[object DataView]",mr="[object Float32Array]",Br="[object Float64Array]",ee="[object Int8Array]",q="[object Int16Array]",V="[object Int32Array]",K="[object Uint8Array]",de="[object Uint8ClampedArray]",fe="[object Uint16Array]",ae="[object Uint32Array]",Ae=/[\\^$.*+?()[\]{}|]/g,be=/^\[object .+?Constructor\]$/,Oe=/^(?:0|[1-9]\d*)$/,Y={};Y[mr]=Y[Br]=Y[ee]=Y[q]=Y[V]=Y[K]=Y[de]=Y[fe]=Y[ae]=!0,Y[p]=Y[f]=Y[zt]=Y[v]=Y[xt]=Y[b]=Y[E]=Y[F]=Y[D]=Y[H]=Y[Q]=Y[W]=Y[le]=Y[re]=Y[qt]=!1;var qe=typeof mo=="object"&&mo&&mo.Object===Object&&mo,St=typeof self=="object"&&self&&self.Object===Object&&self,$e=qe||St||Function("return this")(),je=t&&!t.nodeType&&t,Ft=je&&!0&&s&&!s.nodeType&&s,ut=Ft&&Ft.exports===je,At=ut&&qe.process,Lr=function(){try{return At&&At.binding&&At.binding("util")}catch{}}(),Xe=Lr&&Lr.isTypedArray;function wr(m,I){for(var R=-1,B=m==null?0:m.length,xe=0,ie=[];++R<B;){var Ce=m[R];I(Ce,R,m)&&(ie[xe++]=Ce)}return ie}function gn(m,I){for(var R=-1,B=I.length,xe=m.length;++R<B;)m[xe+R]=I[R];return m}function Ot(m,I){for(var R=-1,B=m==null?0:m.length;++R<B;)if(I(m[R],R,m))return!0;return!1}function Oi(m,I){for(var R=-1,B=Array(m);++R<m;)B[R]=I(R);return B}function $i(m){return function(I){return m(I)}}function ar(m,I){return m.has(I)}function et(m,I){return m==null?void 0:m[I]}function cr(m){var I=-1,R=Array(m.size);return m.forEach(function(B,xe){R[++I]=[xe,B]}),R}function br(m,I){return function(R){return m(I(R))}}function Ci(m){var I=-1,R=Array(m.size);return m.forEach(function(B){R[++I]=B}),R}var ur=Array.prototype,Ri=Function.prototype,jt=Object.prototype,Bt=$e["__core-js_shared__"],Ur=Ri.toString,nt=jt.hasOwnProperty,Ti=function(){var m=/[^.]+$/.exec(Bt&&Bt.keys&&Bt.keys.IE_PROTO||"");return m?"Symbol(src)_1."+m:""}(),Ni=jt.toString,yn=RegExp("^"+Ur.call(nt).replace(Ae,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Di=ut?$e.Buffer:void 0,Mr=$e.Symbol,qi=$e.Uint8Array,zi=jt.propertyIsEnumerable,Ko=ur.splice,_r=Mr?Mr.toStringTag:void 0,us=Object.getOwnPropertySymbols,hs=Di?Di.isBuffer:void 0,ls=br(Object.keys,Object),vn=$t($e,"DataView"),ci=$t($e,"Map"),mn=$t($e,"Promise"),wn=$t($e,"Set"),ji=$t($e,"WeakMap"),ui=$t(Object,"create"),Go=Pr(vn),Wo=Pr(ci),bn=Pr(mn),Jo=Pr(wn),_n=Pr(ji),fs=Mr?Mr.prototype:void 0,En=fs?fs.valueOf:void 0;function Er(m){var I=-1,R=m==null?0:m.length;for(this.clear();++I<R;){var B=m[I];this.set(B[0],B[1])}}function Qo(){this.__data__=ui?ui(null):{},this.size=0}function Yo(m){var I=this.has(m)&&delete this.__data__[m];return this.size-=I?1:0,I}function Zo(m){var I=this.__data__;if(ui){var R=I[m];return R===n?void 0:R}return nt.call(I,m)?I[m]:void 0}function Xo(m){var I=this.__data__;return ui?I[m]!==void 0:nt.call(I,m)}function ea(m,I){var R=this.__data__;return this.size+=this.has(m)?0:1,R[m]=ui&&I===void 0?n:I,this}Er.prototype.clear=Qo,Er.prototype.delete=Yo,Er.prototype.get=Zo,Er.prototype.has=Xo,Er.prototype.set=ea;function Lt(m){var I=-1,R=m==null?0:m.length;for(this.clear();++I<R;){var B=m[I];this.set(B[0],B[1])}}function ta(){this.__data__=[],this.size=0}function ra(m){var I=this.__data__,R=hi(I,m);if(R<0)return!1;var B=I.length-1;return R==B?I.pop():Ko.call(I,R,1),--this.size,!0}function ia(m){var I=this.__data__,R=hi(I,m);return R<0?void 0:I[R][1]}function na(m){return hi(this.__data__,m)>-1}function sa(m,I){var R=this.__data__,B=hi(R,m);return B<0?(++this.size,R.push([m,I])):R[B][1]=I,this}Lt.prototype.clear=ta,Lt.prototype.delete=ra,Lt.prototype.get=ia,Lt.prototype.has=na,Lt.prototype.set=sa;function Ir(m){var I=-1,R=m==null?0:m.length;for(this.clear();++I<R;){var B=m[I];this.set(B[0],B[1])}}function Bi(){this.size=0,this.__data__={hash:new Er,map:new(ci||Lt),string:new Er}}function oa(m){var I=Hr(this,m).delete(m);return this.size-=I?1:0,I}function Li(m){return Hr(this,m).get(m)}function aa(m){return Hr(this,m).has(m)}function ca(m,I){var R=Hr(this,m),B=R.size;return R.set(m,I),this.size+=R.size==B?0:1,this}Ir.prototype.clear=Bi,Ir.prototype.delete=oa,Ir.prototype.get=Li,Ir.prototype.has=aa,Ir.prototype.set=ca;function Ui(m){var I=-1,R=m==null?0:m.length;for(this.__data__=new Ir;++I<R;)this.add(m[I])}function ps(m){return this.__data__.set(m,n),this}function ds(m){return this.__data__.has(m)}Ui.prototype.add=Ui.prototype.push=ps,Ui.prototype.has=ds;function Yt(m){var I=this.__data__=new Lt(m);this.size=I.size}function ua(){this.__data__=new Lt,this.size=0}function ha(m){var I=this.__data__,R=I.delete(m);return this.size=I.size,R}function la(m){return this.__data__.get(m)}function fa(m){return this.__data__.has(m)}function gs(m,I){var R=this.__data__;if(R instanceof Lt){var B=R.__data__;if(!ci||B.length<r-1)return B.push([m,I]),this.size=++R.size,this;R=this.__data__=new Ir(B)}return R.set(m,I),this.size=R.size,this}Yt.prototype.clear=ua,Yt.prototype.delete=ha,Yt.prototype.get=la,Yt.prototype.has=fa,Yt.prototype.set=gs;function ys(m,I){var R=ki(m),B=!R&&As(m),xe=!R&&!B&&xn(m),ie=!R&&!B&&!xe&&Cs(m),Ce=R||B||xe||ie,He=Ce?Oi(m.length,String):[],ye=He.length;for(var Se in m)(I||nt.call(m,Se))&&!(Ce&&(Se=="length"||xe&&(Se=="offset"||Se=="parent")||ie&&(Se=="buffer"||Se=="byteLength"||Se=="byteOffset")||Is(Se,ye)))&&He.push(Se);return He}function hi(m,I){for(var R=m.length;R--;)if(Fs(m[R][0],I))return R;return-1}function In(m,I,R){var B=I(m);return ki(m)?B:gn(B,R(m))}function li(m){return m==null?m===void 0?we:M:_r&&_r in Object(m)?_s(m):ga(m)}function Pn(m){return pi(m)&&li(m)==p}function fi(m,I,R,B,xe){return m===I?!0:m==null||I==null||!pi(m)&&!pi(I)?m!==m&&I!==I:vs(m,I,R,B,fi,xe)}function vs(m,I,R,B,xe,ie){var Ce=ki(m),He=ki(I),ye=Ce?f:hr(m),Se=He?f:hr(I);ye=ye==p?Q:ye,Se=Se==p?Q:Se;var Be=ye==Q,dt=Se==Q,ke=ye==Se;if(ke&&xn(m)){if(!xn(I))return!1;Ce=!0,Be=!1}if(ke&&!Be)return ie||(ie=new Yt),Ce||Cs(m)?Mi(m,I,R,B,xe,ie):da(m,I,ye,R,B,xe,ie);if(!(R&o)){var Re=Be&&nt.call(m,"__wrapped__"),ht=dt&&nt.call(I,"__wrapped__");if(Re||ht){var Zt=Re?m.value():m,Ut=ht?I.value():I;return ie||(ie=new Yt),xe(Zt,Ut,R,B,ie)}}return ke?(ie||(ie=new Yt),bs(m,I,R,B,xe,ie)):!1}function pa(m){if(!$s(m)||xs(m))return!1;var I=Vi(m)?yn:be;return I.test(Pr(m))}function ms(m){return pi(m)&&Os(m.length)&&!!Y[li(m)]}function ws(m){if(!Ss(m))return ls(m);var I=[];for(var R in Object(m))nt.call(m,R)&&R!="constructor"&&I.push(R);return I}function Mi(m,I,R,B,xe,ie){var Ce=R&o,He=m.length,ye=I.length;if(He!=ye&&!(Ce&&ye>He))return!1;var Se=ie.get(m);if(Se&&ie.get(I))return Se==I;var Be=-1,dt=!0,ke=R&c?new Ui:void 0;for(ie.set(m,I),ie.set(I,m);++Be<He;){var Re=m[Be],ht=I[Be];if(B)var Zt=Ce?B(ht,Re,Be,I,m,ie):B(Re,ht,Be,m,I,ie);if(Zt!==void 0){if(Zt)continue;dt=!1;break}if(ke){if(!Ot(I,function(Ut,lr){if(!ar(ke,lr)&&(Re===Ut||xe(Re,Ut,R,B,ie)))return ke.push(lr)})){dt=!1;break}}else if(!(Re===ht||xe(Re,ht,R,B,ie))){dt=!1;break}}return ie.delete(m),ie.delete(I),dt}function da(m,I,R,B,xe,ie,Ce){switch(R){case xt:if(m.byteLength!=I.byteLength||m.byteOffset!=I.byteOffset)return!1;m=m.buffer,I=I.buffer;case zt:return!(m.byteLength!=I.byteLength||!ie(new qi(m),new qi(I)));case v:case b:case H:return Fs(+m,+I);case E:return m.name==I.name&&m.message==I.message;case W:case re:return m==I+"";case D:var He=cr;case le:var ye=B&o;if(He||(He=Ci),m.size!=I.size&&!ye)return!1;var Se=Ce.get(m);if(Se)return Se==I;B|=c,Ce.set(m,I);var Be=Mi(He(m),He(I),B,xe,ie,Ce);return Ce.delete(m),Be;case oe:if(En)return En.call(m)==En.call(I)}return!1}function bs(m,I,R,B,xe,ie){var Ce=R&o,He=Hi(m),ye=He.length,Se=Hi(I),Be=Se.length;if(ye!=Be&&!Ce)return!1;for(var dt=ye;dt--;){var ke=He[dt];if(!(Ce?ke in I:nt.call(I,ke)))return!1}var Re=ie.get(m);if(Re&&ie.get(I))return Re==I;var ht=!0;ie.set(m,I),ie.set(I,m);for(var Zt=Ce;++dt<ye;){ke=He[dt];var Ut=m[ke],lr=I[ke];if(B)var Sn=Ce?B(lr,Ut,ke,I,m,ie):B(Ut,lr,ke,m,I,ie);if(!(Sn===void 0?Ut===lr||xe(Ut,lr,R,B,ie):Sn)){ht=!1;break}Zt||(Zt=ke=="constructor")}if(ht&&!Zt){var di=m.constructor,Je=I.constructor;di!=Je&&"constructor"in m&&"constructor"in I&&!(typeof di=="function"&&di instanceof di&&typeof Je=="function"&&Je instanceof Je)&&(ht=!1)}return ie.delete(m),ie.delete(I),ht}function Hi(m){return In(m,ma,Es)}function Hr(m,I){var R=m.__data__;return Ps(I)?R[typeof I=="string"?"string":"hash"]:R.map}function $t(m,I){var R=et(m,I);return pa(R)?R:void 0}function _s(m){var I=nt.call(m,_r),R=m[_r];try{m[_r]=void 0;var B=!0}catch{}var xe=Ni.call(m);return B&&(I?m[_r]=R:delete m[_r]),xe}var Es=us?function(m){return m==null?[]:(m=Object(m),wr(us(m),function(I){return zi.call(m,I)}))}:Pe,hr=li;(vn&&hr(new vn(new ArrayBuffer(1)))!=xt||ci&&hr(new ci)!=D||mn&&hr(mn.resolve())!=T||wn&&hr(new wn)!=le||ji&&hr(new ji)!=qt)&&(hr=function(m){var I=li(m),R=I==Q?m.constructor:void 0,B=R?Pr(R):"";if(B)switch(B){case Go:return xt;case Wo:return D;case bn:return T;case Jo:return le;case _n:return qt}return I});function Is(m,I){return I=I??h,!!I&&(typeof m=="number"||Oe.test(m))&&m>-1&&m%1==0&&m<I}function Ps(m){var I=typeof m;return I=="string"||I=="number"||I=="symbol"||I=="boolean"?m!=="__proto__":m===null}function xs(m){return!!Ti&&Ti in m}function Ss(m){var I=m&&m.constructor,R=typeof I=="function"&&I.prototype||jt;return m===R}function ga(m){return Ni.call(m)}function Pr(m){if(m!=null){try{return Ur.call(m)}catch{}try{return m+""}catch{}}return""}function Fs(m,I){return m===I||m!==m&&I!==I}var As=Pn(function(){return arguments}())?Pn:function(m){return pi(m)&&nt.call(m,"callee")&&!zi.call(m,"callee")},ki=Array.isArray;function ya(m){return m!=null&&Os(m.length)&&!Vi(m)}var xn=hs||Ie;function va(m,I){return fi(m,I)}function Vi(m){if(!$s(m))return!1;var I=li(m);return I==F||I==S||I==g||I==j}function Os(m){return typeof m=="number"&&m>-1&&m%1==0&&m<=h}function $s(m){var I=typeof m;return m!=null&&(I=="object"||I=="function")}function pi(m){return m!=null&&typeof m=="object"}var Cs=Xe?$i(Xe):ms;function ma(m){return ya(m)?ys(m):ws(m)}function Pe(){return[]}function Ie(){return!1}s.exports=va})(Do,Do.exports);var u2=Do.exports;const h2=lu(u2);function l2(s,t){return t=t||{},new Promise(function(r,n){var o=new XMLHttpRequest,c=[],h=[],p={},f=function(){return{ok:(o.status/100|0)==2,statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:f,headers:{keys:function(){return c},entries:function(){return h},get:function(v){return p[v.toLowerCase()]},has:function(v){return v.toLowerCase()in p}}}};for(var g in o.open(t.method||"get",s,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(v,b,E){c.push(b=b.toLowerCase()),h.push([b,E]),p[b]=p[b]?p[b]+","+E:E}),r(f())},o.onerror=n,o.withCredentials=t.credentials=="include",t.headers)o.setRequestHeader(g,t.headers[g]);o.send(t.body||null)})}const f2=Object.freeze(Object.defineProperty({__proto__:null,default:l2},Symbol.toStringTag,{value:"Module"})),gf=hu(f2);var p2=self.fetch||(self.fetch=gf.default||gf);const d2=lu(p2);function g2(s,t){if(s.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<s.length;o++){var c=s.charAt(o),h=c.charCodeAt(0);if(r[h]!==255)throw new TypeError(c+" is ambiguous");r[h]=o}var p=s.length,f=s.charAt(0),g=Math.log(p)/Math.log(256),v=Math.log(256)/Math.log(p);function b(S){if(S instanceof Uint8Array||(ArrayBuffer.isView(S)?S=new Uint8Array(S.buffer,S.byteOffset,S.byteLength):Array.isArray(S)&&(S=Uint8Array.from(S))),!(S instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(S.length===0)return"";for(var D=0,H=0,M=0,Q=S.length;M!==Q&&S[M]===0;)M++,D++;for(var T=(Q-M)*v+1>>>0,j=new Uint8Array(T);M!==Q;){for(var W=S[M],le=0,re=T-1;(W!==0||le<H)&&re!==-1;re--,le++)W+=256*j[re]>>>0,j[re]=W%p>>>0,W=W/p>>>0;if(W!==0)throw new Error("Non-zero carry");H=le,M++}for(var oe=T-H;oe!==T&&j[oe]===0;)oe++;for(var we=f.repeat(D);oe<T;++oe)we+=s.charAt(j[oe]);return we}function E(S){if(typeof S!="string")throw new TypeError("Expected String");if(S.length===0)return new Uint8Array;var D=0;if(S[D]!==" "){for(var H=0,M=0;S[D]===f;)H++,D++;for(var Q=(S.length-D)*g+1>>>0,T=new Uint8Array(Q);S[D];){var j=r[S.charCodeAt(D)];if(j===255)return;for(var W=0,le=Q-1;(j!==0||W<M)&&le!==-1;le--,W++)j+=p*T[le]>>>0,T[le]=j%256>>>0,j=j/256>>>0;if(j!==0)throw new Error("Non-zero carry");M=W,D++}if(S[D]!==" "){for(var re=Q-M;re!==Q&&T[re]===0;)re++;for(var oe=new Uint8Array(H+(Q-re)),we=H;re!==Q;)oe[we++]=T[re++];return oe}}}function F(S){var D=E(S);if(D)return D;throw new Error(`Non-${t} character`)}return{encode:b,decodeUnsafe:E,decode:F}}var y2=g2,v2=y2;const Dp=s=>{if(s instanceof Uint8Array&&s.constructor.name==="Uint8Array")return s;if(s instanceof ArrayBuffer)return new Uint8Array(s);if(ArrayBuffer.isView(s))return new Uint8Array(s.buffer,s.byteOffset,s.byteLength);throw new Error("Unknown type, must be binary type")},m2=s=>new TextEncoder().encode(s),w2=s=>new TextDecoder().decode(s);class b2{constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class _2{constructor(t,r,n){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return qp(this,t)}}class E2{constructor(t){this.decoders=t}or(t){return qp(this,t)}decode(t){const r=t[0],n=this.decoders[r];if(n)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const qp=(s,t)=>new E2({...s.decoders||{[s.prefix]:s},...t.decoders||{[t.prefix]:t}});class I2{constructor(t,r,n,o){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new b2(t,r,n),this.decoder=new _2(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const ko=({name:s,prefix:t,encode:r,decode:n})=>new I2(s,t,r,n),cs=({prefix:s,name:t,alphabet:r})=>{const{encode:n,decode:o}=v2(r,t);return ko({prefix:s,name:t,encode:n,decode:c=>Dp(o(c))})},P2=(s,t,r,n)=>{const o={};for(let v=0;v<t.length;++v)o[t[v]]=v;let c=s.length;for(;s[c-1]==="=";)--c;const h=new Uint8Array(c*r/8|0);let p=0,f=0,g=0;for(let v=0;v<c;++v){const b=o[s[v]];if(b===void 0)throw new SyntaxError(`Non-${n} character`);f=f<<r|b,p+=r,p>=8&&(p-=8,h[g++]=255&f>>p)}if(p>=r||255&f<<8-p)throw new SyntaxError("Unexpected end of data");return h},x2=(s,t,r)=>{const n=t[t.length-1]==="=",o=(1<<r)-1;let c="",h=0,p=0;for(let f=0;f<s.length;++f)for(p=p<<8|s[f],h+=8;h>r;)h-=r,c+=t[o&p>>h];if(h&&(c+=t[o&p<<r-h]),n)for(;c.length*r&7;)c+="=";return c},it=({name:s,prefix:t,bitsPerChar:r,alphabet:n})=>ko({prefix:t,name:s,encode(o){return x2(o,n,r)},decode(o){return P2(o,n,r,s)}}),S2=ko({prefix:"\0",name:"identity",encode:s=>w2(s),decode:s=>m2(s)});var F2=Object.freeze({__proto__:null,identity:S2});const A2=it({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var O2=Object.freeze({__proto__:null,base2:A2});const $2=it({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var C2=Object.freeze({__proto__:null,base8:$2});const R2=cs({prefix:"9",name:"base10",alphabet:"0123456789"});var T2=Object.freeze({__proto__:null,base10:R2});const N2=it({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),D2=it({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var q2=Object.freeze({__proto__:null,base16:N2,base16upper:D2});const z2=it({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),j2=it({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),B2=it({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),L2=it({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),U2=it({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),M2=it({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),H2=it({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),k2=it({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),V2=it({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var K2=Object.freeze({__proto__:null,base32:z2,base32upper:j2,base32pad:B2,base32padupper:L2,base32hex:U2,base32hexupper:M2,base32hexpad:H2,base32hexpadupper:k2,base32z:V2});const G2=cs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),W2=cs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var J2=Object.freeze({__proto__:null,base36:G2,base36upper:W2});const Q2=cs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Y2=cs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Z2=Object.freeze({__proto__:null,base58btc:Q2,base58flickr:Y2});const X2=it({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),eP=it({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),tP=it({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),rP=it({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var iP=Object.freeze({__proto__:null,base64:X2,base64pad:eP,base64url:tP,base64urlpad:rP});const zp=Array.from(""),nP=zp.reduce((s,t,r)=>(s[r]=t,s),[]),sP=zp.reduce((s,t,r)=>(s[t.codePointAt(0)]=r,s),[]);function oP(s){return s.reduce((t,r)=>(t+=nP[r],t),"")}function aP(s){const t=[];for(const r of s){const n=sP[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}const cP=ko({prefix:"",name:"base256emoji",encode:oP,decode:aP});var uP=Object.freeze({__proto__:null,base256emoji:cP}),hP=jp,yf=128,lP=127,fP=~lP,pP=Math.pow(2,31);function jp(s,t,r){t=t||[],r=r||0;for(var n=r;s>=pP;)t[r++]=s&255|yf,s/=128;for(;s&fP;)t[r++]=s&255|yf,s>>>=7;return t[r]=s|0,jp.bytes=r-n+1,t}var dP=nu,gP=128,vf=127;function nu(s,n){var r=0,n=n||0,o=0,c=n,h,p=s.length;do{if(c>=p)throw nu.bytes=0,new RangeError("Could not decode varint");h=s[c++],r+=o<28?(h&vf)<<o:(h&vf)*Math.pow(2,o),o+=7}while(h>=gP);return nu.bytes=c-n,r}var yP=Math.pow(2,7),vP=Math.pow(2,14),mP=Math.pow(2,21),wP=Math.pow(2,28),bP=Math.pow(2,35),_P=Math.pow(2,42),EP=Math.pow(2,49),IP=Math.pow(2,56),PP=Math.pow(2,63),xP=function(s){return s<yP?1:s<vP?2:s<mP?3:s<wP?4:s<bP?5:s<_P?6:s<EP?7:s<IP?8:s<PP?9:10},SP={encode:hP,decode:dP,encodingLength:xP},Bp=SP;const mf=(s,t,r=0)=>(Bp.encode(s,t,r),t),wf=s=>Bp.encodingLength(s),su=(s,t)=>{const r=t.byteLength,n=wf(s),o=n+wf(r),c=new Uint8Array(o+r);return mf(s,c,0),mf(r,c,n),c.set(t,o),new FP(s,r,t,c)};class FP{constructor(t,r,n,o){this.code=t,this.size=r,this.digest=n,this.bytes=o}}const Lp=({name:s,code:t,encode:r})=>new AP(s,t,r);class AP{constructor(t,r,n){this.name=t,this.code=r,this.encode=n}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?su(this.code,r):r.then(n=>su(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Up=s=>async t=>new Uint8Array(await crypto.subtle.digest(s,t)),OP=Lp({name:"sha2-256",code:18,encode:Up("SHA-256")}),$P=Lp({name:"sha2-512",code:19,encode:Up("SHA-512")});var CP=Object.freeze({__proto__:null,sha256:OP,sha512:$P});const Mp=0,RP="identity",Hp=Dp,TP=s=>su(Mp,Hp(s)),NP={code:Mp,name:RP,encode:Hp,digest:TP};var DP=Object.freeze({__proto__:null,identity:NP});new TextEncoder,new TextDecoder;const bf={...F2,...O2,...C2,...T2,...q2,...K2,...J2,...Z2,...iP,...uP};({...CP,...DP});function kp(s){return globalThis.Buffer!=null?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):s}function qP(s=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?kp(globalThis.Buffer.allocUnsafe(s)):new Uint8Array(s)}function Vp(s,t,r,n){return{name:s,prefix:t,encoder:{name:s,prefix:t,encode:r},decoder:{decode:n}}}const _f=Vp("utf8","u",s=>"u"+new TextDecoder("utf8").decode(s),s=>new TextEncoder().encode(s.substring(1))),zc=Vp("ascii","a",s=>{let t="a";for(let r=0;r<s.length;r++)t+=String.fromCharCode(s[r]);return t},s=>{s=s.substring(1);const t=qP(s.length);for(let r=0;r<s.length;r++)t[r]=s.charCodeAt(r);return t}),zP={utf8:_f,"utf-8":_f,hex:bf.base16,latin1:zc,ascii:zc,binary:zc,...bf};function jP(s,t="utf8"){const r=zP[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?kp(globalThis.Buffer.from(s,"utf-8")):r.decoder.decode(`${r.prefix}${s}`)}const Kp="wc",BP=2,xu="core",ni=`${Kp}@2:${xu}:`,LP={name:xu,logger:"error"},UP={database:":memory:"},MP="crypto",Ef="client_ed25519_seed",HP=G.ONE_DAY,kP="keychain",VP="0.3",KP="messages",GP="0.3",WP=G.SIX_HOURS,JP="publisher",Gp="irn",QP="error",Wp="wss://relay.walletconnect.com",If="wss://relay.walletconnect.org",YP="relayer",ct={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},ZP="_subscription",qr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},XP=G.ONE_SECOND,ex="2.11.0",tx=1e4,rx="0.3",ix="WALLETCONNECT_CLIENT_ID",nr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},nx="subscription",sx="0.3",ox=G.FIVE_SECONDS*1e3,ax="pairing",cx="0.3",Vn={wc_pairingDelete:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:G.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:G.ONE_DAY,prompt:!1,tag:0},res:{ttl:G.ONE_DAY,prompt:!1,tag:0}}},Yn={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},yr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},ux="history",hx="0.3",lx="expirer",Jt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},fx="0.3",jc="verify-api",ln="https://verify.walletconnect.com",ou="https://verify.walletconnect.org",px=[ln,ou],dx="echo",gx="https://echo.walletconnect.com";class yx{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=kP,this.version=VP,this.initialized=!1,this.storagePrefix=ni,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,o)=>{this.isInitialized(),this.keychain.set(n,o),await this.persist()},this.get=n=>{this.isInitialized();const o=this.keychain.get(n);if(typeof o>"u"){const{message:c}=L("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(c)}return o},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=t,this.logger=Pt(r,this.name)}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,Qf(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Yf(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=L("NOT_INITIALIZED",this.name);throw new Error(t)}}}class vx{constructor(t,r,n){this.core=t,this.logger=r,this.name=MP,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),c=ff(o);return Np(c.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=D0();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const c=await this.getClientSeed(),h=ff(c),p=Kc();return await i2(p,o,HP,h)},this.generateSharedKey=(o,c,h)=>{this.isInitialized();const p=this.getPrivateKey(o),f=q0(p,c);return this.setSymKey(f,h)},this.setSymKey=async(o,c)=>{this.isInitialized();const h=c||z0(o);return await this.keychain.set(h,o),h},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,c,h)=>{this.isInitialized();const p=j0(h),f=is(c);if(Ol(p)){const E=p.senderPublicKey,F=p.receiverPublicKey;o=await this.generateSharedKey(E,F)}const g=this.getSymKey(o),{type:v,senderPublicKey:b}=p;return B0({type:v,symKey:g,message:f,senderPublicKey:b})},this.decode=async(o,c,h)=>{this.isInitialized();const p=L0(c,h);if(Ol(p)){const f=p.receiverPublicKey,g=p.senderPublicKey;o=await this.generateSharedKey(f,g)}try{const f=this.getSymKey(o),g=U0({symKey:f,encoded:c});return zo(g)}catch(f){this.logger.error(`Failed to decode message from topic: '${o}', clientId: '${await this.getClientId()}'`),this.logger.error(f)}},this.getPayloadType=o=>{const c=$l(o);return M0(c.type)},this.getPayloadSenderPublicKey=o=>{const c=$l(o);return c.senderPublicKey?H0(c.senderPublicKey,k0):void 0},this.core=t,this.logger=Pt(r,this.name),this.keychain=n||new yx(this.core,this.logger)}get context(){return It(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(Ef)}catch{t=Kc(),await this.keychain.set(Ef,t)}return jP(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=L("NOT_INITIALIZED",this.name);throw new Error(t)}}}class mx extends r_{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=KP,this.version=GP,this.initialized=!1,this.storagePrefix=ni,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,o)=>{this.isInitialized();const c=fn(o);let h=this.messages.get(n);return typeof h>"u"&&(h={}),typeof h[c]<"u"||(h[c]=o,this.messages.set(n,h),await this.persist()),c},this.get=n=>{this.isInitialized();let o=this.messages.get(n);return typeof o>"u"&&(o={}),o},this.has=(n,o)=>{this.isInitialized();const c=this.get(n),h=fn(o);return typeof c[h]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Pt(t,this.name),this.core=r}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,Qf(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Yf(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=L("NOT_INITIALIZED",this.name);throw new Error(t)}}}class wx extends i_{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new Qt.EventEmitter,this.name=JP,this.queue=new Map,this.publishTimeout=G.toMiliseconds(G.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,o,c)=>{var h;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:c}});try{const p=(c==null?void 0:c.ttl)||WP,f=Gc(c),g=(c==null?void 0:c.prompt)||!1,v=(c==null?void 0:c.tag)||0,b=(c==null?void 0:c.id)||pu().toString(),E={topic:n,message:o,opts:{ttl:p,relay:f,prompt:g,tag:v,id:b}},F=setTimeout(()=>this.queue.set(b,E),this.publishTimeout);try{await await Xn(this.rpcPublish(n,o,p,f,g,v,b),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(b),this.relayer.events.emit(ct.publish,E)}catch(S){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(h=c==null?void 0:c.internal)!=null&&h.throwOnFailedPublish)throw this.removeRequestFromQueue(b),S;return}finally{clearTimeout(F)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:c}})}catch(p){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(p),p}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.relayer=t,this.logger=Pt(r,this.name),this.registerEventListeners()}get context(){return It(this.logger)}rpcPublish(t,r,n,o,c,h,p){var f,g,v,b;const E={method:Oo(o.protocol).publish,params:{topic:t,message:r,ttl:n,prompt:c,tag:h},id:p};return ii((f=E.params)==null?void 0:f.prompt)&&((g=E.params)==null||delete g.prompt),ii((v=E.params)==null?void 0:v.tag)&&((b=E.params)==null||delete b.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:E}),this.relayer.request(E)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:n,opts:o}=t;await this.publish(r,n,o)})}registerEventListeners(){this.relayer.core.heartbeat.on(dn.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(ct.connection_stalled);return}this.checkQueue()}),this.relayer.on(ct.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class bx{constructor(){this.map=new Map,this.set=(t,r)=>{const n=this.get(t);this.exists(t,r)||this.map.set(t,[...n,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const n=this.get(t);if(!this.exists(t,r))return;const o=n.filter(c=>c!==r);if(!o.length){this.map.delete(t);return}this.map.set(t,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var _x=Object.defineProperty,Ex=Object.defineProperties,Ix=Object.getOwnPropertyDescriptors,Pf=Object.getOwnPropertySymbols,Px=Object.prototype.hasOwnProperty,xx=Object.prototype.propertyIsEnumerable,xf=(s,t,r)=>t in s?_x(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Kn=(s,t)=>{for(var r in t||(t={}))Px.call(t,r)&&xf(s,r,t[r]);if(Pf)for(var r of Pf(t))xx.call(t,r)&&xf(s,r,t[r]);return s},Bc=(s,t)=>Ex(s,Ix(t));class Sx extends o_{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new bx,this.events=new Qt.EventEmitter,this.name=nx,this.version=sx,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=ni,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}});try{const c=Gc(o),h={topic:n,relay:c};this.pending.set(n,h);const p=await this.rpcSubscribe(n,c);return this.onSubscribe(p,h),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}}),p}catch(c){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(c),c}},this.unsubscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),typeof(o==null?void 0:o.id)<"u"?await this.unsubscribeById(n,o.id,o):await this.unsubscribeByTopic(n,o)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((o,c)=>{const h=new G.Watch;h.start(this.pendingSubscriptionWatchLabel);const p=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(p),h.stop(this.pendingSubscriptionWatchLabel),o(!0)),h.elapsed(this.pendingSubscriptionWatchLabel)>=ox&&(clearInterval(p),h.stop(this.pendingSubscriptionWatchLabel),c(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=Pt(r,this.name),this.clientId=""}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let n=!1;try{n=this.getSubscription(t).topic===r}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const n=this.topicMap.get(t);await Promise.all(n.map(async o=>await this.unsubscribeById(t,o,r)))}async unsubscribeById(t,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}});try{const o=Gc(n);await this.rpcUnsubscribe(t,r,o);const c=at("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,c),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(t,r){const n={method:Oo(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await Xn(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(ct.connection_stalled)}return fn(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,n={method:Oo(r.protocol).batchSubscribe,params:{topics:t.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await Xn(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(ct.connection_stalled)}}rpcUnsubscribe(t,r,n){const o={method:Oo(n.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(t,r){this.setSubscription(t,Bc(Kn({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,Kn({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,n),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,Kn({},r)),this.topicMap.set(r.topic,t),this.events.emit(nr.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:n}=L("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const n=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(n.topic,t),this.events.emit(nr.deleted,Bc(Kn({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(nr.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(nr.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=L("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);pn(r)&&this.onBatchSubscribe(r.map((n,o)=>Bc(Kn({},t[o]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(dn.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(ct.connect,async()=>{await this.onConnect()}),this.relayer.on(ct.disconnect,()=>{this.onDisconnect()}),this.events.on(nr.created,async t=>{const r=nr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(nr.deleted,async t=>{const r=nr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=L("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var Fx=Object.defineProperty,Sf=Object.getOwnPropertySymbols,Ax=Object.prototype.hasOwnProperty,Ox=Object.prototype.propertyIsEnumerable,Ff=(s,t,r)=>t in s?Fx(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,$x=(s,t)=>{for(var r in t||(t={}))Ax.call(t,r)&&Ff(s,r,t[r]);if(Sf)for(var r of Sf(t))Ox.call(t,r)&&Ff(s,r,t[r]);return s};class Cx extends n_{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new Qt.EventEmitter,this.name=YP,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(ct.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(ct.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(qr.payload,this.onPayloadHandler),this.provider.on(qr.connect,this.onConnectHandler),this.provider.on(qr.disconnect,this.onDisconnectHandler),this.provider.on(qr.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?Pt(t.logger,this.name):Uo(Mo({level:t.logger||QP})),this.messages=new mx(this.logger,t.core),this.subscriber=new Sx(this,this.logger),this.publisher=new wx(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||Wp,this.projectId=t.projectId,this.bundleId=V0(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${If}...`),await this.restartTransport(If)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},tx)}get context(){return It(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,n){this.isInitialized(),await this.publisher.publish(t,r,n),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var n;this.isInitialized();let o=((n=this.subscriber.topicMap.get(t))==null?void 0:n[0])||"";if(o)return o;let c;const h=p=>{p.topic===t&&(this.subscriber.off(nr.created,h),c())};return await Promise.all([new Promise(p=>{c=p,this.subscriber.on(nr.created,h)}),new Promise(async p=>{o=await this.subscriber.subscribe(t,r),p()})]),o}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Xn(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(nr.resubscribed,()=>{r()})}),new Promise(async(r,n)=>{try{await Xn(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(o){n(o);return}r()})])}catch(r){this.logger.error(r);const n=r;if(!this.isConnectionStalled(n.message))throw r;this.provider.events.emit(qr.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Cl())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new n2(new c2(K0({sdkVersion:ex,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:n}=t;await this.messages.set(r,n)}async shouldIgnoreMessageEvent(t){const{topic:r,message:n}=t;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const o=this.messages.has(r,n);return o&&this.logger.debug(`Ignoring duplicate message: ${n}`),o}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),gu(t)){if(!t.method.endsWith(ZP))return;const r=t.params,{topic:n,message:o,publishedAt:c}=r.data,h={topic:n,message:o,publishedAt:c};this.logger.debug("Emitting Relayer Payload"),this.logger.trace($x({type:"event",event:r.id},h)),this.events.emit(r.id,h),await this.acknowledgePayload(t),await this.onMessageEvent(h)}else ns(t)&&this.events.emit(ct.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(ct.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=jo(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(qr.payload,this.onPayloadHandler),this.provider.off(qr.connect,this.onConnectHandler),this.provider.off(qr.disconnect,this.onDisconnectHandler),this.provider.off(qr.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(ct.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await Cl();G0(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(ct.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},G.toMiliseconds(XP)))}isInitialized(){if(!this.initialized){const{message:t}=L("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var Rx=Object.defineProperty,Af=Object.getOwnPropertySymbols,Tx=Object.prototype.hasOwnProperty,Nx=Object.prototype.propertyIsEnumerable,Of=(s,t,r)=>t in s?Rx(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,$f=(s,t)=>{for(var r in t||(t={}))Tx.call(t,r)&&Of(s,r,t[r]);if(Af)for(var r of Af(t))Nx.call(t,r)&&Of(s,r,t[r]);return s};class Vo extends s_{constructor(t,r,n,o=ni,c=void 0){super(t,r,n,o),this.core=t,this.logger=r,this.name=n,this.map=new Map,this.version=rx,this.cached=[],this.initialized=!1,this.storagePrefix=ni,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(h=>{this.getKey&&h!==null&&!ii(h)?this.map.set(this.getKey(h),h):T0(h)?this.map.set(h.id,h):N0(h)&&this.map.set(h.topic,h)}),this.cached=[],this.initialized=!0)},this.set=async(h,p)=>{this.isInitialized(),this.map.has(h)?await this.update(h,p):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:h,value:p}),this.map.set(h,p),await this.persist())},this.get=h=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:h}),this.getData(h)),this.getAll=h=>(this.isInitialized(),h?this.values.filter(p=>Object.keys(h).every(f=>h2(p[f],h[f]))):this.values),this.update=async(h,p)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:h,update:p});const f=$f($f({},this.getData(h)),p);this.map.set(h,f),await this.persist()},this.delete=async(h,p)=>{this.isInitialized(),this.map.has(h)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:h,reason:p}),this.map.delete(h),await this.persist())},this.logger=Pt(r,this.name),this.storagePrefix=o,this.getKey=c}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:n}=L("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=L("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=L("NOT_INITIALIZED",this.name);throw new Error(t)}}}class Dx{constructor(t,r){this.core=t,this.logger=r,this.name=ax,this.version=cx,this.events=new fu,this.initialized=!1,this.storagePrefix=ni,this.ignoredPayloadTypes=[Gf],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=Kc(),o=await this.core.crypto.setSymKey(n),c=sr(G.FIVE_MINUTES),h={protocol:Gp},p={topic:o,expiry:c,relay:h,active:!1},f=W0({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:n,relay:h});return await this.pairings.set(o,p),await this.core.relayer.subscribe(o),this.core.expirer.set(o,c),{topic:o,uri:f}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:o,symKey:c,relay:h}=Rl(n.uri);let p;if(this.pairings.keys.includes(o)&&(p=this.pairings.get(o),p.active))throw new Error(`Pairing already exists: ${o}. Please try again with a new connection URI.`);const f=sr(G.FIVE_MINUTES),g={topic:o,relay:h,expiry:f,active:!1};return await this.pairings.set(o,g),this.core.expirer.set(o,f),n.activatePairing&&await this.activate({topic:o}),this.events.emit(Yn.create,g),this.core.crypto.keychain.has(o)||(await this.core.crypto.setSymKey(c,o),await this.core.relayer.subscribe(o,{relay:h})),g},this.activate=async({topic:n})=>{this.isInitialized();const o=sr(G.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:o}),this.core.expirer.set(n,o)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:o}=n;if(this.pairings.keys.includes(o)){const c=await this.sendRequest(o,"wc_pairingPing",{}),{done:h,resolve:p,reject:f}=un();this.events.once(Ve("pairing_ping",c),({error:g})=>{g?f(g):p()}),await h()}},this.updateExpiry=async({topic:n,expiry:o})=>{this.isInitialized(),await this.pairings.update(n,{expiry:o})},this.updateMetadata=async({topic:n,metadata:o})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:o}=n;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",at("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(n,o,c)=>{const h=xi(o,c),p=await this.core.crypto.encode(n,h),f=Vn[o].req;return this.core.history.set(n,h),this.core.relayer.publish(n,p,f),h.id},this.sendResult=async(n,o,c)=>{const h=jo(n,c),p=await this.core.crypto.encode(o,h),f=await this.core.history.get(o,n),g=Vn[f.request.method].res;await this.core.relayer.publish(o,p,g),await this.core.history.resolve(h)},this.sendError=async(n,o,c)=>{const h=du(n,c),p=await this.core.crypto.encode(o,h),f=await this.core.history.get(o,n),g=Vn[f.request.method]?Vn[f.request.method].res:Vn.unregistered_method.res;await this.core.relayer.publish(o,p,g),await this.core.history.resolve(h)},this.deletePairing=async(n,o)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,at("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),o?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(o=>ri(o.expiry));await Promise.all(n.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=n=>{const{topic:o,payload:c}=n;switch(c.method){case"wc_pairingPing":return this.onPairingPingRequest(o,c);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,c);default:return this.onUnknownRpcMethodRequest(o,c)}},this.onRelayEventResponse=async n=>{const{topic:o,payload:c}=n,h=(await this.core.history.get(o,c.id)).request.method;switch(h){case"wc_pairingPing":return this.onPairingPingResponse(o,c);default:return this.onUnknownRpcMethodResponse(h)}},this.onPairingPingRequest=async(n,o)=>{const{id:c}=o;try{this.isValidPing({topic:n}),await this.sendResult(c,n,!0),this.events.emit(Yn.ping,{id:c,topic:n})}catch(h){await this.sendError(c,n,h),this.logger.error(h)}},this.onPairingPingResponse=(n,o)=>{const{id:c}=o;setTimeout(()=>{ti(o)?this.events.emit(Ve("pairing_ping",c),{}):or(o)&&this.events.emit(Ve("pairing_ping",c),{error:o.error})},500)},this.onPairingDeleteRequest=async(n,o)=>{const{id:c}=o;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Yn.delete,{id:c,topic:n})}catch(h){await this.sendError(c,n,h),this.logger.error(h)}},this.onUnknownRpcMethodRequest=async(n,o)=>{const{id:c,method:h}=o;try{if(this.registeredMethods.includes(h))return;const p=at("WC_METHOD_UNSUPPORTED",h);await this.sendError(c,n,p),this.logger.error(p)}catch(p){await this.sendError(c,n,p),this.logger.error(p)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(at("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{var o;if(!Et(n)){const{message:h}=L("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(h)}if(!J0(n.uri)){const{message:h}=L("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(h)}const c=Rl(n.uri);if(!((o=c==null?void 0:c.relay)!=null&&o.protocol)){const{message:h}=L("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(h)}if(!(c!=null&&c.symKey)){const{message:h}=L("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(h)}},this.isValidPing=async n=>{if(!Et(n)){const{message:c}=L("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(c)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidDisconnect=async n=>{if(!Et(n)){const{message:c}=L("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(c)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async n=>{if(!hn(n,!1)){const{message:o}=L("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(o)}if(!this.pairings.keys.includes(n)){const{message:o}=L("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(o)}if(ri(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:o}=L("EXPIRED",`pairing topic: ${n}`);throw new Error(o)}},this.core=t,this.logger=Pt(r,this.name),this.pairings=new Vo(this.core,this.logger,this.name,this.storagePrefix)}get context(){return It(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=L("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(ct.message,async t=>{const{topic:r,message:n}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const o=await this.core.crypto.decode(r,n);try{gu(o)?(this.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):ns(o)&&(await this.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.core.history.delete(r,o.id))}catch(c){this.logger.error(c)}})}registerExpirerEvents(){this.core.expirer.on(Jt.expired,async t=>{const{topic:r}=Wf(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Yn.expire,{topic:r}))})}}class qx extends t_{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new Qt.EventEmitter,this.name=ux,this.version=hx,this.cached=[],this.initialized=!1,this.storagePrefix=ni,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,o,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:o,chainId:c}),this.records.has(o.id))return;const h={id:o.id,topic:n,request:{method:o.method,params:o.params||null},chainId:c,expiry:sr(G.THIRTY_DAYS)};this.records.set(h.id,h),this.events.emit(yr.created,h)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const o=await this.getRecord(n.id);typeof o.response>"u"&&(o.response=or(n)?{error:n.error}:{result:n.result},this.records.set(o.id,o),this.events.emit(yr.updated,o))},this.get=async(n,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:o}),await this.getRecord(o)),this.delete=(n,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(c=>{if(c.topic===n){if(typeof o<"u"&&c.id!==o)return;this.records.delete(c.id),this.events.emit(yr.deleted,c)}})},this.exists=async(n,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===n:!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Pt(r,this.name)}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:xi(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(n)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:n}=L("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(yr.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=L("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(yr.created,t=>{const r=yr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(yr.updated,t=>{const r=yr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(yr.deleted,t=>{const r=yr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(dn.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{G.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=L("NOT_INITIALIZED",this.name);throw new Error(t)}}}class zx extends a_{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new Qt.EventEmitter,this.name=lx,this.version=fx,this.cached=[],this.initialized=!1,this.storagePrefix=ni,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const o=this.formatTarget(n);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(n,o)=>{this.isInitialized();const c=this.formatTarget(n),h={target:c,expiry:o};this.expirations.set(c,h),this.checkExpiry(c,h),this.events.emit(Jt.created,{target:c,expiration:h})},this.get=n=>{this.isInitialized();const o=this.formatTarget(n);return this.getExpiration(o)},this.del=n=>{if(this.isInitialized(),this.has(n)){const o=this.formatTarget(n),c=this.getExpiration(o);this.expirations.delete(o),this.events.emit(Jt.deleted,{target:o,expiration:c})}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Pt(r,this.name)}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return Q0(t);if(typeof t=="number")return Y0(t);const{message:r}=L("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Jt.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=L("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:n}=L("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(n),new Error(n)}return r}checkExpiry(t,r){const{expiry:n}=r;G.toMiliseconds(n)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(Jt.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(dn.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Jt.created,t=>{const r=Jt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Jt.expired,t=>{const r=Jt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Jt.deleted,t=>{const r=Jt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=L("NOT_INITIALIZED",this.name);throw new Error(t)}}}class jx extends c_{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=jc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async n=>{if(this.verifyDisabled||Z0()||!Jf())return;const o=this.getVerifyUrl(n==null?void 0:n.verifyUrl);this.verifyUrl!==o&&this.removeIframe(),this.verifyUrl=o;try{await this.createIframe()}catch(c){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(c)}if(!this.initialized){this.removeIframe(),this.verifyUrl=ou;try{await this.createIframe()}catch(c){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(c),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const o=this.getVerifyUrl(n==null?void 0:n.verifyUrl);let c;try{c=await this.fetchAttestation(n.attestationId,o)}catch(h){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${o}`),this.logger.info(h),c=await this.fetchAttestation(n.attestationId,ou)}return c},this.fetchAttestation=async(n,o)=>{this.logger.info(`resolving attestation: ${n} from url: ${o}`);const c=this.startAbortTimer(G.ONE_SECOND*2),h=await fetch(`${o}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(c),h.status===200?await h.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var o;try{if(!this.iframe)return;(o=this.iframe.contentWindow)==null||o.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const o=c=>{c.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",o),n())};await Promise.race([new Promise(c=>{if(document.getElementById(jc))return c();window.addEventListener("message",o);const h=document.createElement("iframe");h.id=jc,h.src=`${this.verifyUrl}/${this.projectId}`,h.style.display="none",document.body.append(h),this.iframe=h,n=c}),new Promise((c,h)=>setTimeout(()=>{window.removeEventListener("message",o),h("verify iframe load timeout")},G.toMiliseconds(G.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=n=>{let o=n||ln;return px.includes(o)||(this.logger.info(`verify url: ${o}, not included in trusted list, assigning default: ${ln}`),o=ln),o},this.logger=Pt(r,this.name),this.verifyUrl=ln,this.abortController=new AbortController,this.isDevEnv=X0()&&{}.IS_VITEST}get context(){return It(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),G.toMiliseconds(t))}}class Bx extends u_{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.context=dx,this.registerDeviceToken=async n=>{const{clientId:o,token:c,notificationType:h,enableEncrypted:p=!1}=n,f=`${gx}/${this.projectId}/clients`;await d2(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:o,type:h,token:c,always_raw:p})})},this.logger=Pt(r,this.context)}}var Lx=Object.defineProperty,Cf=Object.getOwnPropertySymbols,Ux=Object.prototype.hasOwnProperty,Mx=Object.prototype.propertyIsEnumerable,Rf=(s,t,r)=>t in s?Lx(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Tf=(s,t)=>{for(var r in t||(t={}))Ux.call(t,r)&&Rf(s,r,t[r]);if(Cf)for(var r of Cf(t))Mx.call(t,r)&&Rf(s,r,t[r]);return s};class Su extends e_{constructor(t){super(t),this.protocol=Kp,this.version=BP,this.name=xu,this.events=new Qt.EventEmitter,this.initialized=!1,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||Wp,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Uo(Mo({level:(t==null?void 0:t.logger)||LP.logger}));this.logger=Pt(r,this.name),this.heartbeat=new dn.HeartBeat,this.crypto=new vx(this,this.logger,t==null?void 0:t.keychain),this.history=new qx(this,this.logger),this.expirer=new zx(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new ib(Tf(Tf({},UP),t==null?void 0:t.storageOptions)),this.relayer=new Cx({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Dx(this,this.logger),this.verify=new jx(this.projectId||"",this.logger),this.echoClient=new Bx(this.projectId||"",this.logger)}static async init(t){const r=new Su(t);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(ix,n),r}get context(){return It(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const Hx=Su,Jp="wc",Qp=2,Yp="client",Fu=`${Jp}@${Qp}:${Yp}:`,Lc={name:Yp,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Nf="WALLETCONNECT_DEEPLINK_CHOICE",kx="proposal",Zp="Proposal expired",Vx="session",So=G.SEVEN_DAYS,Kx="engine",Gn={wc_sessionPropose:{req:{ttl:G.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1104},res:{ttl:G.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1106},res:{ttl:G.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:G.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:G.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1112},res:{ttl:G.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1115}}},Uc={min:G.FIVE_MINUTES,max:G.SEVEN_DAYS},zr={idle:"IDLE",active:"ACTIVE"},Gx="request",Wx=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var Jx=Object.defineProperty,Qx=Object.defineProperties,Yx=Object.getOwnPropertyDescriptors,Df=Object.getOwnPropertySymbols,Zx=Object.prototype.hasOwnProperty,Xx=Object.prototype.propertyIsEnumerable,qf=(s,t,r)=>t in s?Jx(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,bt=(s,t)=>{for(var r in t||(t={}))Zx.call(t,r)&&qf(s,r,t[r]);if(Df)for(var r of Df(t))Xx.call(t,r)&&qf(s,r,t[r]);return s},Wn=(s,t)=>Qx(s,Yx(t));class eS extends l_{constructor(t){super(t),this.name=Kx,this.events=new fu,this.initialized=!1,this.ignoredPayloadTypes=[Gf],this.requestQueue={state:zr.idle,queue:[]},this.sessionRequestQueue={state:zr.idle,queue:[]},this.requestQueueDelay=G.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Gn)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},G.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const n=Wn(bt({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:o,requiredNamespaces:c,optionalNamespaces:h,sessionProperties:p,relays:f}=n;let g=o,v,b=!1;if(g&&(b=this.client.core.pairing.pairings.get(g).active),!g||!b){const{topic:T,uri:j}=await this.client.core.pairing.create();g=T,v=j}const E=await this.client.core.crypto.generateKeyPair(),F=bt({requiredNamespaces:c,optionalNamespaces:h,relays:f??[{protocol:Gp}],proposer:{publicKey:E,metadata:this.client.metadata}},p&&{sessionProperties:p}),{reject:S,resolve:D,done:H}=un(G.FIVE_MINUTES,Zp);if(this.events.once(Ve("session_connect"),async({error:T,session:j})=>{if(T)S(T);else if(j){j.self.publicKey=E;const W=Wn(bt({},j),{requiredNamespaces:j.requiredNamespaces,optionalNamespaces:j.optionalNamespaces});await this.client.session.set(j.topic,W),await this.setExpiry(j.topic,j.expiry),g&&await this.client.core.pairing.updateMetadata({topic:g,metadata:j.peer.metadata}),D(W)}}),!g){const{message:T}=L("NO_MATCHING_KEY",`connect() pairing topic: ${g}`);throw new Error(T)}const M=await this.sendRequest({topic:g,method:"wc_sessionPropose",params:F}),Q=sr(G.FIVE_MINUTES);return await this.setProposal(M,bt({id:M,expiry:Q},F)),{uri:v,approval:H}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:n,relayProtocol:o,namespaces:c,sessionProperties:h}=r,p=this.client.proposal.get(n);let{pairingTopic:f,proposer:g,requiredNamespaces:v,optionalNamespaces:b}=p;f=f||"",$o(v)||(v=tw(c,"approve()"));const E=await this.client.core.crypto.generateKeyPair(),F=g.publicKey,S=await this.client.core.crypto.generateSharedKey(E,F);f&&n&&(await this.client.core.pairing.updateMetadata({topic:f,metadata:g.metadata}),await this.sendResult({id:n,topic:f,result:{relay:{protocol:o??"irn"},responderPublicKey:E}}),await this.client.proposal.delete(n,at("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:f}));const D=bt({relay:{protocol:o??"irn"},namespaces:c,requiredNamespaces:v,optionalNamespaces:b,pairingTopic:f,controller:{publicKey:E,metadata:this.client.metadata},expiry:sr(So)},h&&{sessionProperties:h});await this.client.core.relayer.subscribe(S),await this.sendRequest({topic:S,method:"wc_sessionSettle",params:D,throwOnFailedPublish:!0});const H=Wn(bt({},D),{topic:S,pairingTopic:f,acknowledged:!1,self:D.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:E});return await this.client.session.set(S,H),await this.setExpiry(S,sr(So)),{topic:S,acknowledged:()=>new Promise(M=>setTimeout(()=>M(this.client.session.get(S)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:n,reason:o}=r,{pairingTopic:c}=this.client.proposal.get(n);c&&(await this.sendError(n,c,o),await this.client.proposal.delete(n,at("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:n,namespaces:o}=r,c=await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:o}}),{done:h,resolve:p,reject:f}=un();return this.events.once(Ve("session_update",c),({error:g})=>{g?f(g):p()}),await this.client.session.update(n,{namespaces:o}),{acknowledged:h}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:n}=r,o=await this.sendRequest({topic:n,method:"wc_sessionExtend",params:{}}),{done:c,resolve:h,reject:p}=un();return this.events.once(Ve("session_extend",o),({error:f})=>{f?p(f):h()}),await this.setExpiry(n,sr(So)),{acknowledged:c}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:n,request:o,topic:c,expiry:h}=r,p=Iw(),{done:f,resolve:g,reject:v}=un(h,"Request expired. Please try again.");return this.events.once(Ve("session_request",p),({error:b,result:E})=>{b?v(b):g(E)}),await Promise.all([new Promise(async b=>{await this.sendRequest({clientRpcId:p,topic:c,method:"wc_sessionRequest",params:{request:o,chainId:n},expiry:h,throwOnFailedPublish:!0}).catch(E=>v(E)),this.client.events.emit("session_request_sent",{topic:c,request:o,chainId:n,id:p}),b()}),new Promise(async b=>{const E=await rw(this.client.core.storage,Nf);iw({id:p,topic:c,wcDeepLink:E}),b()}),f()]).then(b=>b[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:n,response:o}=r,{id:c}=o;ti(o)?await this.sendResult({id:c,topic:n,result:o.result,throwOnFailedPublish:!0}):or(o)&&await this.sendError(c,n,o.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:n}=r;if(this.client.session.keys.includes(n)){const o=await this.sendRequest({topic:n,method:"wc_sessionPing",params:{}}),{done:c,resolve:h,reject:p}=un();this.events.once(Ve("session_ping",o),({error:f})=>{f?p(f):h()}),await c()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:n,event:o,chainId:c}=r;await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:o,chainId:c}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:n}=r;this.client.session.keys.includes(n)?(await this.sendRequest({topic:n,method:"wc_sessionDelete",params:at("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(n)):await this.client.core.pairing.disconnect({topic:n})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(n=>nw(n,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(c=>{var h,p;return((h=c.peerMetadata)==null?void 0:h.url)&&((p=c.peerMetadata)==null?void 0:p.url)===r.peer.metadata.url&&c.topic&&c.topic!==n.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(c=>this.client.core.pairing.disconnect({topic:c.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(r,n)=>{const{self:o}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,at("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),n||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Nf).catch(c=>this.client.logger.warn(c)),this.getPendingSessionRequests().forEach(c=>{c.topic===r&&this.deletePendingSessionRequest(c.id,at("USER_DISCONNECTED"))})},this.deleteProposal=async(r,n)=>{await Promise.all([this.client.proposal.delete(r,at("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,n,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),o?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(c=>c.id!==r),o&&(this.sessionRequestQueue.state=zr.idle)},this.setExpiry=async(r,n)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:n}),this.client.core.expirer.set(r,n)},this.setProposal=async(r,n)=>{await this.client.proposal.set(r,n),this.client.core.expirer.set(r,n.expiry)},this.setPendingSessionRequest=async r=>{const n=Gn.wc_sessionRequest.req.ttl,{id:o,topic:c,params:h,verifyContext:p}=r;await this.client.pendingRequest.set(o,{id:o,topic:c,params:h,verifyContext:p}),n&&this.client.core.expirer.set(o,sr(n))},this.sendRequest=async r=>{const{topic:n,method:o,params:c,expiry:h,relayRpcId:p,clientRpcId:f,throwOnFailedPublish:g}=r,v=xi(o,c,f);if(Jf()&&Wx.includes(o)){const F=fn(JSON.stringify(v));this.client.core.verify.register({attestationId:F})}const b=await this.client.core.crypto.encode(n,v),E=Gn[o].req;return h&&(E.ttl=h),p&&(E.id=p),this.client.core.history.set(n,v),g?(E.internal=Wn(bt({},E.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,b,E)):this.client.core.relayer.publish(n,b,E).catch(F=>this.client.logger.error(F)),v.id},this.sendResult=async r=>{const{id:n,topic:o,result:c,throwOnFailedPublish:h}=r,p=jo(n,c),f=await this.client.core.crypto.encode(o,p),g=await this.client.core.history.get(o,n),v=Gn[g.request.method].res;h?(v.internal=Wn(bt({},v.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,f,v)):this.client.core.relayer.publish(o,f,v).catch(b=>this.client.logger.error(b)),await this.client.core.history.resolve(p)},this.sendError=async(r,n,o)=>{const c=du(r,o),h=await this.client.core.crypto.encode(n,c),p=await this.client.core.history.get(n,r),f=Gn[p.request.method].res;this.client.core.relayer.publish(n,h,f),await this.client.core.history.resolve(c)},this.cleanup=async()=>{const r=[],n=[];this.client.session.getAll().forEach(o=>{ri(o.expiry)&&r.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{ri(o.expiry)&&n.push(o.id)}),await Promise.all([...r.map(o=>this.deleteSession(o)),...n.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===zr.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=zr.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=zr.idle},this.processRequest=r=>{const{topic:n,payload:o}=r,c=o.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeRequest(n,o);case"wc_sessionSettle":return this.onSessionSettleRequest(n,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,o);case"wc_sessionExtend":return this.onSessionExtendRequest(n,o);case"wc_sessionPing":return this.onSessionPingRequest(n,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,o);case"wc_sessionRequest":return this.onSessionRequest(n,o);case"wc_sessionEvent":return this.onSessionEventRequest(n,o);default:return this.client.logger.info(`Unsupported request method ${c}`)}},this.onRelayEventResponse=async r=>{const{topic:n,payload:o}=r,c=(await this.client.core.history.get(n,o.id)).request.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeResponse(n,o);case"wc_sessionSettle":return this.onSessionSettleResponse(n,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,o);case"wc_sessionExtend":return this.onSessionExtendResponse(n,o);case"wc_sessionPing":return this.onSessionPingResponse(n,o);case"wc_sessionRequest":return this.onSessionRequestResponse(n,o);default:return this.client.logger.info(`Unsupported response method ${c}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:n}=r,{message:o}=L("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)},this.onSessionProposeRequest=async(r,n)=>{const{params:o,id:c}=n;try{this.isValidConnect(bt({},n.params));const h=sr(G.FIVE_MINUTES),p=bt({id:c,pairingTopic:r,expiry:h},o);await this.setProposal(c,p);const f=fn(JSON.stringify(n)),g=await this.getVerifyContext(f,p.proposer.metadata);this.client.events.emit("session_proposal",{id:c,params:p,verifyContext:g})}catch(h){await this.sendError(c,r,h),this.client.logger.error(h)}},this.onSessionProposeResponse=async(r,n)=>{const{id:o}=n;if(ti(n)){const{result:c}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:c});const h=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:h});const p=h.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:p});const f=c.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:f});const g=await this.client.core.crypto.generateSharedKey(p,f);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:g});const v=await this.client.core.relayer.subscribe(g);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:v}),await this.client.core.pairing.activate({topic:r})}else or(n)&&(await this.client.proposal.delete(o,at("USER_DISCONNECTED")),this.events.emit(Ve("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(r,n)=>{const{id:o,params:c}=n;try{this.isValidSessionSettleRequest(c);const{relay:h,controller:p,expiry:f,namespaces:g,requiredNamespaces:v,optionalNamespaces:b,sessionProperties:E,pairingTopic:F}=n.params,S=bt({topic:r,relay:h,expiry:f,namespaces:g,acknowledged:!0,pairingTopic:F,requiredNamespaces:v,optionalNamespaces:b,controller:p.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:p.publicKey,metadata:p.metadata}},E&&{sessionProperties:E});await this.sendResult({id:n.id,topic:r,result:!0}),this.events.emit(Ve("session_connect"),{session:S}),this.cleanupDuplicatePairings(S)}catch(h){await this.sendError(o,r,h),this.client.logger.error(h)}},this.onSessionSettleResponse=async(r,n)=>{const{id:o}=n;ti(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Ve("session_approve",o),{})):or(n)&&(await this.client.session.delete(r,at("USER_DISCONNECTED")),this.events.emit(Ve("session_approve",o),{error:n.error}))},this.onSessionUpdateRequest=async(r,n)=>{const{params:o,id:c}=n;try{const h=`${r}_session_update`,p=wo.get(h);if(p&&this.isRequestOutOfSync(p,c)){this.client.logger.info(`Discarding out of sync request - ${c}`);return}this.isValidUpdate(bt({topic:r},o)),await this.client.session.update(r,{namespaces:o.namespaces}),await this.sendResult({id:c,topic:r,result:!0}),this.client.events.emit("session_update",{id:c,topic:r,params:o}),wo.set(h,c)}catch(h){await this.sendError(c,r,h),this.client.logger.error(h)}},this.isRequestOutOfSync=(r,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,n)=>{const{id:o}=n;ti(n)?this.events.emit(Ve("session_update",o),{}):or(n)&&this.events.emit(Ve("session_update",o),{error:n.error})},this.onSessionExtendRequest=async(r,n)=>{const{id:o}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,sr(So)),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_extend",{id:o,topic:r})}catch(c){await this.sendError(o,r,c),this.client.logger.error(c)}},this.onSessionExtendResponse=(r,n)=>{const{id:o}=n;ti(n)?this.events.emit(Ve("session_extend",o),{}):or(n)&&this.events.emit(Ve("session_extend",o),{error:n.error})},this.onSessionPingRequest=async(r,n)=>{const{id:o}=n;try{this.isValidPing({topic:r}),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_ping",{id:o,topic:r})}catch(c){await this.sendError(o,r,c),this.client.logger.error(c)}},this.onSessionPingResponse=(r,n)=>{const{id:o}=n;setTimeout(()=>{ti(n)?this.events.emit(Ve("session_ping",o),{}):or(n)&&this.events.emit(Ve("session_ping",o),{error:n.error})},500)},this.onSessionDeleteRequest=async(r,n)=>{const{id:o}=n;try{this.isValidDisconnect({topic:r,reason:n.params}),await Promise.all([new Promise(c=>{this.client.core.relayer.once(ct.publish,async()=>{c(await this.deleteSession(r))})}),this.sendResult({id:o,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:o,topic:r})}catch(c){this.client.logger.error(c)}},this.onSessionRequest=async(r,n)=>{const{id:o,params:c}=n;try{this.isValidRequest(bt({topic:r},c));const h=fn(JSON.stringify(xi("wc_sessionRequest",c,o))),p=this.client.session.get(r),f=await this.getVerifyContext(h,p.peer.metadata),g={id:o,topic:r,params:c,verifyContext:f};await this.setPendingSessionRequest(g),this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue()}catch(h){await this.sendError(o,r,h),this.client.logger.error(h)}},this.onSessionRequestResponse=(r,n)=>{const{id:o}=n;ti(n)?this.events.emit(Ve("session_request",o),{result:n.result}):or(n)&&this.events.emit(Ve("session_request",o),{error:n.error})},this.onSessionEventRequest=async(r,n)=>{const{id:o,params:c}=n;try{const h=`${r}_session_event_${c.event.name}`,p=wo.get(h);if(p&&this.isRequestOutOfSync(p,o)){this.client.logger.info(`Discarding out of sync request - ${o}`);return}this.isValidEmit(bt({topic:r},c)),this.client.events.emit("session_event",{id:o,topic:r,params:c}),wo.set(h,o)}catch(h){await this.sendError(o,r,h),this.client.logger.error(h)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=zr.idle,this.processSessionRequestQueue()},G.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===zr.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=zr.active,this.client.events.emit("session_request",r)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=r=>{if(r.active)return;const n=this.client.proposal.getAll().find(o=>o.pairingTopic===r.topic);n&&this.onSessionProposeRequest(r.topic,xi("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties},n.id))},this.isValidConnect=async r=>{if(!Et(r)){const{message:f}=L("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(f)}const{pairingTopic:n,requiredNamespaces:o,optionalNamespaces:c,sessionProperties:h,relays:p}=r;if(ii(n)||await this.isValidPairingTopic(n),!sw(p,!0)){const{message:f}=L("MISSING_OR_INVALID",`connect() relays: ${p}`);throw new Error(f)}!ii(o)&&$o(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!ii(c)&&$o(c)!==0&&this.validateNamespaces(c,"optionalNamespaces"),ii(h)||this.validateSessionProps(h,"sessionProperties")},this.validateNamespaces=(r,n)=>{const o=ow(r,"connect()",n);if(o)throw new Error(o.message)},this.isValidApprove=async r=>{if(!Et(r))throw new Error(L("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:o,relayProtocol:c,sessionProperties:h}=r;await this.isValidProposalId(n);const p=this.client.proposal.get(n),f=Ec(o,"approve()");if(f)throw new Error(f.message);const g=Tl(p.requiredNamespaces,o,"approve()");if(g)throw new Error(g.message);if(!hn(c,!0)){const{message:v}=L("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(v)}ii(h)||this.validateSessionProps(h,"sessionProperties")},this.isValidReject=async r=>{if(!Et(r)){const{message:c}=L("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(c)}const{id:n,reason:o}=r;if(await this.isValidProposalId(n),!aw(o)){const{message:c}=L("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(c)}},this.isValidSessionSettleRequest=r=>{if(!Et(r)){const{message:g}=L("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(g)}const{relay:n,controller:o,namespaces:c,expiry:h}=r;if(!cw(n)){const{message:g}=L("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(g)}const p=uw(o,"onSessionSettleRequest()");if(p)throw new Error(p.message);const f=Ec(c,"onSessionSettleRequest()");if(f)throw new Error(f.message);if(ri(h)){const{message:g}=L("EXPIRED","onSessionSettleRequest()");throw new Error(g)}},this.isValidUpdate=async r=>{if(!Et(r)){const{message:f}=L("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(f)}const{topic:n,namespaces:o}=r;await this.isValidSessionTopic(n);const c=this.client.session.get(n),h=Ec(o,"update()");if(h)throw new Error(h.message);const p=Tl(c.requiredNamespaces,o,"update()");if(p)throw new Error(p.message)},this.isValidExtend=async r=>{if(!Et(r)){const{message:o}=L("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionTopic(n)},this.isValidRequest=async r=>{if(!Et(r)){const{message:f}=L("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(f)}const{topic:n,request:o,chainId:c,expiry:h}=r;await this.isValidSessionTopic(n);const{namespaces:p}=this.client.session.get(n);if(!Nl(p,c)){const{message:f}=L("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(f)}if(!hw(o)){const{message:f}=L("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(f)}if(!lw(p,c,o.method)){const{message:f}=L("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(f)}if(h&&!fw(h,Uc)){const{message:f}=L("MISSING_OR_INVALID",`request() expiry: ${h}. Expiry must be a number (in seconds) between ${Uc.min} and ${Uc.max}`);throw new Error(f)}},this.isValidRespond=async r=>{var n;if(!Et(r)){const{message:h}=L("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(h)}const{topic:o,response:c}=r;try{await this.isValidSessionTopic(o)}catch(h){throw(n=r==null?void 0:r.response)!=null&&n.id&&this.cleanupAfterResponse(r),h}if(!pw(c)){const{message:h}=L("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(c)}`);throw new Error(h)}},this.isValidPing=async r=>{if(!Et(r)){const{message:o}=L("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async r=>{if(!Et(r)){const{message:p}=L("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(p)}const{topic:n,event:o,chainId:c}=r;await this.isValidSessionTopic(n);const{namespaces:h}=this.client.session.get(n);if(!Nl(h,c)){const{message:p}=L("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(p)}if(!dw(o)){const{message:p}=L("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(p)}if(!gw(h,c,o.name)){const{message:p}=L("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(p)}},this.isValidDisconnect=async r=>{if(!Et(r)){const{message:o}=L("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(r,n)=>{const o={verified:{verifyUrl:n.verifyUrl||ln,validation:"UNKNOWN",origin:n.url||""}};try{const c=await this.client.core.verify.resolve({attestationId:r,verifyUrl:n.verifyUrl});c&&(o.verified.origin=c.origin,o.verified.isScam=c.isScam,o.verified.validation=c.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(c){this.client.logger.info(c)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(r,n)=>{Object.values(r).forEach(o=>{if(!hn(o,!1)){const{message:c}=L("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(c)}})}}async isInitialized(){if(!this.initialized){const{message:t}=L("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(ct.message,async t=>{const{topic:r,message:n}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const o=await this.client.core.crypto.decode(r,n);try{gu(o)?(this.client.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):ns(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.client.core.history.delete(r,o.id)):this.onRelayEventUnknownPayload({topic:r,payload:o})}catch(c){this.client.logger.error(c)}})}registerExpirerEvents(){this.client.core.expirer.on(Jt.expired,async t=>{const{topic:r,id:n}=Wf(t.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,L("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Yn.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!hn(t,!1)){const{message:r}=L("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=L("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(ri(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=L("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!hn(t,!1)){const{message:r}=L("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=L("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(ri(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=L("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(hn(t,!1)){const{message:r}=L("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=L("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!yw(t)){const{message:r}=L("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=L("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(ri(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=L("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class tS extends Vo{constructor(t,r){super(t,r,kx,Fu),this.core=t,this.logger=r}}class rS extends Vo{constructor(t,r){super(t,r,Vx,Fu),this.core=t,this.logger=r}}class iS extends Vo{constructor(t,r){super(t,r,Gx,Fu,n=>n.id),this.core=t,this.logger=r}}let nS=class Xp extends h_{constructor(t){super(t),this.protocol=Jp,this.version=Qp,this.name=Lc.name,this.events=new Qt.EventEmitter,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(o){throw this.logger.error(o.message),o}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(o){throw this.logger.error(o.message),o}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(o){throw this.logger.error(o.message),o}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(o){throw this.logger.error(o.message),o}},this.update=async n=>{try{return await this.engine.update(n)}catch(o){throw this.logger.error(o.message),o}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(o){throw this.logger.error(o.message),o}},this.request=async n=>{try{return await this.engine.request(n)}catch(o){throw this.logger.error(o.message),o}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(o){throw this.logger.error(o.message),o}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(o){throw this.logger.error(o.message),o}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(o){throw this.logger.error(o.message),o}},this.find=n=>{try{return this.engine.find(n)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(t==null?void 0:t.name)||Lc.name,this.metadata=(t==null?void 0:t.metadata)||ew();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Uo(Mo({level:(t==null?void 0:t.logger)||Lc.logger}));this.core=(t==null?void 0:t.core)||new Hx(t),this.logger=Pt(r,this.name),this.session=new rS(this.core,this.logger),this.proposal=new tS(this.core,this.logger),this.pendingRequest=new iS(this.core,this.logger),this.engine=new eS(this)}static async init(t){const r=new Xp(t);return await r.initialize(),r}get context(){return It(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};class ai extends Xf{constructor(t){super(t),this.events=new Qt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(xi(t.method,t.params||[],t.id||pu().toString()),r)}async requestStrict(t,r){return new Promise(async(n,o)=>{if(!this.connection.connected)try{await this.open()}catch(c){o(c)}this.events.on(`${t.id}`,c=>{or(c)?o(c.error):n(c.result)});try{await this.connection.send(t,r)}catch(c){o(c)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),ns(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const zf="error",sS="wss://relay.walletconnect.com",oS="wc",aS="universal_provider",jf=`${oS}@2:${aS}:`,cS="https://rpc.walletconnect.com/v1/",jr={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Jn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},au={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(s,t){(function(){var r,n="4.17.21",o=200,c="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",h="Expected a function",p="Invalid `variable` option passed into `_.template`",f="__lodash_hash_undefined__",g=500,v="__lodash_placeholder__",b=1,E=2,F=4,S=1,D=2,H=1,M=2,Q=4,T=8,j=16,W=32,le=64,re=128,oe=256,we=512,qt=30,zt="...",xt=800,mr=16,Br=1,ee=2,q=3,V=1/0,K=9007199254740991,de=17976931348623157e292,fe=0/0,ae=4294967295,Ae=ae-1,be=ae>>>1,Oe=[["ary",re],["bind",H],["bindKey",M],["curry",T],["curryRight",j],["flip",we],["partial",W],["partialRight",le],["rearg",oe]],Y="[object Arguments]",qe="[object Array]",St="[object AsyncFunction]",$e="[object Boolean]",je="[object Date]",Ft="[object DOMException]",ut="[object Error]",At="[object Function]",Lr="[object GeneratorFunction]",Xe="[object Map]",wr="[object Number]",gn="[object Null]",Ot="[object Object]",Oi="[object Promise]",$i="[object Proxy]",ar="[object RegExp]",et="[object Set]",cr="[object String]",br="[object Symbol]",Ci="[object Undefined]",ur="[object WeakMap]",Ri="[object WeakSet]",jt="[object ArrayBuffer]",Bt="[object DataView]",Ur="[object Float32Array]",nt="[object Float64Array]",Ti="[object Int8Array]",Ni="[object Int16Array]",yn="[object Int32Array]",Di="[object Uint8Array]",Mr="[object Uint8ClampedArray]",qi="[object Uint16Array]",zi="[object Uint32Array]",Ko=/\b__p \+= '';/g,_r=/\b(__p \+=) '' \+/g,us=/(__e\(.*?\)|\b__t\)) \+\n'';/g,hs=/&(?:amp|lt|gt|quot|#39);/g,ls=/[&<>"']/g,vn=RegExp(hs.source),ci=RegExp(ls.source),mn=/<%-([\s\S]+?)%>/g,wn=/<%([\s\S]+?)%>/g,ji=/<%=([\s\S]+?)%>/g,ui=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Go=/^\w*$/,Wo=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,bn=/[\\^$.*+?()[\]{}|]/g,Jo=RegExp(bn.source),_n=/^\s+/,fs=/\s/,En=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Er=/\{\n\/\* \[wrapped with (.+)\] \*/,Qo=/,? & /,Yo=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Zo=/[()=,{}\[\]\/\s]/,Xo=/\\(\\)?/g,ea=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Lt=/\w*$/,ta=/^[-+]0x[0-9a-f]+$/i,ra=/^0b[01]+$/i,ia=/^\[object .+?Constructor\]$/,na=/^0o[0-7]+$/i,sa=/^(?:0|[1-9]\d*)$/,Ir=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Bi=/($^)/,oa=/['\n\r\u2028\u2029\\]/g,Li="\\ud800-\\udfff",aa="\\u0300-\\u036f",ca="\\ufe20-\\ufe2f",Ui="\\u20d0-\\u20ff",ps=aa+ca+Ui,ds="\\u2700-\\u27bf",Yt="a-z\\xdf-\\xf6\\xf8-\\xff",ua="\\xac\\xb1\\xd7\\xf7",ha="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",la="\\u2000-\\u206f",fa=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",gs="A-Z\\xc0-\\xd6\\xd8-\\xde",ys="\\ufe0e\\ufe0f",hi=ua+ha+la+fa,In="[']",li="["+Li+"]",Pn="["+hi+"]",fi="["+ps+"]",vs="\\d+",pa="["+ds+"]",ms="["+Yt+"]",ws="[^"+Li+hi+vs+ds+Yt+gs+"]",Mi="\\ud83c[\\udffb-\\udfff]",da="(?:"+fi+"|"+Mi+")",bs="[^"+Li+"]",Hi="(?:\\ud83c[\\udde6-\\uddff]){2}",Hr="[\\ud800-\\udbff][\\udc00-\\udfff]",$t="["+gs+"]",_s="\\u200d",Es="(?:"+ms+"|"+ws+")",hr="(?:"+$t+"|"+ws+")",Is="(?:"+In+"(?:d|ll|m|re|s|t|ve))?",Ps="(?:"+In+"(?:D|LL|M|RE|S|T|VE))?",xs=da+"?",Ss="["+ys+"]?",ga="(?:"+_s+"(?:"+[bs,Hi,Hr].join("|")+")"+Ss+xs+")*",Pr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Fs="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",As=Ss+xs+ga,ki="(?:"+[pa,Hi,Hr].join("|")+")"+As,ya="(?:"+[bs+fi+"?",fi,Hi,Hr,li].join("|")+")",xn=RegExp(In,"g"),va=RegExp(fi,"g"),Vi=RegExp(Mi+"(?="+Mi+")|"+ya+As,"g"),Os=RegExp([$t+"?"+ms+"+"+Is+"(?="+[Pn,$t,"$"].join("|")+")",hr+"+"+Ps+"(?="+[Pn,$t+Es,"$"].join("|")+")",$t+"?"+Es+"+"+Is,$t+"+"+Ps,Fs,Pr,vs,ki].join("|"),"g"),$s=RegExp("["+_s+Li+ps+ys+"]"),pi=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Cs=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ma=-1,Pe={};Pe[Ur]=Pe[nt]=Pe[Ti]=Pe[Ni]=Pe[yn]=Pe[Di]=Pe[Mr]=Pe[qi]=Pe[zi]=!0,Pe[Y]=Pe[qe]=Pe[jt]=Pe[$e]=Pe[Bt]=Pe[je]=Pe[ut]=Pe[At]=Pe[Xe]=Pe[wr]=Pe[Ot]=Pe[ar]=Pe[et]=Pe[cr]=Pe[ur]=!1;var Ie={};Ie[Y]=Ie[qe]=Ie[jt]=Ie[Bt]=Ie[$e]=Ie[je]=Ie[Ur]=Ie[nt]=Ie[Ti]=Ie[Ni]=Ie[yn]=Ie[Xe]=Ie[wr]=Ie[Ot]=Ie[ar]=Ie[et]=Ie[cr]=Ie[br]=Ie[Di]=Ie[Mr]=Ie[qi]=Ie[zi]=!0,Ie[ut]=Ie[At]=Ie[ur]=!1;var m={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},I={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},R={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},B={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},xe=parseFloat,ie=parseInt,Ce=typeof Jn=="object"&&Jn&&Jn.Object===Object&&Jn,He=typeof self=="object"&&self&&self.Object===Object&&self,ye=Ce||He||Function("return this")(),Se=t&&!t.nodeType&&t,Be=Se&&!0&&s&&!s.nodeType&&s,dt=Be&&Be.exports===Se,ke=dt&&Ce.process,Re=function(){try{var P=Be&&Be.require&&Be.require("util").types;return P||ke&&ke.binding&&ke.binding("util")}catch{}}(),ht=Re&&Re.isArrayBuffer,Zt=Re&&Re.isDate,Ut=Re&&Re.isMap,lr=Re&&Re.isRegExp,Sn=Re&&Re.isSet,di=Re&&Re.isTypedArray;function Je(P,O,A){switch(A.length){case 0:return P.call(O);case 1:return P.call(O,A[0]);case 2:return P.call(O,A[0],A[1]);case 3:return P.call(O,A[0],A[1],A[2])}return P.apply(O,A)}function rd(P,O,A,U){for(var te=-1,me=P==null?0:P.length;++te<me;){var Ke=P[te];O(U,Ke,A(Ke),P)}return U}function Mt(P,O){for(var A=-1,U=P==null?0:P.length;++A<U&&O(P[A],A,P)!==!1;);return P}function id(P,O){for(var A=P==null?0:P.length;A--&&O(P[A],A,P)!==!1;);return P}function $u(P,O){for(var A=-1,U=P==null?0:P.length;++A<U;)if(!O(P[A],A,P))return!1;return!0}function kr(P,O){for(var A=-1,U=P==null?0:P.length,te=0,me=[];++A<U;){var Ke=P[A];O(Ke,A,P)&&(me[te++]=Ke)}return me}function Rs(P,O){var A=P==null?0:P.length;return!!A&&Ki(P,O,0)>-1}function wa(P,O,A){for(var U=-1,te=P==null?0:P.length;++U<te;)if(A(O,P[U]))return!0;return!1}function Te(P,O){for(var A=-1,U=P==null?0:P.length,te=Array(U);++A<U;)te[A]=O(P[A],A,P);return te}function Vr(P,O){for(var A=-1,U=O.length,te=P.length;++A<U;)P[te+A]=O[A];return P}function ba(P,O,A,U){var te=-1,me=P==null?0:P.length;for(U&&me&&(A=P[++te]);++te<me;)A=O(A,P[te],te,P);return A}function nd(P,O,A,U){var te=P==null?0:P.length;for(U&&te&&(A=P[--te]);te--;)A=O(A,P[te],te,P);return A}function _a(P,O){for(var A=-1,U=P==null?0:P.length;++A<U;)if(O(P[A],A,P))return!0;return!1}var sd=Ea("length");function od(P){return P.split("")}function ad(P){return P.match(Yo)||[]}function Cu(P,O,A){var U;return A(P,function(te,me,Ke){if(O(te,me,Ke))return U=me,!1}),U}function Ts(P,O,A,U){for(var te=P.length,me=A+(U?1:-1);U?me--:++me<te;)if(O(P[me],me,P))return me;return-1}function Ki(P,O,A){return O===O?wd(P,O,A):Ts(P,Ru,A)}function cd(P,O,A,U){for(var te=A-1,me=P.length;++te<me;)if(U(P[te],O))return te;return-1}function Ru(P){return P!==P}function Tu(P,O){var A=P==null?0:P.length;return A?Pa(P,O)/A:fe}function Ea(P){return function(O){return O==null?r:O[P]}}function Ia(P){return function(O){return P==null?r:P[O]}}function Nu(P,O,A,U,te){return te(P,function(me,Ke,Fe){A=U?(U=!1,me):O(A,me,Ke,Fe)}),A}function ud(P,O){var A=P.length;for(P.sort(O);A--;)P[A]=P[A].value;return P}function Pa(P,O){for(var A,U=-1,te=P.length;++U<te;){var me=O(P[U]);me!==r&&(A=A===r?me:A+me)}return A}function xa(P,O){for(var A=-1,U=Array(P);++A<P;)U[A]=O(A);return U}function hd(P,O){return Te(O,function(A){return[A,P[A]]})}function Du(P){return P&&P.slice(0,Bu(P)+1).replace(_n,"")}function Ct(P){return function(O){return P(O)}}function Sa(P,O){return Te(O,function(A){return P[A]})}function Fn(P,O){return P.has(O)}function qu(P,O){for(var A=-1,U=P.length;++A<U&&Ki(O,P[A],0)>-1;);return A}function zu(P,O){for(var A=P.length;A--&&Ki(O,P[A],0)>-1;);return A}function ld(P,O){for(var A=P.length,U=0;A--;)P[A]===O&&++U;return U}var fd=Ia(m),pd=Ia(I);function dd(P){return"\\"+B[P]}function gd(P,O){return P==null?r:P[O]}function Gi(P){return $s.test(P)}function yd(P){return pi.test(P)}function vd(P){for(var O,A=[];!(O=P.next()).done;)A.push(O.value);return A}function Fa(P){var O=-1,A=Array(P.size);return P.forEach(function(U,te){A[++O]=[te,U]}),A}function ju(P,O){return function(A){return P(O(A))}}function Kr(P,O){for(var A=-1,U=P.length,te=0,me=[];++A<U;){var Ke=P[A];(Ke===O||Ke===v)&&(P[A]=v,me[te++]=A)}return me}function Ns(P){var O=-1,A=Array(P.size);return P.forEach(function(U){A[++O]=U}),A}function md(P){var O=-1,A=Array(P.size);return P.forEach(function(U){A[++O]=[U,U]}),A}function wd(P,O,A){for(var U=A-1,te=P.length;++U<te;)if(P[U]===O)return U;return-1}function bd(P,O,A){for(var U=A+1;U--;)if(P[U]===O)return U;return U}function Wi(P){return Gi(P)?Ed(P):sd(P)}function Xt(P){return Gi(P)?Id(P):od(P)}function Bu(P){for(var O=P.length;O--&&fs.test(P.charAt(O)););return O}var _d=Ia(R);function Ed(P){for(var O=Vi.lastIndex=0;Vi.test(P);)++O;return O}function Id(P){return P.match(Vi)||[]}function Pd(P){return P.match(Os)||[]}var xd=function P(O){O=O==null?ye:Ji.defaults(ye.Object(),O,Ji.pick(ye,Cs));var A=O.Array,U=O.Date,te=O.Error,me=O.Function,Ke=O.Math,Fe=O.Object,Aa=O.RegExp,Sd=O.String,Ht=O.TypeError,Ds=A.prototype,Fd=me.prototype,Qi=Fe.prototype,qs=O["__core-js_shared__"],zs=Fd.toString,Ee=Qi.hasOwnProperty,Ad=0,Lu=function(){var e=/[^.]+$/.exec(qs&&qs.keys&&qs.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),js=Qi.toString,Od=zs.call(Fe),$d=ye._,Cd=Aa("^"+zs.call(Ee).replace(bn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Bs=dt?O.Buffer:r,Gr=O.Symbol,Ls=O.Uint8Array,Uu=Bs?Bs.allocUnsafe:r,Us=ju(Fe.getPrototypeOf,Fe),Mu=Fe.create,Hu=Qi.propertyIsEnumerable,Ms=Ds.splice,ku=Gr?Gr.isConcatSpreadable:r,An=Gr?Gr.iterator:r,gi=Gr?Gr.toStringTag:r,Hs=function(){try{var e=bi(Fe,"defineProperty");return e({},"",{}),e}catch{}}(),Rd=O.clearTimeout!==ye.clearTimeout&&O.clearTimeout,Td=U&&U.now!==ye.Date.now&&U.now,Nd=O.setTimeout!==ye.setTimeout&&O.setTimeout,ks=Ke.ceil,Vs=Ke.floor,Oa=Fe.getOwnPropertySymbols,Dd=Bs?Bs.isBuffer:r,Vu=O.isFinite,qd=Ds.join,zd=ju(Fe.keys,Fe),Ge=Ke.max,st=Ke.min,jd=U.now,Bd=O.parseInt,Ku=Ke.random,Ld=Ds.reverse,$a=bi(O,"DataView"),On=bi(O,"Map"),Ca=bi(O,"Promise"),Yi=bi(O,"Set"),$n=bi(O,"WeakMap"),Cn=bi(Fe,"create"),Ks=$n&&new $n,Zi={},Ud=_i($a),Md=_i(On),Hd=_i(Ca),kd=_i(Yi),Vd=_i($n),Gs=Gr?Gr.prototype:r,Rn=Gs?Gs.valueOf:r,Gu=Gs?Gs.toString:r;function d(e){if(ze(e)&&!ne(e)&&!(e instanceof ge)){if(e instanceof kt)return e;if(Ee.call(e,"__wrapped__"))return Wh(e)}return new kt(e)}var Xi=function(){function e(){}return function(i){if(!De(i))return{};if(Mu)return Mu(i);e.prototype=i;var a=new e;return e.prototype=r,a}}();function Ws(){}function kt(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}d.templateSettings={escape:mn,evaluate:wn,interpolate:ji,variable:"",imports:{_:d}},d.prototype=Ws.prototype,d.prototype.constructor=d,kt.prototype=Xi(Ws.prototype),kt.prototype.constructor=kt;function ge(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ae,this.__views__=[]}function Kd(){var e=new ge(this.__wrapped__);return e.__actions__=gt(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=gt(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=gt(this.__views__),e}function Gd(){if(this.__filtered__){var e=new ge(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Wd(){var e=this.__wrapped__.value(),i=this.__dir__,a=ne(e),u=i<0,l=a?e.length:0,y=oy(0,l,this.__views__),w=y.start,_=y.end,x=_-w,$=u?_:w-1,C=this.__iteratees__,N=C.length,z=0,k=st(x,this.__takeCount__);if(!a||!u&&l==x&&k==x)return vh(e,this.__actions__);var Z=[];e:for(;x--&&z<k;){$+=i;for(var ce=-1,X=e[$];++ce<N;){var pe=C[ce],ve=pe.iteratee,Nt=pe.type,pt=ve(X);if(Nt==ee)X=pt;else if(!pt){if(Nt==Br)continue e;break e}}Z[z++]=X}return Z}ge.prototype=Xi(Ws.prototype),ge.prototype.constructor=ge;function yi(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var u=e[i];this.set(u[0],u[1])}}function Jd(){this.__data__=Cn?Cn(null):{},this.size=0}function Qd(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function Yd(e){var i=this.__data__;if(Cn){var a=i[e];return a===f?r:a}return Ee.call(i,e)?i[e]:r}function Zd(e){var i=this.__data__;return Cn?i[e]!==r:Ee.call(i,e)}function Xd(e,i){var a=this.__data__;return this.size+=this.has(e)?0:1,a[e]=Cn&&i===r?f:i,this}yi.prototype.clear=Jd,yi.prototype.delete=Qd,yi.prototype.get=Yd,yi.prototype.has=Zd,yi.prototype.set=Xd;function xr(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var u=e[i];this.set(u[0],u[1])}}function eg(){this.__data__=[],this.size=0}function tg(e){var i=this.__data__,a=Js(i,e);if(a<0)return!1;var u=i.length-1;return a==u?i.pop():Ms.call(i,a,1),--this.size,!0}function rg(e){var i=this.__data__,a=Js(i,e);return a<0?r:i[a][1]}function ig(e){return Js(this.__data__,e)>-1}function ng(e,i){var a=this.__data__,u=Js(a,e);return u<0?(++this.size,a.push([e,i])):a[u][1]=i,this}xr.prototype.clear=eg,xr.prototype.delete=tg,xr.prototype.get=rg,xr.prototype.has=ig,xr.prototype.set=ng;function Sr(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var u=e[i];this.set(u[0],u[1])}}function sg(){this.size=0,this.__data__={hash:new yi,map:new(On||xr),string:new yi}}function og(e){var i=ao(this,e).delete(e);return this.size-=i?1:0,i}function ag(e){return ao(this,e).get(e)}function cg(e){return ao(this,e).has(e)}function ug(e,i){var a=ao(this,e),u=a.size;return a.set(e,i),this.size+=a.size==u?0:1,this}Sr.prototype.clear=sg,Sr.prototype.delete=og,Sr.prototype.get=ag,Sr.prototype.has=cg,Sr.prototype.set=ug;function vi(e){var i=-1,a=e==null?0:e.length;for(this.__data__=new Sr;++i<a;)this.add(e[i])}function hg(e){return this.__data__.set(e,f),this}function lg(e){return this.__data__.has(e)}vi.prototype.add=vi.prototype.push=hg,vi.prototype.has=lg;function er(e){var i=this.__data__=new xr(e);this.size=i.size}function fg(){this.__data__=new xr,this.size=0}function pg(e){var i=this.__data__,a=i.delete(e);return this.size=i.size,a}function dg(e){return this.__data__.get(e)}function gg(e){return this.__data__.has(e)}function yg(e,i){var a=this.__data__;if(a instanceof xr){var u=a.__data__;if(!On||u.length<o-1)return u.push([e,i]),this.size=++a.size,this;a=this.__data__=new Sr(u)}return a.set(e,i),this.size=a.size,this}er.prototype.clear=fg,er.prototype.delete=pg,er.prototype.get=dg,er.prototype.has=gg,er.prototype.set=yg;function Wu(e,i){var a=ne(e),u=!a&&Ei(e),l=!a&&!u&&Zr(e),y=!a&&!u&&!l&&nn(e),w=a||u||l||y,_=w?xa(e.length,Sd):[],x=_.length;for(var $ in e)(i||Ee.call(e,$))&&!(w&&($=="length"||l&&($=="offset"||$=="parent")||y&&($=="buffer"||$=="byteLength"||$=="byteOffset")||$r($,x)))&&_.push($);return _}function Ju(e){var i=e.length;return i?e[Ma(0,i-1)]:r}function vg(e,i){return co(gt(e),mi(i,0,e.length))}function mg(e){return co(gt(e))}function Ra(e,i,a){(a!==r&&!tr(e[i],a)||a===r&&!(i in e))&&Fr(e,i,a)}function Tn(e,i,a){var u=e[i];(!(Ee.call(e,i)&&tr(u,a))||a===r&&!(i in e))&&Fr(e,i,a)}function Js(e,i){for(var a=e.length;a--;)if(tr(e[a][0],i))return a;return-1}function wg(e,i,a,u){return Wr(e,function(l,y,w){i(u,l,a(l),w)}),u}function Qu(e,i){return e&&pr(i,Qe(i),e)}function bg(e,i){return e&&pr(i,vt(i),e)}function Fr(e,i,a){i=="__proto__"&&Hs?Hs(e,i,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[i]=a}function Ta(e,i){for(var a=-1,u=i.length,l=A(u),y=e==null;++a<u;)l[a]=y?r:pc(e,i[a]);return l}function mi(e,i,a){return e===e&&(a!==r&&(e=e<=a?e:a),i!==r&&(e=e>=i?e:i)),e}function Vt(e,i,a,u,l,y){var w,_=i&b,x=i&E,$=i&F;if(a&&(w=l?a(e,u,l,y):a(e)),w!==r)return w;if(!De(e))return e;var C=ne(e);if(C){if(w=cy(e),!_)return gt(e,w)}else{var N=ot(e),z=N==At||N==Lr;if(Zr(e))return bh(e,_);if(N==Ot||N==Y||z&&!l){if(w=x||z?{}:Bh(e),!_)return x?Yg(e,bg(w,e)):Qg(e,Qu(w,e))}else{if(!Ie[N])return l?e:{};w=uy(e,N,_)}}y||(y=new er);var k=y.get(e);if(k)return k;y.set(e,w),dl(e)?e.forEach(function(X){w.add(Vt(X,i,a,X,e,y))}):fl(e)&&e.forEach(function(X,pe){w.set(pe,Vt(X,i,a,pe,e,y))});var Z=$?x?Xa:Za:x?vt:Qe,ce=C?r:Z(e);return Mt(ce||e,function(X,pe){ce&&(pe=X,X=e[pe]),Tn(w,pe,Vt(X,i,a,pe,e,y))}),w}function _g(e){var i=Qe(e);return function(a){return Yu(a,e,i)}}function Yu(e,i,a){var u=a.length;if(e==null)return!u;for(e=Fe(e);u--;){var l=a[u],y=i[l],w=e[l];if(w===r&&!(l in e)||!y(w))return!1}return!0}function Zu(e,i,a){if(typeof e!="function")throw new Ht(h);return Ln(function(){e.apply(r,a)},i)}function Nn(e,i,a,u){var l=-1,y=Rs,w=!0,_=e.length,x=[],$=i.length;if(!_)return x;a&&(i=Te(i,Ct(a))),u?(y=wa,w=!1):i.length>=o&&(y=Fn,w=!1,i=new vi(i));e:for(;++l<_;){var C=e[l],N=a==null?C:a(C);if(C=u||C!==0?C:0,w&&N===N){for(var z=$;z--;)if(i[z]===N)continue e;x.push(C)}else y(i,N,u)||x.push(C)}return x}var Wr=xh(fr),Xu=xh(Da,!0);function Eg(e,i){var a=!0;return Wr(e,function(u,l,y){return a=!!i(u,l,y),a}),a}function Qs(e,i,a){for(var u=-1,l=e.length;++u<l;){var y=e[u],w=i(y);if(w!=null&&(_===r?w===w&&!Tt(w):a(w,_)))var _=w,x=y}return x}function Ig(e,i,a,u){var l=e.length;for(a=se(a),a<0&&(a=-a>l?0:l+a),u=u===r||u>l?l:se(u),u<0&&(u+=l),u=a>u?0:yl(u);a<u;)e[a++]=i;return e}function eh(e,i){var a=[];return Wr(e,function(u,l,y){i(u,l,y)&&a.push(u)}),a}function tt(e,i,a,u,l){var y=-1,w=e.length;for(a||(a=ly),l||(l=[]);++y<w;){var _=e[y];i>0&&a(_)?i>1?tt(_,i-1,a,u,l):Vr(l,_):u||(l[l.length]=_)}return l}var Na=Sh(),th=Sh(!0);function fr(e,i){return e&&Na(e,i,Qe)}function Da(e,i){return e&&th(e,i,Qe)}function Ys(e,i){return kr(i,function(a){return Cr(e[a])})}function wi(e,i){i=Qr(i,e);for(var a=0,u=i.length;e!=null&&a<u;)e=e[dr(i[a++])];return a&&a==u?e:r}function rh(e,i,a){var u=i(e);return ne(e)?u:Vr(u,a(e))}function lt(e){return e==null?e===r?Ci:gn:gi&&gi in Fe(e)?sy(e):my(e)}function qa(e,i){return e>i}function Pg(e,i){return e!=null&&Ee.call(e,i)}function xg(e,i){return e!=null&&i in Fe(e)}function Sg(e,i,a){return e>=st(i,a)&&e<Ge(i,a)}function za(e,i,a){for(var u=a?wa:Rs,l=e[0].length,y=e.length,w=y,_=A(y),x=1/0,$=[];w--;){var C=e[w];w&&i&&(C=Te(C,Ct(i))),x=st(C.length,x),_[w]=!a&&(i||l>=120&&C.length>=120)?new vi(w&&C):r}C=e[0];var N=-1,z=_[0];e:for(;++N<l&&$.length<x;){var k=C[N],Z=i?i(k):k;if(k=a||k!==0?k:0,!(z?Fn(z,Z):u($,Z,a))){for(w=y;--w;){var ce=_[w];if(!(ce?Fn(ce,Z):u(e[w],Z,a)))continue e}z&&z.push(Z),$.push(k)}}return $}function Fg(e,i,a,u){return fr(e,function(l,y,w){i(u,a(l),y,w)}),u}function Dn(e,i,a){i=Qr(i,e),e=Hh(e,i);var u=e==null?e:e[dr(Gt(i))];return u==null?r:Je(u,e,a)}function ih(e){return ze(e)&&lt(e)==Y}function Ag(e){return ze(e)&&lt(e)==jt}function Og(e){return ze(e)&&lt(e)==je}function qn(e,i,a,u,l){return e===i?!0:e==null||i==null||!ze(e)&&!ze(i)?e!==e&&i!==i:$g(e,i,a,u,qn,l)}function $g(e,i,a,u,l,y){var w=ne(e),_=ne(i),x=w?qe:ot(e),$=_?qe:ot(i);x=x==Y?Ot:x,$=$==Y?Ot:$;var C=x==Ot,N=$==Ot,z=x==$;if(z&&Zr(e)){if(!Zr(i))return!1;w=!0,C=!1}if(z&&!C)return y||(y=new er),w||nn(e)?qh(e,i,a,u,l,y):iy(e,i,x,a,u,l,y);if(!(a&S)){var k=C&&Ee.call(e,"__wrapped__"),Z=N&&Ee.call(i,"__wrapped__");if(k||Z){var ce=k?e.value():e,X=Z?i.value():i;return y||(y=new er),l(ce,X,a,u,y)}}return z?(y||(y=new er),ny(e,i,a,u,l,y)):!1}function Cg(e){return ze(e)&&ot(e)==Xe}function ja(e,i,a,u){var l=a.length,y=l,w=!u;if(e==null)return!y;for(e=Fe(e);l--;){var _=a[l];if(w&&_[2]?_[1]!==e[_[0]]:!(_[0]in e))return!1}for(;++l<y;){_=a[l];var x=_[0],$=e[x],C=_[1];if(w&&_[2]){if($===r&&!(x in e))return!1}else{var N=new er;if(u)var z=u($,C,x,e,i,N);if(!(z===r?qn(C,$,S|D,u,N):z))return!1}}return!0}function nh(e){if(!De(e)||py(e))return!1;var i=Cr(e)?Cd:ia;return i.test(_i(e))}function Rg(e){return ze(e)&&lt(e)==ar}function Tg(e){return ze(e)&&ot(e)==et}function Ng(e){return ze(e)&&go(e.length)&&!!Pe[lt(e)]}function sh(e){return typeof e=="function"?e:e==null?mt:typeof e=="object"?ne(e)?ch(e[0],e[1]):ah(e):Fl(e)}function Ba(e){if(!Bn(e))return zd(e);var i=[];for(var a in Fe(e))Ee.call(e,a)&&a!="constructor"&&i.push(a);return i}function Dg(e){if(!De(e))return vy(e);var i=Bn(e),a=[];for(var u in e)u=="constructor"&&(i||!Ee.call(e,u))||a.push(u);return a}function La(e,i){return e<i}function oh(e,i){var a=-1,u=yt(e)?A(e.length):[];return Wr(e,function(l,y,w){u[++a]=i(l,y,w)}),u}function ah(e){var i=tc(e);return i.length==1&&i[0][2]?Uh(i[0][0],i[0][1]):function(a){return a===e||ja(a,e,i)}}function ch(e,i){return ic(e)&&Lh(i)?Uh(dr(e),i):function(a){var u=pc(a,e);return u===r&&u===i?dc(a,e):qn(i,u,S|D)}}function Zs(e,i,a,u,l){e!==i&&Na(i,function(y,w){if(l||(l=new er),De(y))qg(e,i,w,a,Zs,u,l);else{var _=u?u(sc(e,w),y,w+"",e,i,l):r;_===r&&(_=y),Ra(e,w,_)}},vt)}function qg(e,i,a,u,l,y,w){var _=sc(e,a),x=sc(i,a),$=w.get(x);if($){Ra(e,a,$);return}var C=y?y(_,x,a+"",e,i,w):r,N=C===r;if(N){var z=ne(x),k=!z&&Zr(x),Z=!z&&!k&&nn(x);C=x,z||k||Z?ne(_)?C=_:Le(_)?C=gt(_):k?(N=!1,C=bh(x,!0)):Z?(N=!1,C=_h(x,!0)):C=[]:Un(x)||Ei(x)?(C=_,Ei(_)?C=vl(_):(!De(_)||Cr(_))&&(C=Bh(x))):N=!1}N&&(w.set(x,C),l(C,x,u,y,w),w.delete(x)),Ra(e,a,C)}function uh(e,i){var a=e.length;if(a)return i+=i<0?a:0,$r(i,a)?e[i]:r}function hh(e,i,a){i.length?i=Te(i,function(y){return ne(y)?function(w){return wi(w,y.length===1?y[0]:y)}:y}):i=[mt];var u=-1;i=Te(i,Ct(J()));var l=oh(e,function(y,w,_){var x=Te(i,function($){return $(y)});return{criteria:x,index:++u,value:y}});return ud(l,function(y,w){return Jg(y,w,a)})}function zg(e,i){return lh(e,i,function(a,u){return dc(e,u)})}function lh(e,i,a){for(var u=-1,l=i.length,y={};++u<l;){var w=i[u],_=wi(e,w);a(_,w)&&zn(y,Qr(w,e),_)}return y}function jg(e){return function(i){return wi(i,e)}}function Ua(e,i,a,u){var l=u?cd:Ki,y=-1,w=i.length,_=e;for(e===i&&(i=gt(i)),a&&(_=Te(e,Ct(a)));++y<w;)for(var x=0,$=i[y],C=a?a($):$;(x=l(_,C,x,u))>-1;)_!==e&&Ms.call(_,x,1),Ms.call(e,x,1);return e}function fh(e,i){for(var a=e?i.length:0,u=a-1;a--;){var l=i[a];if(a==u||l!==y){var y=l;$r(l)?Ms.call(e,l,1):Va(e,l)}}return e}function Ma(e,i){return e+Vs(Ku()*(i-e+1))}function Bg(e,i,a,u){for(var l=-1,y=Ge(ks((i-e)/(a||1)),0),w=A(y);y--;)w[u?y:++l]=e,e+=a;return w}function Ha(e,i){var a="";if(!e||i<1||i>K)return a;do i%2&&(a+=e),i=Vs(i/2),i&&(e+=e);while(i);return a}function he(e,i){return oc(Mh(e,i,mt),e+"")}function Lg(e){return Ju(sn(e))}function Ug(e,i){var a=sn(e);return co(a,mi(i,0,a.length))}function zn(e,i,a,u){if(!De(e))return e;i=Qr(i,e);for(var l=-1,y=i.length,w=y-1,_=e;_!=null&&++l<y;){var x=dr(i[l]),$=a;if(x==="__proto__"||x==="constructor"||x==="prototype")return e;if(l!=w){var C=_[x];$=u?u(C,x,_):r,$===r&&($=De(C)?C:$r(i[l+1])?[]:{})}Tn(_,x,$),_=_[x]}return e}var ph=Ks?function(e,i){return Ks.set(e,i),e}:mt,Mg=Hs?function(e,i){return Hs(e,"toString",{configurable:!0,enumerable:!1,value:yc(i),writable:!0})}:mt;function Hg(e){return co(sn(e))}function Kt(e,i,a){var u=-1,l=e.length;i<0&&(i=-i>l?0:l+i),a=a>l?l:a,a<0&&(a+=l),l=i>a?0:a-i>>>0,i>>>=0;for(var y=A(l);++u<l;)y[u]=e[u+i];return y}function kg(e,i){var a;return Wr(e,function(u,l,y){return a=i(u,l,y),!a}),!!a}function Xs(e,i,a){var u=0,l=e==null?u:e.length;if(typeof i=="number"&&i===i&&l<=be){for(;u<l;){var y=u+l>>>1,w=e[y];w!==null&&!Tt(w)&&(a?w<=i:w<i)?u=y+1:l=y}return l}return ka(e,i,mt,a)}function ka(e,i,a,u){var l=0,y=e==null?0:e.length;if(y===0)return 0;i=a(i);for(var w=i!==i,_=i===null,x=Tt(i),$=i===r;l<y;){var C=Vs((l+y)/2),N=a(e[C]),z=N!==r,k=N===null,Z=N===N,ce=Tt(N);if(w)var X=u||Z;else $?X=Z&&(u||z):_?X=Z&&z&&(u||!k):x?X=Z&&z&&!k&&(u||!ce):k||ce?X=!1:X=u?N<=i:N<i;X?l=C+1:y=C}return st(y,Ae)}function dh(e,i){for(var a=-1,u=e.length,l=0,y=[];++a<u;){var w=e[a],_=i?i(w):w;if(!a||!tr(_,x)){var x=_;y[l++]=w===0?0:w}}return y}function gh(e){return typeof e=="number"?e:Tt(e)?fe:+e}function Rt(e){if(typeof e=="string")return e;if(ne(e))return Te(e,Rt)+"";if(Tt(e))return Gu?Gu.call(e):"";var i=e+"";return i=="0"&&1/e==-V?"-0":i}function Jr(e,i,a){var u=-1,l=Rs,y=e.length,w=!0,_=[],x=_;if(a)w=!1,l=wa;else if(y>=o){var $=i?null:ty(e);if($)return Ns($);w=!1,l=Fn,x=new vi}else x=i?[]:_;e:for(;++u<y;){var C=e[u],N=i?i(C):C;if(C=a||C!==0?C:0,w&&N===N){for(var z=x.length;z--;)if(x[z]===N)continue e;i&&x.push(N),_.push(C)}else l(x,N,a)||(x!==_&&x.push(N),_.push(C))}return _}function Va(e,i){return i=Qr(i,e),e=Hh(e,i),e==null||delete e[dr(Gt(i))]}function yh(e,i,a,u){return zn(e,i,a(wi(e,i)),u)}function eo(e,i,a,u){for(var l=e.length,y=u?l:-1;(u?y--:++y<l)&&i(e[y],y,e););return a?Kt(e,u?0:y,u?y+1:l):Kt(e,u?y+1:0,u?l:y)}function vh(e,i){var a=e;return a instanceof ge&&(a=a.value()),ba(i,function(u,l){return l.func.apply(l.thisArg,Vr([u],l.args))},a)}function Ka(e,i,a){var u=e.length;if(u<2)return u?Jr(e[0]):[];for(var l=-1,y=A(u);++l<u;)for(var w=e[l],_=-1;++_<u;)_!=l&&(y[l]=Nn(y[l]||w,e[_],i,a));return Jr(tt(y,1),i,a)}function mh(e,i,a){for(var u=-1,l=e.length,y=i.length,w={};++u<l;){var _=u<y?i[u]:r;a(w,e[u],_)}return w}function Ga(e){return Le(e)?e:[]}function Wa(e){return typeof e=="function"?e:mt}function Qr(e,i){return ne(e)?e:ic(e,i)?[e]:Gh(_e(e))}var Vg=he;function Yr(e,i,a){var u=e.length;return a=a===r?u:a,!i&&a>=u?e:Kt(e,i,a)}var wh=Rd||function(e){return ye.clearTimeout(e)};function bh(e,i){if(i)return e.slice();var a=e.length,u=Uu?Uu(a):new e.constructor(a);return e.copy(u),u}function Ja(e){var i=new e.constructor(e.byteLength);return new Ls(i).set(new Ls(e)),i}function Kg(e,i){var a=i?Ja(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.byteLength)}function Gg(e){var i=new e.constructor(e.source,Lt.exec(e));return i.lastIndex=e.lastIndex,i}function Wg(e){return Rn?Fe(Rn.call(e)):{}}function _h(e,i){var a=i?Ja(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.length)}function Eh(e,i){if(e!==i){var a=e!==r,u=e===null,l=e===e,y=Tt(e),w=i!==r,_=i===null,x=i===i,$=Tt(i);if(!_&&!$&&!y&&e>i||y&&w&&x&&!_&&!$||u&&w&&x||!a&&x||!l)return 1;if(!u&&!y&&!$&&e<i||$&&a&&l&&!u&&!y||_&&a&&l||!w&&l||!x)return-1}return 0}function Jg(e,i,a){for(var u=-1,l=e.criteria,y=i.criteria,w=l.length,_=a.length;++u<w;){var x=Eh(l[u],y[u]);if(x){if(u>=_)return x;var $=a[u];return x*($=="desc"?-1:1)}}return e.index-i.index}function Ih(e,i,a,u){for(var l=-1,y=e.length,w=a.length,_=-1,x=i.length,$=Ge(y-w,0),C=A(x+$),N=!u;++_<x;)C[_]=i[_];for(;++l<w;)(N||l<y)&&(C[a[l]]=e[l]);for(;$--;)C[_++]=e[l++];return C}function Ph(e,i,a,u){for(var l=-1,y=e.length,w=-1,_=a.length,x=-1,$=i.length,C=Ge(y-_,0),N=A(C+$),z=!u;++l<C;)N[l]=e[l];for(var k=l;++x<$;)N[k+x]=i[x];for(;++w<_;)(z||l<y)&&(N[k+a[w]]=e[l++]);return N}function gt(e,i){var a=-1,u=e.length;for(i||(i=A(u));++a<u;)i[a]=e[a];return i}function pr(e,i,a,u){var l=!a;a||(a={});for(var y=-1,w=i.length;++y<w;){var _=i[y],x=u?u(a[_],e[_],_,a,e):r;x===r&&(x=e[_]),l?Fr(a,_,x):Tn(a,_,x)}return a}function Qg(e,i){return pr(e,rc(e),i)}function Yg(e,i){return pr(e,zh(e),i)}function to(e,i){return function(a,u){var l=ne(a)?rd:wg,y=i?i():{};return l(a,e,J(u,2),y)}}function en(e){return he(function(i,a){var u=-1,l=a.length,y=l>1?a[l-1]:r,w=l>2?a[2]:r;for(y=e.length>3&&typeof y=="function"?(l--,y):r,w&&ft(a[0],a[1],w)&&(y=l<3?r:y,l=1),i=Fe(i);++u<l;){var _=a[u];_&&e(i,_,u,y)}return i})}function xh(e,i){return function(a,u){if(a==null)return a;if(!yt(a))return e(a,u);for(var l=a.length,y=i?l:-1,w=Fe(a);(i?y--:++y<l)&&u(w[y],y,w)!==!1;);return a}}function Sh(e){return function(i,a,u){for(var l=-1,y=Fe(i),w=u(i),_=w.length;_--;){var x=w[e?_:++l];if(a(y[x],x,y)===!1)break}return i}}function Zg(e,i,a){var u=i&H,l=jn(e);function y(){var w=this&&this!==ye&&this instanceof y?l:e;return w.apply(u?a:this,arguments)}return y}function Fh(e){return function(i){i=_e(i);var a=Gi(i)?Xt(i):r,u=a?a[0]:i.charAt(0),l=a?Yr(a,1).join(""):i.slice(1);return u[e]()+l}}function tn(e){return function(i){return ba(xl(Pl(i).replace(xn,"")),e,"")}}function jn(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var a=Xi(e.prototype),u=e.apply(a,i);return De(u)?u:a}}function Xg(e,i,a){var u=jn(e);function l(){for(var y=arguments.length,w=A(y),_=y,x=rn(l);_--;)w[_]=arguments[_];var $=y<3&&w[0]!==x&&w[y-1]!==x?[]:Kr(w,x);if(y-=$.length,y<a)return Rh(e,i,ro,l.placeholder,r,w,$,r,r,a-y);var C=this&&this!==ye&&this instanceof l?u:e;return Je(C,this,w)}return l}function Ah(e){return function(i,a,u){var l=Fe(i);if(!yt(i)){var y=J(a,3);i=Qe(i),a=function(_){return y(l[_],_,l)}}var w=e(i,a,u);return w>-1?l[y?i[w]:w]:r}}function Oh(e){return Or(function(i){var a=i.length,u=a,l=kt.prototype.thru;for(e&&i.reverse();u--;){var y=i[u];if(typeof y!="function")throw new Ht(h);if(l&&!w&&oo(y)=="wrapper")var w=new kt([],!0)}for(u=w?u:a;++u<a;){y=i[u];var _=oo(y),x=_=="wrapper"?ec(y):r;x&&nc(x[0])&&x[1]==(re|T|W|oe)&&!x[4].length&&x[9]==1?w=w[oo(x[0])].apply(w,x[3]):w=y.length==1&&nc(y)?w[_]():w.thru(y)}return function(){var $=arguments,C=$[0];if(w&&$.length==1&&ne(C))return w.plant(C).value();for(var N=0,z=a?i[N].apply(this,$):C;++N<a;)z=i[N].call(this,z);return z}})}function ro(e,i,a,u,l,y,w,_,x,$){var C=i&re,N=i&H,z=i&M,k=i&(T|j),Z=i&we,ce=z?r:jn(e);function X(){for(var pe=arguments.length,ve=A(pe),Nt=pe;Nt--;)ve[Nt]=arguments[Nt];if(k)var pt=rn(X),Dt=ld(ve,pt);if(u&&(ve=Ih(ve,u,l,k)),y&&(ve=Ph(ve,y,w,k)),pe-=Dt,k&&pe<$){var Ue=Kr(ve,pt);return Rh(e,i,ro,X.placeholder,a,ve,Ue,_,x,$-pe)}var rr=N?a:this,Tr=z?rr[e]:e;return pe=ve.length,_?ve=wy(ve,_):Z&&pe>1&&ve.reverse(),C&&x<pe&&(ve.length=x),this&&this!==ye&&this instanceof X&&(Tr=ce||jn(Tr)),Tr.apply(rr,ve)}return X}function $h(e,i){return function(a,u){return Fg(a,e,i(u),{})}}function io(e,i){return function(a,u){var l;if(a===r&&u===r)return i;if(a!==r&&(l=a),u!==r){if(l===r)return u;typeof a=="string"||typeof u=="string"?(a=Rt(a),u=Rt(u)):(a=gh(a),u=gh(u)),l=e(a,u)}return l}}function Qa(e){return Or(function(i){return i=Te(i,Ct(J())),he(function(a){var u=this;return e(i,function(l){return Je(l,u,a)})})})}function no(e,i){i=i===r?" ":Rt(i);var a=i.length;if(a<2)return a?Ha(i,e):i;var u=Ha(i,ks(e/Wi(i)));return Gi(i)?Yr(Xt(u),0,e).join(""):u.slice(0,e)}function ey(e,i,a,u){var l=i&H,y=jn(e);function w(){for(var _=-1,x=arguments.length,$=-1,C=u.length,N=A(C+x),z=this&&this!==ye&&this instanceof w?y:e;++$<C;)N[$]=u[$];for(;x--;)N[$++]=arguments[++_];return Je(z,l?a:this,N)}return w}function Ch(e){return function(i,a,u){return u&&typeof u!="number"&&ft(i,a,u)&&(a=u=r),i=Rr(i),a===r?(a=i,i=0):a=Rr(a),u=u===r?i<a?1:-1:Rr(u),Bg(i,a,u,e)}}function so(e){return function(i,a){return typeof i=="string"&&typeof a=="string"||(i=Wt(i),a=Wt(a)),e(i,a)}}function Rh(e,i,a,u,l,y,w,_,x,$){var C=i&T,N=C?w:r,z=C?r:w,k=C?y:r,Z=C?r:y;i|=C?W:le,i&=~(C?le:W),i&Q||(i&=~(H|M));var ce=[e,i,l,k,N,Z,z,_,x,$],X=a.apply(r,ce);return nc(e)&&kh(X,ce),X.placeholder=u,Vh(X,e,i)}function Ya(e){var i=Ke[e];return function(a,u){if(a=Wt(a),u=u==null?0:st(se(u),292),u&&Vu(a)){var l=(_e(a)+"e").split("e"),y=i(l[0]+"e"+(+l[1]+u));return l=(_e(y)+"e").split("e"),+(l[0]+"e"+(+l[1]-u))}return i(a)}}var ty=Yi&&1/Ns(new Yi([,-0]))[1]==V?function(e){return new Yi(e)}:wc;function Th(e){return function(i){var a=ot(i);return a==Xe?Fa(i):a==et?md(i):hd(i,e(i))}}function Ar(e,i,a,u,l,y,w,_){var x=i&M;if(!x&&typeof e!="function")throw new Ht(h);var $=u?u.length:0;if($||(i&=~(W|le),u=l=r),w=w===r?w:Ge(se(w),0),_=_===r?_:se(_),$-=l?l.length:0,i&le){var C=u,N=l;u=l=r}var z=x?r:ec(e),k=[e,i,a,u,l,C,N,y,w,_];if(z&&yy(k,z),e=k[0],i=k[1],a=k[2],u=k[3],l=k[4],_=k[9]=k[9]===r?x?0:e.length:Ge(k[9]-$,0),!_&&i&(T|j)&&(i&=~(T|j)),!i||i==H)var Z=Zg(e,i,a);else i==T||i==j?Z=Xg(e,i,_):(i==W||i==(H|W))&&!l.length?Z=ey(e,i,a,u):Z=ro.apply(r,k);var ce=z?ph:kh;return Vh(ce(Z,k),e,i)}function Nh(e,i,a,u){return e===r||tr(e,Qi[a])&&!Ee.call(u,a)?i:e}function Dh(e,i,a,u,l,y){return De(e)&&De(i)&&(y.set(i,e),Zs(e,i,r,Dh,y),y.delete(i)),e}function ry(e){return Un(e)?r:e}function qh(e,i,a,u,l,y){var w=a&S,_=e.length,x=i.length;if(_!=x&&!(w&&x>_))return!1;var $=y.get(e),C=y.get(i);if($&&C)return $==i&&C==e;var N=-1,z=!0,k=a&D?new vi:r;for(y.set(e,i),y.set(i,e);++N<_;){var Z=e[N],ce=i[N];if(u)var X=w?u(ce,Z,N,i,e,y):u(Z,ce,N,e,i,y);if(X!==r){if(X)continue;z=!1;break}if(k){if(!_a(i,function(pe,ve){if(!Fn(k,ve)&&(Z===pe||l(Z,pe,a,u,y)))return k.push(ve)})){z=!1;break}}else if(!(Z===ce||l(Z,ce,a,u,y))){z=!1;break}}return y.delete(e),y.delete(i),z}function iy(e,i,a,u,l,y,w){switch(a){case Bt:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case jt:return!(e.byteLength!=i.byteLength||!y(new Ls(e),new Ls(i)));case $e:case je:case wr:return tr(+e,+i);case ut:return e.name==i.name&&e.message==i.message;case ar:case cr:return e==i+"";case Xe:var _=Fa;case et:var x=u&S;if(_||(_=Ns),e.size!=i.size&&!x)return!1;var $=w.get(e);if($)return $==i;u|=D,w.set(e,i);var C=qh(_(e),_(i),u,l,y,w);return w.delete(e),C;case br:if(Rn)return Rn.call(e)==Rn.call(i)}return!1}function ny(e,i,a,u,l,y){var w=a&S,_=Za(e),x=_.length,$=Za(i),C=$.length;if(x!=C&&!w)return!1;for(var N=x;N--;){var z=_[N];if(!(w?z in i:Ee.call(i,z)))return!1}var k=y.get(e),Z=y.get(i);if(k&&Z)return k==i&&Z==e;var ce=!0;y.set(e,i),y.set(i,e);for(var X=w;++N<x;){z=_[N];var pe=e[z],ve=i[z];if(u)var Nt=w?u(ve,pe,z,i,e,y):u(pe,ve,z,e,i,y);if(!(Nt===r?pe===ve||l(pe,ve,a,u,y):Nt)){ce=!1;break}X||(X=z=="constructor")}if(ce&&!X){var pt=e.constructor,Dt=i.constructor;pt!=Dt&&"constructor"in e&&"constructor"in i&&!(typeof pt=="function"&&pt instanceof pt&&typeof Dt=="function"&&Dt instanceof Dt)&&(ce=!1)}return y.delete(e),y.delete(i),ce}function Or(e){return oc(Mh(e,r,Yh),e+"")}function Za(e){return rh(e,Qe,rc)}function Xa(e){return rh(e,vt,zh)}var ec=Ks?function(e){return Ks.get(e)}:wc;function oo(e){for(var i=e.name+"",a=Zi[i],u=Ee.call(Zi,i)?a.length:0;u--;){var l=a[u],y=l.func;if(y==null||y==e)return l.name}return i}function rn(e){var i=Ee.call(d,"placeholder")?d:e;return i.placeholder}function J(){var e=d.iteratee||vc;return e=e===vc?sh:e,arguments.length?e(arguments[0],arguments[1]):e}function ao(e,i){var a=e.__data__;return fy(i)?a[typeof i=="string"?"string":"hash"]:a.map}function tc(e){for(var i=Qe(e),a=i.length;a--;){var u=i[a],l=e[u];i[a]=[u,l,Lh(l)]}return i}function bi(e,i){var a=gd(e,i);return nh(a)?a:r}function sy(e){var i=Ee.call(e,gi),a=e[gi];try{e[gi]=r;var u=!0}catch{}var l=js.call(e);return u&&(i?e[gi]=a:delete e[gi]),l}var rc=Oa?function(e){return e==null?[]:(e=Fe(e),kr(Oa(e),function(i){return Hu.call(e,i)}))}:bc,zh=Oa?function(e){for(var i=[];e;)Vr(i,rc(e)),e=Us(e);return i}:bc,ot=lt;($a&&ot(new $a(new ArrayBuffer(1)))!=Bt||On&&ot(new On)!=Xe||Ca&&ot(Ca.resolve())!=Oi||Yi&&ot(new Yi)!=et||$n&&ot(new $n)!=ur)&&(ot=function(e){var i=lt(e),a=i==Ot?e.constructor:r,u=a?_i(a):"";if(u)switch(u){case Ud:return Bt;case Md:return Xe;case Hd:return Oi;case kd:return et;case Vd:return ur}return i});function oy(e,i,a){for(var u=-1,l=a.length;++u<l;){var y=a[u],w=y.size;switch(y.type){case"drop":e+=w;break;case"dropRight":i-=w;break;case"take":i=st(i,e+w);break;case"takeRight":e=Ge(e,i-w);break}}return{start:e,end:i}}function ay(e){var i=e.match(Er);return i?i[1].split(Qo):[]}function jh(e,i,a){i=Qr(i,e);for(var u=-1,l=i.length,y=!1;++u<l;){var w=dr(i[u]);if(!(y=e!=null&&a(e,w)))break;e=e[w]}return y||++u!=l?y:(l=e==null?0:e.length,!!l&&go(l)&&$r(w,l)&&(ne(e)||Ei(e)))}function cy(e){var i=e.length,a=new e.constructor(i);return i&&typeof e[0]=="string"&&Ee.call(e,"index")&&(a.index=e.index,a.input=e.input),a}function Bh(e){return typeof e.constructor=="function"&&!Bn(e)?Xi(Us(e)):{}}function uy(e,i,a){var u=e.constructor;switch(i){case jt:return Ja(e);case $e:case je:return new u(+e);case Bt:return Kg(e,a);case Ur:case nt:case Ti:case Ni:case yn:case Di:case Mr:case qi:case zi:return _h(e,a);case Xe:return new u;case wr:case cr:return new u(e);case ar:return Gg(e);case et:return new u;case br:return Wg(e)}}function hy(e,i){var a=i.length;if(!a)return e;var u=a-1;return i[u]=(a>1?"& ":"")+i[u],i=i.join(a>2?", ":" "),e.replace(En,`{
/* [wrapped with `+i+`] */
`)}function ly(e){return ne(e)||Ei(e)||!!(ku&&e&&e[ku])}function $r(e,i){var a=typeof e;return i=i??K,!!i&&(a=="number"||a!="symbol"&&sa.test(e))&&e>-1&&e%1==0&&e<i}function ft(e,i,a){if(!De(a))return!1;var u=typeof i;return(u=="number"?yt(a)&&$r(i,a.length):u=="string"&&i in a)?tr(a[i],e):!1}function ic(e,i){if(ne(e))return!1;var a=typeof e;return a=="number"||a=="symbol"||a=="boolean"||e==null||Tt(e)?!0:Go.test(e)||!ui.test(e)||i!=null&&e in Fe(i)}function fy(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function nc(e){var i=oo(e),a=d[i];if(typeof a!="function"||!(i in ge.prototype))return!1;if(e===a)return!0;var u=ec(a);return!!u&&e===u[0]}function py(e){return!!Lu&&Lu in e}var dy=qs?Cr:_c;function Bn(e){var i=e&&e.constructor,a=typeof i=="function"&&i.prototype||Qi;return e===a}function Lh(e){return e===e&&!De(e)}function Uh(e,i){return function(a){return a==null?!1:a[e]===i&&(i!==r||e in Fe(a))}}function gy(e){var i=fo(e,function(u){return a.size===g&&a.clear(),u}),a=i.cache;return i}function yy(e,i){var a=e[1],u=i[1],l=a|u,y=l<(H|M|re),w=u==re&&a==T||u==re&&a==oe&&e[7].length<=i[8]||u==(re|oe)&&i[7].length<=i[8]&&a==T;if(!(y||w))return e;u&H&&(e[2]=i[2],l|=a&H?0:Q);var _=i[3];if(_){var x=e[3];e[3]=x?Ih(x,_,i[4]):_,e[4]=x?Kr(e[3],v):i[4]}return _=i[5],_&&(x=e[5],e[5]=x?Ph(x,_,i[6]):_,e[6]=x?Kr(e[5],v):i[6]),_=i[7],_&&(e[7]=_),u&re&&(e[8]=e[8]==null?i[8]:st(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=l,e}function vy(e){var i=[];if(e!=null)for(var a in Fe(e))i.push(a);return i}function my(e){return js.call(e)}function Mh(e,i,a){return i=Ge(i===r?e.length-1:i,0),function(){for(var u=arguments,l=-1,y=Ge(u.length-i,0),w=A(y);++l<y;)w[l]=u[i+l];l=-1;for(var _=A(i+1);++l<i;)_[l]=u[l];return _[i]=a(w),Je(e,this,_)}}function Hh(e,i){return i.length<2?e:wi(e,Kt(i,0,-1))}function wy(e,i){for(var a=e.length,u=st(i.length,a),l=gt(e);u--;){var y=i[u];e[u]=$r(y,a)?l[y]:r}return e}function sc(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var kh=Kh(ph),Ln=Nd||function(e,i){return ye.setTimeout(e,i)},oc=Kh(Mg);function Vh(e,i,a){var u=i+"";return oc(e,hy(u,by(ay(u),a)))}function Kh(e){var i=0,a=0;return function(){var u=jd(),l=mr-(u-a);if(a=u,l>0){if(++i>=xt)return arguments[0]}else i=0;return e.apply(r,arguments)}}function co(e,i){var a=-1,u=e.length,l=u-1;for(i=i===r?u:i;++a<i;){var y=Ma(a,l),w=e[y];e[y]=e[a],e[a]=w}return e.length=i,e}var Gh=gy(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(Wo,function(a,u,l,y){i.push(l?y.replace(Xo,"$1"):u||a)}),i});function dr(e){if(typeof e=="string"||Tt(e))return e;var i=e+"";return i=="0"&&1/e==-V?"-0":i}function _i(e){if(e!=null){try{return zs.call(e)}catch{}try{return e+""}catch{}}return""}function by(e,i){return Mt(Oe,function(a){var u="_."+a[0];i&a[1]&&!Rs(e,u)&&e.push(u)}),e.sort()}function Wh(e){if(e instanceof ge)return e.clone();var i=new kt(e.__wrapped__,e.__chain__);return i.__actions__=gt(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function _y(e,i,a){(a?ft(e,i,a):i===r)?i=1:i=Ge(se(i),0);var u=e==null?0:e.length;if(!u||i<1)return[];for(var l=0,y=0,w=A(ks(u/i));l<u;)w[y++]=Kt(e,l,l+=i);return w}function Ey(e){for(var i=-1,a=e==null?0:e.length,u=0,l=[];++i<a;){var y=e[i];y&&(l[u++]=y)}return l}function Iy(){var e=arguments.length;if(!e)return[];for(var i=A(e-1),a=arguments[0],u=e;u--;)i[u-1]=arguments[u];return Vr(ne(a)?gt(a):[a],tt(i,1))}var Py=he(function(e,i){return Le(e)?Nn(e,tt(i,1,Le,!0)):[]}),xy=he(function(e,i){var a=Gt(i);return Le(a)&&(a=r),Le(e)?Nn(e,tt(i,1,Le,!0),J(a,2)):[]}),Sy=he(function(e,i){var a=Gt(i);return Le(a)&&(a=r),Le(e)?Nn(e,tt(i,1,Le,!0),r,a):[]});function Fy(e,i,a){var u=e==null?0:e.length;return u?(i=a||i===r?1:se(i),Kt(e,i<0?0:i,u)):[]}function Ay(e,i,a){var u=e==null?0:e.length;return u?(i=a||i===r?1:se(i),i=u-i,Kt(e,0,i<0?0:i)):[]}function Oy(e,i){return e&&e.length?eo(e,J(i,3),!0,!0):[]}function $y(e,i){return e&&e.length?eo(e,J(i,3),!0):[]}function Cy(e,i,a,u){var l=e==null?0:e.length;return l?(a&&typeof a!="number"&&ft(e,i,a)&&(a=0,u=l),Ig(e,i,a,u)):[]}function Jh(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var l=a==null?0:se(a);return l<0&&(l=Ge(u+l,0)),Ts(e,J(i,3),l)}function Qh(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var l=u-1;return a!==r&&(l=se(a),l=a<0?Ge(u+l,0):st(l,u-1)),Ts(e,J(i,3),l,!0)}function Yh(e){var i=e==null?0:e.length;return i?tt(e,1):[]}function Ry(e){var i=e==null?0:e.length;return i?tt(e,V):[]}function Ty(e,i){var a=e==null?0:e.length;return a?(i=i===r?1:se(i),tt(e,i)):[]}function Ny(e){for(var i=-1,a=e==null?0:e.length,u={};++i<a;){var l=e[i];u[l[0]]=l[1]}return u}function Zh(e){return e&&e.length?e[0]:r}function Dy(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var l=a==null?0:se(a);return l<0&&(l=Ge(u+l,0)),Ki(e,i,l)}function qy(e){var i=e==null?0:e.length;return i?Kt(e,0,-1):[]}var zy=he(function(e){var i=Te(e,Ga);return i.length&&i[0]===e[0]?za(i):[]}),jy=he(function(e){var i=Gt(e),a=Te(e,Ga);return i===Gt(a)?i=r:a.pop(),a.length&&a[0]===e[0]?za(a,J(i,2)):[]}),By=he(function(e){var i=Gt(e),a=Te(e,Ga);return i=typeof i=="function"?i:r,i&&a.pop(),a.length&&a[0]===e[0]?za(a,r,i):[]});function Ly(e,i){return e==null?"":qd.call(e,i)}function Gt(e){var i=e==null?0:e.length;return i?e[i-1]:r}function Uy(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var l=u;return a!==r&&(l=se(a),l=l<0?Ge(u+l,0):st(l,u-1)),i===i?bd(e,i,l):Ts(e,Ru,l,!0)}function My(e,i){return e&&e.length?uh(e,se(i)):r}var Hy=he(Xh);function Xh(e,i){return e&&e.length&&i&&i.length?Ua(e,i):e}function ky(e,i,a){return e&&e.length&&i&&i.length?Ua(e,i,J(a,2)):e}function Vy(e,i,a){return e&&e.length&&i&&i.length?Ua(e,i,r,a):e}var Ky=Or(function(e,i){var a=e==null?0:e.length,u=Ta(e,i);return fh(e,Te(i,function(l){return $r(l,a)?+l:l}).sort(Eh)),u});function Gy(e,i){var a=[];if(!(e&&e.length))return a;var u=-1,l=[],y=e.length;for(i=J(i,3);++u<y;){var w=e[u];i(w,u,e)&&(a.push(w),l.push(u))}return fh(e,l),a}function ac(e){return e==null?e:Ld.call(e)}function Wy(e,i,a){var u=e==null?0:e.length;return u?(a&&typeof a!="number"&&ft(e,i,a)?(i=0,a=u):(i=i==null?0:se(i),a=a===r?u:se(a)),Kt(e,i,a)):[]}function Jy(e,i){return Xs(e,i)}function Qy(e,i,a){return ka(e,i,J(a,2))}function Yy(e,i){var a=e==null?0:e.length;if(a){var u=Xs(e,i);if(u<a&&tr(e[u],i))return u}return-1}function Zy(e,i){return Xs(e,i,!0)}function Xy(e,i,a){return ka(e,i,J(a,2),!0)}function ev(e,i){var a=e==null?0:e.length;if(a){var u=Xs(e,i,!0)-1;if(tr(e[u],i))return u}return-1}function tv(e){return e&&e.length?dh(e):[]}function rv(e,i){return e&&e.length?dh(e,J(i,2)):[]}function iv(e){var i=e==null?0:e.length;return i?Kt(e,1,i):[]}function nv(e,i,a){return e&&e.length?(i=a||i===r?1:se(i),Kt(e,0,i<0?0:i)):[]}function sv(e,i,a){var u=e==null?0:e.length;return u?(i=a||i===r?1:se(i),i=u-i,Kt(e,i<0?0:i,u)):[]}function ov(e,i){return e&&e.length?eo(e,J(i,3),!1,!0):[]}function av(e,i){return e&&e.length?eo(e,J(i,3)):[]}var cv=he(function(e){return Jr(tt(e,1,Le,!0))}),uv=he(function(e){var i=Gt(e);return Le(i)&&(i=r),Jr(tt(e,1,Le,!0),J(i,2))}),hv=he(function(e){var i=Gt(e);return i=typeof i=="function"?i:r,Jr(tt(e,1,Le,!0),r,i)});function lv(e){return e&&e.length?Jr(e):[]}function fv(e,i){return e&&e.length?Jr(e,J(i,2)):[]}function pv(e,i){return i=typeof i=="function"?i:r,e&&e.length?Jr(e,r,i):[]}function cc(e){if(!(e&&e.length))return[];var i=0;return e=kr(e,function(a){if(Le(a))return i=Ge(a.length,i),!0}),xa(i,function(a){return Te(e,Ea(a))})}function el(e,i){if(!(e&&e.length))return[];var a=cc(e);return i==null?a:Te(a,function(u){return Je(i,r,u)})}var dv=he(function(e,i){return Le(e)?Nn(e,i):[]}),gv=he(function(e){return Ka(kr(e,Le))}),yv=he(function(e){var i=Gt(e);return Le(i)&&(i=r),Ka(kr(e,Le),J(i,2))}),vv=he(function(e){var i=Gt(e);return i=typeof i=="function"?i:r,Ka(kr(e,Le),r,i)}),mv=he(cc);function wv(e,i){return mh(e||[],i||[],Tn)}function bv(e,i){return mh(e||[],i||[],zn)}var _v=he(function(e){var i=e.length,a=i>1?e[i-1]:r;return a=typeof a=="function"?(e.pop(),a):r,el(e,a)});function tl(e){var i=d(e);return i.__chain__=!0,i}function Ev(e,i){return i(e),e}function uo(e,i){return i(e)}var Iv=Or(function(e){var i=e.length,a=i?e[0]:0,u=this.__wrapped__,l=function(y){return Ta(y,e)};return i>1||this.__actions__.length||!(u instanceof ge)||!$r(a)?this.thru(l):(u=u.slice(a,+a+(i?1:0)),u.__actions__.push({func:uo,args:[l],thisArg:r}),new kt(u,this.__chain__).thru(function(y){return i&&!y.length&&y.push(r),y}))});function Pv(){return tl(this)}function xv(){return new kt(this.value(),this.__chain__)}function Sv(){this.__values__===r&&(this.__values__=gl(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function Fv(){return this}function Av(e){for(var i,a=this;a instanceof Ws;){var u=Wh(a);u.__index__=0,u.__values__=r,i?l.__wrapped__=u:i=u;var l=u;a=a.__wrapped__}return l.__wrapped__=e,i}function Ov(){var e=this.__wrapped__;if(e instanceof ge){var i=e;return this.__actions__.length&&(i=new ge(this)),i=i.reverse(),i.__actions__.push({func:uo,args:[ac],thisArg:r}),new kt(i,this.__chain__)}return this.thru(ac)}function $v(){return vh(this.__wrapped__,this.__actions__)}var Cv=to(function(e,i,a){Ee.call(e,a)?++e[a]:Fr(e,a,1)});function Rv(e,i,a){var u=ne(e)?$u:Eg;return a&&ft(e,i,a)&&(i=r),u(e,J(i,3))}function Tv(e,i){var a=ne(e)?kr:eh;return a(e,J(i,3))}var Nv=Ah(Jh),Dv=Ah(Qh);function qv(e,i){return tt(ho(e,i),1)}function zv(e,i){return tt(ho(e,i),V)}function jv(e,i,a){return a=a===r?1:se(a),tt(ho(e,i),a)}function rl(e,i){var a=ne(e)?Mt:Wr;return a(e,J(i,3))}function il(e,i){var a=ne(e)?id:Xu;return a(e,J(i,3))}var Bv=to(function(e,i,a){Ee.call(e,a)?e[a].push(i):Fr(e,a,[i])});function Lv(e,i,a,u){e=yt(e)?e:sn(e),a=a&&!u?se(a):0;var l=e.length;return a<0&&(a=Ge(l+a,0)),yo(e)?a<=l&&e.indexOf(i,a)>-1:!!l&&Ki(e,i,a)>-1}var Uv=he(function(e,i,a){var u=-1,l=typeof i=="function",y=yt(e)?A(e.length):[];return Wr(e,function(w){y[++u]=l?Je(i,w,a):Dn(w,i,a)}),y}),Mv=to(function(e,i,a){Fr(e,a,i)});function ho(e,i){var a=ne(e)?Te:oh;return a(e,J(i,3))}function Hv(e,i,a,u){return e==null?[]:(ne(i)||(i=i==null?[]:[i]),a=u?r:a,ne(a)||(a=a==null?[]:[a]),hh(e,i,a))}var kv=to(function(e,i,a){e[a?0:1].push(i)},function(){return[[],[]]});function Vv(e,i,a){var u=ne(e)?ba:Nu,l=arguments.length<3;return u(e,J(i,4),a,l,Wr)}function Kv(e,i,a){var u=ne(e)?nd:Nu,l=arguments.length<3;return u(e,J(i,4),a,l,Xu)}function Gv(e,i){var a=ne(e)?kr:eh;return a(e,po(J(i,3)))}function Wv(e){var i=ne(e)?Ju:Lg;return i(e)}function Jv(e,i,a){(a?ft(e,i,a):i===r)?i=1:i=se(i);var u=ne(e)?vg:Ug;return u(e,i)}function Qv(e){var i=ne(e)?mg:Hg;return i(e)}function Yv(e){if(e==null)return 0;if(yt(e))return yo(e)?Wi(e):e.length;var i=ot(e);return i==Xe||i==et?e.size:Ba(e).length}function Zv(e,i,a){var u=ne(e)?_a:kg;return a&&ft(e,i,a)&&(i=r),u(e,J(i,3))}var Xv=he(function(e,i){if(e==null)return[];var a=i.length;return a>1&&ft(e,i[0],i[1])?i=[]:a>2&&ft(i[0],i[1],i[2])&&(i=[i[0]]),hh(e,tt(i,1),[])}),lo=Td||function(){return ye.Date.now()};function em(e,i){if(typeof i!="function")throw new Ht(h);return e=se(e),function(){if(--e<1)return i.apply(this,arguments)}}function nl(e,i,a){return i=a?r:i,i=e&&i==null?e.length:i,Ar(e,re,r,r,r,r,i)}function sl(e,i){var a;if(typeof i!="function")throw new Ht(h);return e=se(e),function(){return--e>0&&(a=i.apply(this,arguments)),e<=1&&(i=r),a}}var uc=he(function(e,i,a){var u=H;if(a.length){var l=Kr(a,rn(uc));u|=W}return Ar(e,u,i,a,l)}),ol=he(function(e,i,a){var u=H|M;if(a.length){var l=Kr(a,rn(ol));u|=W}return Ar(i,u,e,a,l)});function al(e,i,a){i=a?r:i;var u=Ar(e,T,r,r,r,r,r,i);return u.placeholder=al.placeholder,u}function cl(e,i,a){i=a?r:i;var u=Ar(e,j,r,r,r,r,r,i);return u.placeholder=cl.placeholder,u}function ul(e,i,a){var u,l,y,w,_,x,$=0,C=!1,N=!1,z=!0;if(typeof e!="function")throw new Ht(h);i=Wt(i)||0,De(a)&&(C=!!a.leading,N="maxWait"in a,y=N?Ge(Wt(a.maxWait)||0,i):y,z="trailing"in a?!!a.trailing:z);function k(Ue){var rr=u,Tr=l;return u=l=r,$=Ue,w=e.apply(Tr,rr),w}function Z(Ue){return $=Ue,_=Ln(pe,i),C?k(Ue):w}function ce(Ue){var rr=Ue-x,Tr=Ue-$,Al=i-rr;return N?st(Al,y-Tr):Al}function X(Ue){var rr=Ue-x,Tr=Ue-$;return x===r||rr>=i||rr<0||N&&Tr>=y}function pe(){var Ue=lo();if(X(Ue))return ve(Ue);_=Ln(pe,ce(Ue))}function ve(Ue){return _=r,z&&u?k(Ue):(u=l=r,w)}function Nt(){_!==r&&wh(_),$=0,u=x=l=_=r}function pt(){return _===r?w:ve(lo())}function Dt(){var Ue=lo(),rr=X(Ue);if(u=arguments,l=this,x=Ue,rr){if(_===r)return Z(x);if(N)return wh(_),_=Ln(pe,i),k(x)}return _===r&&(_=Ln(pe,i)),w}return Dt.cancel=Nt,Dt.flush=pt,Dt}var tm=he(function(e,i){return Zu(e,1,i)}),rm=he(function(e,i,a){return Zu(e,Wt(i)||0,a)});function im(e){return Ar(e,we)}function fo(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new Ht(h);var a=function(){var u=arguments,l=i?i.apply(this,u):u[0],y=a.cache;if(y.has(l))return y.get(l);var w=e.apply(this,u);return a.cache=y.set(l,w)||y,w};return a.cache=new(fo.Cache||Sr),a}fo.Cache=Sr;function po(e){if(typeof e!="function")throw new Ht(h);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function nm(e){return sl(2,e)}var sm=Vg(function(e,i){i=i.length==1&&ne(i[0])?Te(i[0],Ct(J())):Te(tt(i,1),Ct(J()));var a=i.length;return he(function(u){for(var l=-1,y=st(u.length,a);++l<y;)u[l]=i[l].call(this,u[l]);return Je(e,this,u)})}),hc=he(function(e,i){var a=Kr(i,rn(hc));return Ar(e,W,r,i,a)}),hl=he(function(e,i){var a=Kr(i,rn(hl));return Ar(e,le,r,i,a)}),om=Or(function(e,i){return Ar(e,oe,r,r,r,i)});function am(e,i){if(typeof e!="function")throw new Ht(h);return i=i===r?i:se(i),he(e,i)}function cm(e,i){if(typeof e!="function")throw new Ht(h);return i=i==null?0:Ge(se(i),0),he(function(a){var u=a[i],l=Yr(a,0,i);return u&&Vr(l,u),Je(e,this,l)})}function um(e,i,a){var u=!0,l=!0;if(typeof e!="function")throw new Ht(h);return De(a)&&(u="leading"in a?!!a.leading:u,l="trailing"in a?!!a.trailing:l),ul(e,i,{leading:u,maxWait:i,trailing:l})}function hm(e){return nl(e,1)}function lm(e,i){return hc(Wa(i),e)}function fm(){if(!arguments.length)return[];var e=arguments[0];return ne(e)?e:[e]}function pm(e){return Vt(e,F)}function dm(e,i){return i=typeof i=="function"?i:r,Vt(e,F,i)}function gm(e){return Vt(e,b|F)}function ym(e,i){return i=typeof i=="function"?i:r,Vt(e,b|F,i)}function vm(e,i){return i==null||Yu(e,i,Qe(i))}function tr(e,i){return e===i||e!==e&&i!==i}var mm=so(qa),wm=so(function(e,i){return e>=i}),Ei=ih(function(){return arguments}())?ih:function(e){return ze(e)&&Ee.call(e,"callee")&&!Hu.call(e,"callee")},ne=A.isArray,bm=ht?Ct(ht):Ag;function yt(e){return e!=null&&go(e.length)&&!Cr(e)}function Le(e){return ze(e)&&yt(e)}function _m(e){return e===!0||e===!1||ze(e)&&lt(e)==$e}var Zr=Dd||_c,Em=Zt?Ct(Zt):Og;function Im(e){return ze(e)&&e.nodeType===1&&!Un(e)}function Pm(e){if(e==null)return!0;if(yt(e)&&(ne(e)||typeof e=="string"||typeof e.splice=="function"||Zr(e)||nn(e)||Ei(e)))return!e.length;var i=ot(e);if(i==Xe||i==et)return!e.size;if(Bn(e))return!Ba(e).length;for(var a in e)if(Ee.call(e,a))return!1;return!0}function xm(e,i){return qn(e,i)}function Sm(e,i,a){a=typeof a=="function"?a:r;var u=a?a(e,i):r;return u===r?qn(e,i,r,a):!!u}function lc(e){if(!ze(e))return!1;var i=lt(e);return i==ut||i==Ft||typeof e.message=="string"&&typeof e.name=="string"&&!Un(e)}function Fm(e){return typeof e=="number"&&Vu(e)}function Cr(e){if(!De(e))return!1;var i=lt(e);return i==At||i==Lr||i==St||i==$i}function ll(e){return typeof e=="number"&&e==se(e)}function go(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=K}function De(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function ze(e){return e!=null&&typeof e=="object"}var fl=Ut?Ct(Ut):Cg;function Am(e,i){return e===i||ja(e,i,tc(i))}function Om(e,i,a){return a=typeof a=="function"?a:r,ja(e,i,tc(i),a)}function $m(e){return pl(e)&&e!=+e}function Cm(e){if(dy(e))throw new te(c);return nh(e)}function Rm(e){return e===null}function Tm(e){return e==null}function pl(e){return typeof e=="number"||ze(e)&&lt(e)==wr}function Un(e){if(!ze(e)||lt(e)!=Ot)return!1;var i=Us(e);if(i===null)return!0;var a=Ee.call(i,"constructor")&&i.constructor;return typeof a=="function"&&a instanceof a&&zs.call(a)==Od}var fc=lr?Ct(lr):Rg;function Nm(e){return ll(e)&&e>=-K&&e<=K}var dl=Sn?Ct(Sn):Tg;function yo(e){return typeof e=="string"||!ne(e)&&ze(e)&&lt(e)==cr}function Tt(e){return typeof e=="symbol"||ze(e)&&lt(e)==br}var nn=di?Ct(di):Ng;function Dm(e){return e===r}function qm(e){return ze(e)&&ot(e)==ur}function zm(e){return ze(e)&&lt(e)==Ri}var jm=so(La),Bm=so(function(e,i){return e<=i});function gl(e){if(!e)return[];if(yt(e))return yo(e)?Xt(e):gt(e);if(An&&e[An])return vd(e[An]());var i=ot(e),a=i==Xe?Fa:i==et?Ns:sn;return a(e)}function Rr(e){if(!e)return e===0?e:0;if(e=Wt(e),e===V||e===-V){var i=e<0?-1:1;return i*de}return e===e?e:0}function se(e){var i=Rr(e),a=i%1;return i===i?a?i-a:i:0}function yl(e){return e?mi(se(e),0,ae):0}function Wt(e){if(typeof e=="number")return e;if(Tt(e))return fe;if(De(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=De(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=Du(e);var a=ra.test(e);return a||na.test(e)?ie(e.slice(2),a?2:8):ta.test(e)?fe:+e}function vl(e){return pr(e,vt(e))}function Lm(e){return e?mi(se(e),-K,K):e===0?e:0}function _e(e){return e==null?"":Rt(e)}var Um=en(function(e,i){if(Bn(i)||yt(i)){pr(i,Qe(i),e);return}for(var a in i)Ee.call(i,a)&&Tn(e,a,i[a])}),ml=en(function(e,i){pr(i,vt(i),e)}),vo=en(function(e,i,a,u){pr(i,vt(i),e,u)}),Mm=en(function(e,i,a,u){pr(i,Qe(i),e,u)}),Hm=Or(Ta);function km(e,i){var a=Xi(e);return i==null?a:Qu(a,i)}var Vm=he(function(e,i){e=Fe(e);var a=-1,u=i.length,l=u>2?i[2]:r;for(l&&ft(i[0],i[1],l)&&(u=1);++a<u;)for(var y=i[a],w=vt(y),_=-1,x=w.length;++_<x;){var $=w[_],C=e[$];(C===r||tr(C,Qi[$])&&!Ee.call(e,$))&&(e[$]=y[$])}return e}),Km=he(function(e){return e.push(r,Dh),Je(wl,r,e)});function Gm(e,i){return Cu(e,J(i,3),fr)}function Wm(e,i){return Cu(e,J(i,3),Da)}function Jm(e,i){return e==null?e:Na(e,J(i,3),vt)}function Qm(e,i){return e==null?e:th(e,J(i,3),vt)}function Ym(e,i){return e&&fr(e,J(i,3))}function Zm(e,i){return e&&Da(e,J(i,3))}function Xm(e){return e==null?[]:Ys(e,Qe(e))}function e1(e){return e==null?[]:Ys(e,vt(e))}function pc(e,i,a){var u=e==null?r:wi(e,i);return u===r?a:u}function t1(e,i){return e!=null&&jh(e,i,Pg)}function dc(e,i){return e!=null&&jh(e,i,xg)}var r1=$h(function(e,i,a){i!=null&&typeof i.toString!="function"&&(i=js.call(i)),e[i]=a},yc(mt)),i1=$h(function(e,i,a){i!=null&&typeof i.toString!="function"&&(i=js.call(i)),Ee.call(e,i)?e[i].push(a):e[i]=[a]},J),n1=he(Dn);function Qe(e){return yt(e)?Wu(e):Ba(e)}function vt(e){return yt(e)?Wu(e,!0):Dg(e)}function s1(e,i){var a={};return i=J(i,3),fr(e,function(u,l,y){Fr(a,i(u,l,y),u)}),a}function o1(e,i){var a={};return i=J(i,3),fr(e,function(u,l,y){Fr(a,l,i(u,l,y))}),a}var a1=en(function(e,i,a){Zs(e,i,a)}),wl=en(function(e,i,a,u){Zs(e,i,a,u)}),c1=Or(function(e,i){var a={};if(e==null)return a;var u=!1;i=Te(i,function(y){return y=Qr(y,e),u||(u=y.length>1),y}),pr(e,Xa(e),a),u&&(a=Vt(a,b|E|F,ry));for(var l=i.length;l--;)Va(a,i[l]);return a});function u1(e,i){return bl(e,po(J(i)))}var h1=Or(function(e,i){return e==null?{}:zg(e,i)});function bl(e,i){if(e==null)return{};var a=Te(Xa(e),function(u){return[u]});return i=J(i),lh(e,a,function(u,l){return i(u,l[0])})}function l1(e,i,a){i=Qr(i,e);var u=-1,l=i.length;for(l||(l=1,e=r);++u<l;){var y=e==null?r:e[dr(i[u])];y===r&&(u=l,y=a),e=Cr(y)?y.call(e):y}return e}function f1(e,i,a){return e==null?e:zn(e,i,a)}function p1(e,i,a,u){return u=typeof u=="function"?u:r,e==null?e:zn(e,i,a,u)}var _l=Th(Qe),El=Th(vt);function d1(e,i,a){var u=ne(e),l=u||Zr(e)||nn(e);if(i=J(i,4),a==null){var y=e&&e.constructor;l?a=u?new y:[]:De(e)?a=Cr(y)?Xi(Us(e)):{}:a={}}return(l?Mt:fr)(e,function(w,_,x){return i(a,w,_,x)}),a}function g1(e,i){return e==null?!0:Va(e,i)}function y1(e,i,a){return e==null?e:yh(e,i,Wa(a))}function v1(e,i,a,u){return u=typeof u=="function"?u:r,e==null?e:yh(e,i,Wa(a),u)}function sn(e){return e==null?[]:Sa(e,Qe(e))}function m1(e){return e==null?[]:Sa(e,vt(e))}function w1(e,i,a){return a===r&&(a=i,i=r),a!==r&&(a=Wt(a),a=a===a?a:0),i!==r&&(i=Wt(i),i=i===i?i:0),mi(Wt(e),i,a)}function b1(e,i,a){return i=Rr(i),a===r?(a=i,i=0):a=Rr(a),e=Wt(e),Sg(e,i,a)}function _1(e,i,a){if(a&&typeof a!="boolean"&&ft(e,i,a)&&(i=a=r),a===r&&(typeof i=="boolean"?(a=i,i=r):typeof e=="boolean"&&(a=e,e=r)),e===r&&i===r?(e=0,i=1):(e=Rr(e),i===r?(i=e,e=0):i=Rr(i)),e>i){var u=e;e=i,i=u}if(a||e%1||i%1){var l=Ku();return st(e+l*(i-e+xe("1e-"+((l+"").length-1))),i)}return Ma(e,i)}var E1=tn(function(e,i,a){return i=i.toLowerCase(),e+(a?Il(i):i)});function Il(e){return gc(_e(e).toLowerCase())}function Pl(e){return e=_e(e),e&&e.replace(Ir,fd).replace(va,"")}function I1(e,i,a){e=_e(e),i=Rt(i);var u=e.length;a=a===r?u:mi(se(a),0,u);var l=a;return a-=i.length,a>=0&&e.slice(a,l)==i}function P1(e){return e=_e(e),e&&ci.test(e)?e.replace(ls,pd):e}function x1(e){return e=_e(e),e&&Jo.test(e)?e.replace(bn,"\\$&"):e}var S1=tn(function(e,i,a){return e+(a?"-":"")+i.toLowerCase()}),F1=tn(function(e,i,a){return e+(a?" ":"")+i.toLowerCase()}),A1=Fh("toLowerCase");function O1(e,i,a){e=_e(e),i=se(i);var u=i?Wi(e):0;if(!i||u>=i)return e;var l=(i-u)/2;return no(Vs(l),a)+e+no(ks(l),a)}function $1(e,i,a){e=_e(e),i=se(i);var u=i?Wi(e):0;return i&&u<i?e+no(i-u,a):e}function C1(e,i,a){e=_e(e),i=se(i);var u=i?Wi(e):0;return i&&u<i?no(i-u,a)+e:e}function R1(e,i,a){return a||i==null?i=0:i&&(i=+i),Bd(_e(e).replace(_n,""),i||0)}function T1(e,i,a){return(a?ft(e,i,a):i===r)?i=1:i=se(i),Ha(_e(e),i)}function N1(){var e=arguments,i=_e(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var D1=tn(function(e,i,a){return e+(a?"_":"")+i.toLowerCase()});function q1(e,i,a){return a&&typeof a!="number"&&ft(e,i,a)&&(i=a=r),a=a===r?ae:a>>>0,a?(e=_e(e),e&&(typeof i=="string"||i!=null&&!fc(i))&&(i=Rt(i),!i&&Gi(e))?Yr(Xt(e),0,a):e.split(i,a)):[]}var z1=tn(function(e,i,a){return e+(a?" ":"")+gc(i)});function j1(e,i,a){return e=_e(e),a=a==null?0:mi(se(a),0,e.length),i=Rt(i),e.slice(a,a+i.length)==i}function B1(e,i,a){var u=d.templateSettings;a&&ft(e,i,a)&&(i=r),e=_e(e),i=vo({},i,u,Nh);var l=vo({},i.imports,u.imports,Nh),y=Qe(l),w=Sa(l,y),_,x,$=0,C=i.interpolate||Bi,N="__p += '",z=Aa((i.escape||Bi).source+"|"+C.source+"|"+(C===ji?ea:Bi).source+"|"+(i.evaluate||Bi).source+"|$","g"),k="//# sourceURL="+(Ee.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ma+"]")+`
`;e.replace(z,function(X,pe,ve,Nt,pt,Dt){return ve||(ve=Nt),N+=e.slice($,Dt).replace(oa,dd),pe&&(_=!0,N+=`' +
__e(`+pe+`) +
'`),pt&&(x=!0,N+=`';
`+pt+`;
__p += '`),ve&&(N+=`' +
((__t = (`+ve+`)) == null ? '' : __t) +
'`),$=Dt+X.length,X}),N+=`';
`;var Z=Ee.call(i,"variable")&&i.variable;if(!Z)N=`with (obj) {
`+N+`
}
`;else if(Zo.test(Z))throw new te(p);N=(x?N.replace(Ko,""):N).replace(_r,"$1").replace(us,"$1;"),N="function("+(Z||"obj")+`) {
`+(Z?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(_?", __e = _.escape":"")+(x?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+N+`return __p
}`;var ce=Sl(function(){return me(y,k+"return "+N).apply(r,w)});if(ce.source=N,lc(ce))throw ce;return ce}function L1(e){return _e(e).toLowerCase()}function U1(e){return _e(e).toUpperCase()}function M1(e,i,a){if(e=_e(e),e&&(a||i===r))return Du(e);if(!e||!(i=Rt(i)))return e;var u=Xt(e),l=Xt(i),y=qu(u,l),w=zu(u,l)+1;return Yr(u,y,w).join("")}function H1(e,i,a){if(e=_e(e),e&&(a||i===r))return e.slice(0,Bu(e)+1);if(!e||!(i=Rt(i)))return e;var u=Xt(e),l=zu(u,Xt(i))+1;return Yr(u,0,l).join("")}function k1(e,i,a){if(e=_e(e),e&&(a||i===r))return e.replace(_n,"");if(!e||!(i=Rt(i)))return e;var u=Xt(e),l=qu(u,Xt(i));return Yr(u,l).join("")}function V1(e,i){var a=qt,u=zt;if(De(i)){var l="separator"in i?i.separator:l;a="length"in i?se(i.length):a,u="omission"in i?Rt(i.omission):u}e=_e(e);var y=e.length;if(Gi(e)){var w=Xt(e);y=w.length}if(a>=y)return e;var _=a-Wi(u);if(_<1)return u;var x=w?Yr(w,0,_).join(""):e.slice(0,_);if(l===r)return x+u;if(w&&(_+=x.length-_),fc(l)){if(e.slice(_).search(l)){var $,C=x;for(l.global||(l=Aa(l.source,_e(Lt.exec(l))+"g")),l.lastIndex=0;$=l.exec(C);)var N=$.index;x=x.slice(0,N===r?_:N)}}else if(e.indexOf(Rt(l),_)!=_){var z=x.lastIndexOf(l);z>-1&&(x=x.slice(0,z))}return x+u}function K1(e){return e=_e(e),e&&vn.test(e)?e.replace(hs,_d):e}var G1=tn(function(e,i,a){return e+(a?" ":"")+i.toUpperCase()}),gc=Fh("toUpperCase");function xl(e,i,a){return e=_e(e),i=a?r:i,i===r?yd(e)?Pd(e):ad(e):e.match(i)||[]}var Sl=he(function(e,i){try{return Je(e,r,i)}catch(a){return lc(a)?a:new te(a)}}),W1=Or(function(e,i){return Mt(i,function(a){a=dr(a),Fr(e,a,uc(e[a],e))}),e});function J1(e){var i=e==null?0:e.length,a=J();return e=i?Te(e,function(u){if(typeof u[1]!="function")throw new Ht(h);return[a(u[0]),u[1]]}):[],he(function(u){for(var l=-1;++l<i;){var y=e[l];if(Je(y[0],this,u))return Je(y[1],this,u)}})}function Q1(e){return _g(Vt(e,b))}function yc(e){return function(){return e}}function Y1(e,i){return e==null||e!==e?i:e}var Z1=Oh(),X1=Oh(!0);function mt(e){return e}function vc(e){return sh(typeof e=="function"?e:Vt(e,b))}function e0(e){return ah(Vt(e,b))}function t0(e,i){return ch(e,Vt(i,b))}var r0=he(function(e,i){return function(a){return Dn(a,e,i)}}),i0=he(function(e,i){return function(a){return Dn(e,a,i)}});function mc(e,i,a){var u=Qe(i),l=Ys(i,u);a==null&&!(De(i)&&(l.length||!u.length))&&(a=i,i=e,e=this,l=Ys(i,Qe(i)));var y=!(De(a)&&"chain"in a)||!!a.chain,w=Cr(e);return Mt(l,function(_){var x=i[_];e[_]=x,w&&(e.prototype[_]=function(){var $=this.__chain__;if(y||$){var C=e(this.__wrapped__),N=C.__actions__=gt(this.__actions__);return N.push({func:x,args:arguments,thisArg:e}),C.__chain__=$,C}return x.apply(e,Vr([this.value()],arguments))})}),e}function n0(){return ye._===this&&(ye._=$d),this}function wc(){}function s0(e){return e=se(e),he(function(i){return uh(i,e)})}var o0=Qa(Te),a0=Qa($u),c0=Qa(_a);function Fl(e){return ic(e)?Ea(dr(e)):jg(e)}function u0(e){return function(i){return e==null?r:wi(e,i)}}var h0=Ch(),l0=Ch(!0);function bc(){return[]}function _c(){return!1}function f0(){return{}}function p0(){return""}function d0(){return!0}function g0(e,i){if(e=se(e),e<1||e>K)return[];var a=ae,u=st(e,ae);i=J(i),e-=ae;for(var l=xa(u,i);++a<e;)i(a);return l}function y0(e){return ne(e)?Te(e,dr):Tt(e)?[e]:gt(Gh(_e(e)))}function v0(e){var i=++Ad;return _e(e)+i}var m0=io(function(e,i){return e+i},0),w0=Ya("ceil"),b0=io(function(e,i){return e/i},1),_0=Ya("floor");function E0(e){return e&&e.length?Qs(e,mt,qa):r}function I0(e,i){return e&&e.length?Qs(e,J(i,2),qa):r}function P0(e){return Tu(e,mt)}function x0(e,i){return Tu(e,J(i,2))}function S0(e){return e&&e.length?Qs(e,mt,La):r}function F0(e,i){return e&&e.length?Qs(e,J(i,2),La):r}var A0=io(function(e,i){return e*i},1),O0=Ya("round"),$0=io(function(e,i){return e-i},0);function C0(e){return e&&e.length?Pa(e,mt):0}function R0(e,i){return e&&e.length?Pa(e,J(i,2)):0}return d.after=em,d.ary=nl,d.assign=Um,d.assignIn=ml,d.assignInWith=vo,d.assignWith=Mm,d.at=Hm,d.before=sl,d.bind=uc,d.bindAll=W1,d.bindKey=ol,d.castArray=fm,d.chain=tl,d.chunk=_y,d.compact=Ey,d.concat=Iy,d.cond=J1,d.conforms=Q1,d.constant=yc,d.countBy=Cv,d.create=km,d.curry=al,d.curryRight=cl,d.debounce=ul,d.defaults=Vm,d.defaultsDeep=Km,d.defer=tm,d.delay=rm,d.difference=Py,d.differenceBy=xy,d.differenceWith=Sy,d.drop=Fy,d.dropRight=Ay,d.dropRightWhile=Oy,d.dropWhile=$y,d.fill=Cy,d.filter=Tv,d.flatMap=qv,d.flatMapDeep=zv,d.flatMapDepth=jv,d.flatten=Yh,d.flattenDeep=Ry,d.flattenDepth=Ty,d.flip=im,d.flow=Z1,d.flowRight=X1,d.fromPairs=Ny,d.functions=Xm,d.functionsIn=e1,d.groupBy=Bv,d.initial=qy,d.intersection=zy,d.intersectionBy=jy,d.intersectionWith=By,d.invert=r1,d.invertBy=i1,d.invokeMap=Uv,d.iteratee=vc,d.keyBy=Mv,d.keys=Qe,d.keysIn=vt,d.map=ho,d.mapKeys=s1,d.mapValues=o1,d.matches=e0,d.matchesProperty=t0,d.memoize=fo,d.merge=a1,d.mergeWith=wl,d.method=r0,d.methodOf=i0,d.mixin=mc,d.negate=po,d.nthArg=s0,d.omit=c1,d.omitBy=u1,d.once=nm,d.orderBy=Hv,d.over=o0,d.overArgs=sm,d.overEvery=a0,d.overSome=c0,d.partial=hc,d.partialRight=hl,d.partition=kv,d.pick=h1,d.pickBy=bl,d.property=Fl,d.propertyOf=u0,d.pull=Hy,d.pullAll=Xh,d.pullAllBy=ky,d.pullAllWith=Vy,d.pullAt=Ky,d.range=h0,d.rangeRight=l0,d.rearg=om,d.reject=Gv,d.remove=Gy,d.rest=am,d.reverse=ac,d.sampleSize=Jv,d.set=f1,d.setWith=p1,d.shuffle=Qv,d.slice=Wy,d.sortBy=Xv,d.sortedUniq=tv,d.sortedUniqBy=rv,d.split=q1,d.spread=cm,d.tail=iv,d.take=nv,d.takeRight=sv,d.takeRightWhile=ov,d.takeWhile=av,d.tap=Ev,d.throttle=um,d.thru=uo,d.toArray=gl,d.toPairs=_l,d.toPairsIn=El,d.toPath=y0,d.toPlainObject=vl,d.transform=d1,d.unary=hm,d.union=cv,d.unionBy=uv,d.unionWith=hv,d.uniq=lv,d.uniqBy=fv,d.uniqWith=pv,d.unset=g1,d.unzip=cc,d.unzipWith=el,d.update=y1,d.updateWith=v1,d.values=sn,d.valuesIn=m1,d.without=dv,d.words=xl,d.wrap=lm,d.xor=gv,d.xorBy=yv,d.xorWith=vv,d.zip=mv,d.zipObject=wv,d.zipObjectDeep=bv,d.zipWith=_v,d.entries=_l,d.entriesIn=El,d.extend=ml,d.extendWith=vo,mc(d,d),d.add=m0,d.attempt=Sl,d.camelCase=E1,d.capitalize=Il,d.ceil=w0,d.clamp=w1,d.clone=pm,d.cloneDeep=gm,d.cloneDeepWith=ym,d.cloneWith=dm,d.conformsTo=vm,d.deburr=Pl,d.defaultTo=Y1,d.divide=b0,d.endsWith=I1,d.eq=tr,d.escape=P1,d.escapeRegExp=x1,d.every=Rv,d.find=Nv,d.findIndex=Jh,d.findKey=Gm,d.findLast=Dv,d.findLastIndex=Qh,d.findLastKey=Wm,d.floor=_0,d.forEach=rl,d.forEachRight=il,d.forIn=Jm,d.forInRight=Qm,d.forOwn=Ym,d.forOwnRight=Zm,d.get=pc,d.gt=mm,d.gte=wm,d.has=t1,d.hasIn=dc,d.head=Zh,d.identity=mt,d.includes=Lv,d.indexOf=Dy,d.inRange=b1,d.invoke=n1,d.isArguments=Ei,d.isArray=ne,d.isArrayBuffer=bm,d.isArrayLike=yt,d.isArrayLikeObject=Le,d.isBoolean=_m,d.isBuffer=Zr,d.isDate=Em,d.isElement=Im,d.isEmpty=Pm,d.isEqual=xm,d.isEqualWith=Sm,d.isError=lc,d.isFinite=Fm,d.isFunction=Cr,d.isInteger=ll,d.isLength=go,d.isMap=fl,d.isMatch=Am,d.isMatchWith=Om,d.isNaN=$m,d.isNative=Cm,d.isNil=Tm,d.isNull=Rm,d.isNumber=pl,d.isObject=De,d.isObjectLike=ze,d.isPlainObject=Un,d.isRegExp=fc,d.isSafeInteger=Nm,d.isSet=dl,d.isString=yo,d.isSymbol=Tt,d.isTypedArray=nn,d.isUndefined=Dm,d.isWeakMap=qm,d.isWeakSet=zm,d.join=Ly,d.kebabCase=S1,d.last=Gt,d.lastIndexOf=Uy,d.lowerCase=F1,d.lowerFirst=A1,d.lt=jm,d.lte=Bm,d.max=E0,d.maxBy=I0,d.mean=P0,d.meanBy=x0,d.min=S0,d.minBy=F0,d.stubArray=bc,d.stubFalse=_c,d.stubObject=f0,d.stubString=p0,d.stubTrue=d0,d.multiply=A0,d.nth=My,d.noConflict=n0,d.noop=wc,d.now=lo,d.pad=O1,d.padEnd=$1,d.padStart=C1,d.parseInt=R1,d.random=_1,d.reduce=Vv,d.reduceRight=Kv,d.repeat=T1,d.replace=N1,d.result=l1,d.round=O0,d.runInContext=P,d.sample=Wv,d.size=Yv,d.snakeCase=D1,d.some=Zv,d.sortedIndex=Jy,d.sortedIndexBy=Qy,d.sortedIndexOf=Yy,d.sortedLastIndex=Zy,d.sortedLastIndexBy=Xy,d.sortedLastIndexOf=ev,d.startCase=z1,d.startsWith=j1,d.subtract=$0,d.sum=C0,d.sumBy=R0,d.template=B1,d.times=g0,d.toFinite=Rr,d.toInteger=se,d.toLength=yl,d.toLower=L1,d.toNumber=Wt,d.toSafeInteger=Lm,d.toString=_e,d.toUpper=U1,d.trim=M1,d.trimEnd=H1,d.trimStart=k1,d.truncate=V1,d.unescape=K1,d.uniqueId=v0,d.upperCase=G1,d.upperFirst=gc,d.each=rl,d.eachRight=il,d.first=Zh,mc(d,function(){var e={};return fr(d,function(i,a){Ee.call(d.prototype,a)||(e[a]=i)}),e}(),{chain:!1}),d.VERSION=n,Mt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){d[e].placeholder=d}),Mt(["drop","take"],function(e,i){ge.prototype[e]=function(a){a=a===r?1:Ge(se(a),0);var u=this.__filtered__&&!i?new ge(this):this.clone();return u.__filtered__?u.__takeCount__=st(a,u.__takeCount__):u.__views__.push({size:st(a,ae),type:e+(u.__dir__<0?"Right":"")}),u},ge.prototype[e+"Right"]=function(a){return this.reverse()[e](a).reverse()}}),Mt(["filter","map","takeWhile"],function(e,i){var a=i+1,u=a==Br||a==q;ge.prototype[e]=function(l){var y=this.clone();return y.__iteratees__.push({iteratee:J(l,3),type:a}),y.__filtered__=y.__filtered__||u,y}}),Mt(["head","last"],function(e,i){var a="take"+(i?"Right":"");ge.prototype[e]=function(){return this[a](1).value()[0]}}),Mt(["initial","tail"],function(e,i){var a="drop"+(i?"":"Right");ge.prototype[e]=function(){return this.__filtered__?new ge(this):this[a](1)}}),ge.prototype.compact=function(){return this.filter(mt)},ge.prototype.find=function(e){return this.filter(e).head()},ge.prototype.findLast=function(e){return this.reverse().find(e)},ge.prototype.invokeMap=he(function(e,i){return typeof e=="function"?new ge(this):this.map(function(a){return Dn(a,e,i)})}),ge.prototype.reject=function(e){return this.filter(po(J(e)))},ge.prototype.slice=function(e,i){e=se(e);var a=this;return a.__filtered__&&(e>0||i<0)?new ge(a):(e<0?a=a.takeRight(-e):e&&(a=a.drop(e)),i!==r&&(i=se(i),a=i<0?a.dropRight(-i):a.take(i-e)),a)},ge.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},ge.prototype.toArray=function(){return this.take(ae)},fr(ge.prototype,function(e,i){var a=/^(?:filter|find|map|reject)|While$/.test(i),u=/^(?:head|last)$/.test(i),l=d[u?"take"+(i=="last"?"Right":""):i],y=u||/^find/.test(i);l&&(d.prototype[i]=function(){var w=this.__wrapped__,_=u?[1]:arguments,x=w instanceof ge,$=_[0],C=x||ne(w),N=function(pe){var ve=l.apply(d,Vr([pe],_));return u&&z?ve[0]:ve};C&&a&&typeof $=="function"&&$.length!=1&&(x=C=!1);var z=this.__chain__,k=!!this.__actions__.length,Z=y&&!z,ce=x&&!k;if(!y&&C){w=ce?w:new ge(this);var X=e.apply(w,_);return X.__actions__.push({func:uo,args:[N],thisArg:r}),new kt(X,z)}return Z&&ce?e.apply(this,_):(X=this.thru(N),Z?u?X.value()[0]:X.value():X)})}),Mt(["pop","push","shift","sort","splice","unshift"],function(e){var i=Ds[e],a=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",u=/^(?:pop|shift)$/.test(e);d.prototype[e]=function(){var l=arguments;if(u&&!this.__chain__){var y=this.value();return i.apply(ne(y)?y:[],l)}return this[a](function(w){return i.apply(ne(w)?w:[],l)})}}),fr(ge.prototype,function(e,i){var a=d[i];if(a){var u=a.name+"";Ee.call(Zi,u)||(Zi[u]=[]),Zi[u].push({name:i,func:a})}}),Zi[ro(r,M).name]=[{name:"wrapper",func:r}],ge.prototype.clone=Kd,ge.prototype.reverse=Gd,ge.prototype.value=Wd,d.prototype.at=Iv,d.prototype.chain=Pv,d.prototype.commit=xv,d.prototype.next=Sv,d.prototype.plant=Av,d.prototype.reverse=Ov,d.prototype.toJSON=d.prototype.valueOf=d.prototype.value=$v,d.prototype.first=d.prototype.head,An&&(d.prototype[An]=Fv),d},Ji=xd();Be?((Be.exports=Ji)._=Ji,Se._=Ji):ye._=Ji}).call(Jn)})(au,au.exports);var uS=Object.defineProperty,hS=Object.defineProperties,lS=Object.getOwnPropertyDescriptors,Bf=Object.getOwnPropertySymbols,fS=Object.prototype.hasOwnProperty,pS=Object.prototype.propertyIsEnumerable,Lf=(s,t,r)=>t in s?uS(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Fo=(s,t)=>{for(var r in t||(t={}))fS.call(t,r)&&Lf(s,r,t[r]);if(Bf)for(var r of Bf(t))pS.call(t,r)&&Lf(s,r,t[r]);return s},dS=(s,t)=>hS(s,lS(t));function si(s,t,r){var n;const o=vw(s);return((n=t.rpcMap)==null?void 0:n[o.reference])||`${cS}?chainId=${o.namespace}:${o.reference}&projectId=${r}`}function Ai(s){return s.includes(":")?s.split(":")[1]:s}function ed(s){return s.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function gS(s,t){const r=Object.keys(t.namespaces).filter(o=>o.includes(s));if(!r.length)return[];const n=[];return r.forEach(o=>{const c=t.namespaces[o].accounts;n.push(...c)}),n}function yS(s={},t={}){const r=Uf(s),n=Uf(t);return au.exports.merge(r,n)}function Uf(s){var t,r,n,o;const c={};if(!$o(s))return c;for(const[h,p]of Object.entries(s)){const f=Zf(h)?[h]:p.chains,g=p.methods||[],v=p.events||[],b=p.rpcMap||{},E=Qn(h);c[E]=dS(Fo(Fo({},c[E]),p),{chains:Ic(f,(t=c[E])==null?void 0:t.chains),methods:Ic(g,(r=c[E])==null?void 0:r.methods),events:Ic(v,(n=c[E])==null?void 0:n.events),rpcMap:Fo(Fo({},b),(o=c[E])==null?void 0:o.rpcMap)})}return c}function vS(s){return s.includes(":")?s.split(":")[2]:s}function mS(s){const t={};for(const[r,n]of Object.entries(s)){const o=n.methods||[],c=n.events||[],h=n.accounts||[],p=Zf(r)?[r]:n.chains?n.chains:ed(n.accounts);t[r]={chains:p,methods:o,events:c,accounts:h}}return t}function Mc(s){return typeof s=="number"?s:s.includes("0x")?parseInt(s,16):s.includes(":")?Number(s.split(":")[1]):Number(s)}const td={},Ne=s=>td[s],Hc=(s,t)=>{td[s]=t};class wS{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=Ne("events"),this.client=Ne("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(jr.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Ai(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,Ne("disableProviderPing")))}}class bS{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=Ne("events"),this.client=Ne("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(parseInt(t),r),this.chainId=parseInt(t),this.events.emit(jr.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const n=r||si(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,Ne("disableProviderPing")))}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=parseInt(Ai(r));t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,n;let o=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const c=parseInt(o,16);if(this.isChainApproved(c))this.setDefaultChain(`${c}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:o}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${c}`);else throw new Error(`Failed to switch to chain 'eip155:${c}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class _S{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=Ne("events"),this.client=Ne("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(jr.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Ai(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,Ne("disableProviderPing")))}}class ES{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=Ne("events"),this.client=Ne("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(jr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Ai(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,Ne("disableProviderPing")))}}class IS{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=Ne("events"),this.client=Ne("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(jr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const n=this.getCardanoRPCUrl(r),o=Ai(r);t[o]=this.createHttpProvider(o,n)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||this.getCardanoRPCUrl(t);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,Ne("disableProviderPing")))}}class PS{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=Ne("events"),this.client=Ne("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(jr.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Ai(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,Ne("disableProviderPing")))}}class xS{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=Ne("events"),this.client=Ne("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(jr.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Ai(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,Ne("disableProviderPing")))}}class SS{constructor(t){this.name="near",this.namespace=t.namespace,this.events=Ne("events"),this.client=Ne("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const n=r||si(`${this.name}:${t}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,n)}this.events.emit(jr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;t[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace);return typeof n>"u"?void 0:new ai(new oi(n,Ne("disableProviderPing")))}}var FS=Object.defineProperty,AS=Object.defineProperties,OS=Object.getOwnPropertyDescriptors,Mf=Object.getOwnPropertySymbols,$S=Object.prototype.hasOwnProperty,CS=Object.prototype.propertyIsEnumerable,Hf=(s,t,r)=>t in s?FS(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Ao=(s,t)=>{for(var r in t||(t={}))$S.call(t,r)&&Hf(s,r,t[r]);if(Mf)for(var r of Mf(t))CS.call(t,r)&&Hf(s,r,t[r]);return s},kc=(s,t)=>AS(s,OS(t));class Au{constructor(t){this.events=new fu,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Uo(Mo({level:(t==null?void 0:t.logger)||zf})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new Au(t);return await r.initialize(),r}async request(t,r){const[n,o]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:Ao({},t),chainId:`${n}:${o}`,topic:this.session.topic})}sendAsync(t,r,n){const o=new Date().getTime();this.request(t,n).then(c=>r(null,jo(o,c))).catch(c=>r(c,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:at("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:o}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await o().then(c=>{this.session=c,this.namespaces||(this.namespaces=mS(c.namespaces),this.persist("namespaces",this.namespaces))}).catch(c=>{if(c.message!==Zp)throw c;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[n,o]=this.validateChain(t);this.getProvider(n).setDefaultChain(o,r)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(pn(r)){for(const n of r)t.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await nS.init({logger:this.providerOpts.logger||zf,relayUrl:this.providerOpts.relayUrl||sS,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>Qn(r)))];Hc("client",this.client),Hc("events",this.events),Hc("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const n=gS(r,this.session),o=ed(n),c=yS(this.namespaces,this.optionalNamespaces),h=kc(Ao({},c[r]),{accounts:n,chains:o});switch(r){case"eip155":this.rpcProviders[r]=new bS({namespace:h});break;case"solana":this.rpcProviders[r]=new _S({namespace:h});break;case"cosmos":this.rpcProviders[r]=new ES({namespace:h});break;case"polkadot":this.rpcProviders[r]=new wS({namespace:h});break;case"cip34":this.rpcProviders[r]=new IS({namespace:h});break;case"elrond":this.rpcProviders[r]=new PS({namespace:h});break;case"multiversx":this.rpcProviders[r]=new xS({namespace:h});break;case"near":this.rpcProviders[r]=new SS({namespace:h});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:n}=r;if(n.name==="accountsChanged"){const o=n.data;o&&pn(o)&&this.events.emit("accountsChanged",o.map(vS))}else if(n.name==="chainChanged"){const o=r.chainId,c=r.event.data,h=Qn(o),p=Mc(o)!==Mc(c)?`${h}:${Mc(c)}`:o;this.onChainChanged(p)}else this.events.emit(n.name,n.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var n;const{namespaces:o}=r,c=(n=this.client)==null?void 0:n.session.get(t);this.session=kc(Ao({},c),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",kc(Ao({},at("USER_DISCONNECTED")),{data:t.topic}))}),this.on(jr.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:n,sessionProperties:o}=t;r&&Object.keys(r).length&&(this.namespaces=r),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=o,this.persist("namespaces",r),this.persist("optionalNamespaces",n)}validateChain(t){const[r,n]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,n];if(r&&!Object.keys(this.namespaces||{}).map(h=>Qn(h)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&n)return[r,n];const o=Qn(Object.keys(this.namespaces)[0]),c=this.rpcProviders[o].getDefaultChain();return[o,c]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var n;if(!this.namespaces)return;const[o,c]=this.validateChain(t);r||this.getProvider(o).setDefaultChain(c),((n=this.namespaces[o])!=null?n:this.namespaces[`${o}:${c}`]).defaultChain=c,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",c)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${jf}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${jf}/${t}`)}}const RS=Au,TS="wc",NS="ethereum_provider",DS=`${TS}@2:${NS}:`,qS="https://rpc.walletconnect.com/v1/",cu=["eth_sendTransaction","personal_sign"],zS=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],uu=["chainChanged","accountsChanged"],jS=["chainChanged","accountsChanged","message","disconnect","connect"];var BS=Object.defineProperty,LS=Object.defineProperties,US=Object.getOwnPropertyDescriptors,kf=Object.getOwnPropertySymbols,MS=Object.prototype.hasOwnProperty,HS=Object.prototype.propertyIsEnumerable,Vf=(s,t,r)=>t in s?BS(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Zn=(s,t)=>{for(var r in t||(t={}))MS.call(t,r)&&Vf(s,r,t[r]);if(kf)for(var r of kf(t))HS.call(t,r)&&Vf(s,r,t[r]);return s},Kf=(s,t)=>LS(s,US(t));function qo(s){return Number(s[0].split(":")[1])}function Vc(s){return`0x${s.toString(16)}`}function kS(s){const{chains:t,optionalChains:r,methods:n,optionalMethods:o,events:c,optionalEvents:h,rpcMap:p}=s;if(!pn(t))throw new Error("Invalid chains");const f={chains:t,methods:n||cu,events:c||uu,rpcMap:Zn({},t.length?{[qo(t)]:p[qo(t)]}:{})},g=c==null?void 0:c.filter(F=>!uu.includes(F)),v=n==null?void 0:n.filter(F=>!cu.includes(F));if(!r&&!h&&!o&&!(g!=null&&g.length)&&!(v!=null&&v.length))return{required:t.length?f:void 0};const b=(g==null?void 0:g.length)&&(v==null?void 0:v.length)||!r,E={chains:[...new Set(b?f.chains.concat(r||[]):r)],methods:[...new Set(f.methods.concat(o!=null&&o.length?o:zS))],events:[...new Set(f.events.concat(h!=null&&h.length?h:jS))],rpcMap:p};return{required:t.length?f:void 0,optional:r.length?E:void 0}}class Ou{constructor(){this.events=new Qt.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=DS,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new Ou;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:n}=kS(this.rpc);try{const o=await new Promise(async(h,p)=>{var f;this.rpc.showQrModal&&((f=this.modal)==null||f.subscribeModal(g=>{!g.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),p(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Kf(Zn({namespaces:Zn({},r&&{[this.namespace]:r})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(g=>{h(g)}).catch(g=>{p(new Error(g.message))})});if(!o)return;const c=mw(o.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:c),this.setAccounts(c),this.events.emit("connect",{chainId:Vc(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:n}=r;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",Vc(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",Kf(Zn({},at("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,n;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(n=this.modal)==null||n.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Vc(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,n,o]=t.split(":");return{chainId:`${r}:${n}`,address:o}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,n;const o=(r=t==null?void 0:t.chains)!=null?r:[],c=(n=t==null?void 0:t.optionalChains)!=null?n:[],h=o.concat(c);if(!h.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const p=o.length?(t==null?void 0:t.methods)||cu:[],f=o.length?(t==null?void 0:t.events)||uu:[],g=(t==null?void 0:t.optionalMethods)||[],v=(t==null?void 0:t.optionalEvents)||[],b=(t==null?void 0:t.rpcMap)||this.buildRpcMap(h,t.projectId),E=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:o==null?void 0:o.map(F=>this.formatChainId(F)),optionalChains:c.map(F=>this.formatChainId(F)),methods:p,events:f,optionalMethods:g,optionalEvents:v,rpcMap:b,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:E,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const n={};return t.forEach(o=>{n[o]=this.getRpcUrl(o,r)}),n}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?qo(this.rpc.chains):qo(this.rpc.optionalChains),this.signer=await RS.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:n}=await ww(()=>import("./index-4d334e0c.js").then(o=>o.i),["assets/index-4d334e0c.js","assets/index-6d80966c.js","assets/index-01d1fbbf.css"]);r=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Zn({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:n,rpcMap:o}=t;r&&pn(r)&&(this.rpc.chains=r.map(c=>this.formatChainId(c)),r.forEach(c=>{this.rpc.rpcMap[c]=(o==null?void 0:o[c])||this.getRpcUrl(c)})),n&&pn(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(c=>this.formatChainId(c)),n.forEach(c=>{this.rpc.rpcMap[c]=(o==null?void 0:o[c])||this.getRpcUrl(c)}))}getRpcUrl(t,r){var n;return((n=this.rpc.rpcMap)==null?void 0:n[t])||`${qS}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const lF=Ou;export{lF as EthereumProvider,jS as OPTIONAL_EVENTS,zS as OPTIONAL_METHODS,uu as REQUIRED_EVENTS,cu as REQUIRED_METHODS,Ou as default};
